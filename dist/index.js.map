{"version":3,"file":"index.js","sources":["../src/eventdispatcher.js","../node_modules/fast-diff/diff.js","../node_modules/deep-equal/lib/keys.js","../node_modules/deep-equal/lib/is_arguments.js","../node_modules/deep-equal/index.js","../node_modules/extend/index.js","../node_modules/quill-delta/lib/op.js","../node_modules/quill-delta/lib/delta.js","../node_modules/fast-equals/es/utils.js","../node_modules/fast-equals/es/comparator.js","../node_modules/fast-equals/es/index.js","../src/editor.js","../src/view/vdom.js","../src/view/blocks.js","../src/view/markups.js","../src/view/embeds.js","../src/view/defaultDom.js","../src/selection.js","../node_modules/escape-html/index.js","../src/view/dom.js","../src/paper.js","../node_modules/keyboardevent-key-polyfill/index.js","../node_modules/shortcut-string/index.js","../src/view.js","../src/modules/input.js","../src/modules/key-shortcuts.js","../src/modules/history.js","../src/modules/smart-entry.js","../src/modules/smart-quotes.js","../src/index.js","../src/dev.js"],"sourcesContent":["const dispatcherEvents = new WeakMap();\n\n\nexport default class EventDispatcher {\n\n  on(type, listener) {\n    getEventListeners(this, type).add(listener);\n  }\n\n  off(type, listener) {\n    getEventListeners(this, type).delete(listener);\n  }\n\n  once(type, listener) {\n    function once(...args) {\n      this.off(type, once);\n      listener.apply(this, args);\n    }\n    this.on(type, once);\n  }\n\n  fire(type, ...args) {\n    let uncanceled = true;\n    getEventListeners(this, type).forEach(listener => {\n      uncanceled && listener.apply(this, args) !== false || (uncanceled = false);\n    });\n    return uncanceled;\n  }\n}\n\n\nfunction getEventListeners(obj, type) {\n  let events = dispatcherEvents.get(obj);\n  if (!events) dispatcherEvents.set(obj, events = Object.create(null));\n  return events[type] || (events[type] = new Set());\n}\n","/**\n * This library modifies the diff-patch-match library by Neil Fraser\n * by removing the patch and match functionality and certain advanced\n * options in the diff function. The original license is as follows:\n *\n * ===\n *\n * Diff Match and Patch\n *\n * Copyright 2006 Google Inc.\n * http://code.google.com/p/google-diff-match-patch/\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * The data structure representing a diff is an array of tuples:\n * [[DIFF_DELETE, 'Hello'], [DIFF_INSERT, 'Goodbye'], [DIFF_EQUAL, ' world.']]\n * which means: delete 'Hello', add 'Goodbye' and keep ' world.'\n */\nvar DIFF_DELETE = -1;\nvar DIFF_INSERT = 1;\nvar DIFF_EQUAL = 0;\n\n\n/**\n * Find the differences between two texts.  Simplifies the problem by stripping\n * any common prefix or suffix off the texts before diffing.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @param {Int} cursor_pos Expected edit position in text1 (optional)\n * @return {Array} Array of diff tuples.\n */\nfunction diff_main(text1, text2, cursor_pos) {\n  // Check for equality (speedup).\n  if (text1 == text2) {\n    if (text1) {\n      return [[DIFF_EQUAL, text1]];\n    }\n    return [];\n  }\n\n  // Check cursor_pos within bounds\n  if (cursor_pos < 0 || text1.length < cursor_pos) {\n    cursor_pos = null;\n  }\n\n  // Trim off common prefix (speedup).\n  var commonlength = diff_commonPrefix(text1, text2);\n  var commonprefix = text1.substring(0, commonlength);\n  text1 = text1.substring(commonlength);\n  text2 = text2.substring(commonlength);\n\n  // Trim off common suffix (speedup).\n  commonlength = diff_commonSuffix(text1, text2);\n  var commonsuffix = text1.substring(text1.length - commonlength);\n  text1 = text1.substring(0, text1.length - commonlength);\n  text2 = text2.substring(0, text2.length - commonlength);\n\n  // Compute the diff on the middle block.\n  var diffs = diff_compute_(text1, text2);\n\n  // Restore the prefix and suffix.\n  if (commonprefix) {\n    diffs.unshift([DIFF_EQUAL, commonprefix]);\n  }\n  if (commonsuffix) {\n    diffs.push([DIFF_EQUAL, commonsuffix]);\n  }\n  diff_cleanupMerge(diffs);\n  if (cursor_pos != null) {\n    diffs = fix_cursor(diffs, cursor_pos);\n  }\n  diffs = fix_emoji(diffs);\n  return diffs;\n};\n\n\n/**\n * Find the differences between two texts.  Assumes that the texts do not\n * have any common prefix or suffix.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @return {Array} Array of diff tuples.\n */\nfunction diff_compute_(text1, text2) {\n  var diffs;\n\n  if (!text1) {\n    // Just add some text (speedup).\n    return [[DIFF_INSERT, text2]];\n  }\n\n  if (!text2) {\n    // Just delete some text (speedup).\n    return [[DIFF_DELETE, text1]];\n  }\n\n  var longtext = text1.length > text2.length ? text1 : text2;\n  var shorttext = text1.length > text2.length ? text2 : text1;\n  var i = longtext.indexOf(shorttext);\n  if (i != -1) {\n    // Shorter text is inside the longer text (speedup).\n    diffs = [[DIFF_INSERT, longtext.substring(0, i)],\n             [DIFF_EQUAL, shorttext],\n             [DIFF_INSERT, longtext.substring(i + shorttext.length)]];\n    // Swap insertions for deletions if diff is reversed.\n    if (text1.length > text2.length) {\n      diffs[0][0] = diffs[2][0] = DIFF_DELETE;\n    }\n    return diffs;\n  }\n\n  if (shorttext.length == 1) {\n    // Single character string.\n    // After the previous speedup, the character can't be an equality.\n    return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n  }\n\n  // Check to see if the problem can be split in two.\n  var hm = diff_halfMatch_(text1, text2);\n  if (hm) {\n    // A half-match was found, sort out the return data.\n    var text1_a = hm[0];\n    var text1_b = hm[1];\n    var text2_a = hm[2];\n    var text2_b = hm[3];\n    var mid_common = hm[4];\n    // Send both pairs off for separate processing.\n    var diffs_a = diff_main(text1_a, text2_a);\n    var diffs_b = diff_main(text1_b, text2_b);\n    // Merge the results.\n    return diffs_a.concat([[DIFF_EQUAL, mid_common]], diffs_b);\n  }\n\n  return diff_bisect_(text1, text2);\n};\n\n\n/**\n * Find the 'middle snake' of a diff, split the problem in two\n * and return the recursively constructed diff.\n * See Myers 1986 paper: An O(ND) Difference Algorithm and Its Variations.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @return {Array} Array of diff tuples.\n * @private\n */\nfunction diff_bisect_(text1, text2) {\n  // Cache the text lengths to prevent multiple calls.\n  var text1_length = text1.length;\n  var text2_length = text2.length;\n  var max_d = Math.ceil((text1_length + text2_length) / 2);\n  var v_offset = max_d;\n  var v_length = 2 * max_d;\n  var v1 = new Array(v_length);\n  var v2 = new Array(v_length);\n  // Setting all elements to -1 is faster in Chrome & Firefox than mixing\n  // integers and undefined.\n  for (var x = 0; x < v_length; x++) {\n    v1[x] = -1;\n    v2[x] = -1;\n  }\n  v1[v_offset + 1] = 0;\n  v2[v_offset + 1] = 0;\n  var delta = text1_length - text2_length;\n  // If the total number of characters is odd, then the front path will collide\n  // with the reverse path.\n  var front = (delta % 2 != 0);\n  // Offsets for start and end of k loop.\n  // Prevents mapping of space beyond the grid.\n  var k1start = 0;\n  var k1end = 0;\n  var k2start = 0;\n  var k2end = 0;\n  for (var d = 0; d < max_d; d++) {\n    // Walk the front path one step.\n    for (var k1 = -d + k1start; k1 <= d - k1end; k1 += 2) {\n      var k1_offset = v_offset + k1;\n      var x1;\n      if (k1 == -d || (k1 != d && v1[k1_offset - 1] < v1[k1_offset + 1])) {\n        x1 = v1[k1_offset + 1];\n      } else {\n        x1 = v1[k1_offset - 1] + 1;\n      }\n      var y1 = x1 - k1;\n      while (x1 < text1_length && y1 < text2_length &&\n             text1.charAt(x1) == text2.charAt(y1)) {\n        x1++;\n        y1++;\n      }\n      v1[k1_offset] = x1;\n      if (x1 > text1_length) {\n        // Ran off the right of the graph.\n        k1end += 2;\n      } else if (y1 > text2_length) {\n        // Ran off the bottom of the graph.\n        k1start += 2;\n      } else if (front) {\n        var k2_offset = v_offset + delta - k1;\n        if (k2_offset >= 0 && k2_offset < v_length && v2[k2_offset] != -1) {\n          // Mirror x2 onto top-left coordinate system.\n          var x2 = text1_length - v2[k2_offset];\n          if (x1 >= x2) {\n            // Overlap detected.\n            return diff_bisectSplit_(text1, text2, x1, y1);\n          }\n        }\n      }\n    }\n\n    // Walk the reverse path one step.\n    for (var k2 = -d + k2start; k2 <= d - k2end; k2 += 2) {\n      var k2_offset = v_offset + k2;\n      var x2;\n      if (k2 == -d || (k2 != d && v2[k2_offset - 1] < v2[k2_offset + 1])) {\n        x2 = v2[k2_offset + 1];\n      } else {\n        x2 = v2[k2_offset - 1] + 1;\n      }\n      var y2 = x2 - k2;\n      while (x2 < text1_length && y2 < text2_length &&\n             text1.charAt(text1_length - x2 - 1) ==\n             text2.charAt(text2_length - y2 - 1)) {\n        x2++;\n        y2++;\n      }\n      v2[k2_offset] = x2;\n      if (x2 > text1_length) {\n        // Ran off the left of the graph.\n        k2end += 2;\n      } else if (y2 > text2_length) {\n        // Ran off the top of the graph.\n        k2start += 2;\n      } else if (!front) {\n        var k1_offset = v_offset + delta - k2;\n        if (k1_offset >= 0 && k1_offset < v_length && v1[k1_offset] != -1) {\n          var x1 = v1[k1_offset];\n          var y1 = v_offset + x1 - k1_offset;\n          // Mirror x2 onto top-left coordinate system.\n          x2 = text1_length - x2;\n          if (x1 >= x2) {\n            // Overlap detected.\n            return diff_bisectSplit_(text1, text2, x1, y1);\n          }\n        }\n      }\n    }\n  }\n  // Diff took too long and hit the deadline or\n  // number of diffs equals number of characters, no commonality at all.\n  return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n};\n\n\n/**\n * Given the location of the 'middle snake', split the diff in two parts\n * and recurse.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @param {number} x Index of split point in text1.\n * @param {number} y Index of split point in text2.\n * @return {Array} Array of diff tuples.\n */\nfunction diff_bisectSplit_(text1, text2, x, y) {\n  var text1a = text1.substring(0, x);\n  var text2a = text2.substring(0, y);\n  var text1b = text1.substring(x);\n  var text2b = text2.substring(y);\n\n  // Compute both diffs serially.\n  var diffs = diff_main(text1a, text2a);\n  var diffsb = diff_main(text1b, text2b);\n\n  return diffs.concat(diffsb);\n};\n\n\n/**\n * Determine the common prefix of two strings.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {number} The number of characters common to the start of each\n *     string.\n */\nfunction diff_commonPrefix(text1, text2) {\n  // Quick check for common null cases.\n  if (!text1 || !text2 || text1.charAt(0) != text2.charAt(0)) {\n    return 0;\n  }\n  // Binary search.\n  // Performance analysis: http://neil.fraser.name/news/2007/10/09/\n  var pointermin = 0;\n  var pointermax = Math.min(text1.length, text2.length);\n  var pointermid = pointermax;\n  var pointerstart = 0;\n  while (pointermin < pointermid) {\n    if (text1.substring(pointerstart, pointermid) ==\n        text2.substring(pointerstart, pointermid)) {\n      pointermin = pointermid;\n      pointerstart = pointermin;\n    } else {\n      pointermax = pointermid;\n    }\n    pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n  }\n  return pointermid;\n};\n\n\n/**\n * Determine the common suffix of two strings.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {number} The number of characters common to the end of each string.\n */\nfunction diff_commonSuffix(text1, text2) {\n  // Quick check for common null cases.\n  if (!text1 || !text2 ||\n      text1.charAt(text1.length - 1) != text2.charAt(text2.length - 1)) {\n    return 0;\n  }\n  // Binary search.\n  // Performance analysis: http://neil.fraser.name/news/2007/10/09/\n  var pointermin = 0;\n  var pointermax = Math.min(text1.length, text2.length);\n  var pointermid = pointermax;\n  var pointerend = 0;\n  while (pointermin < pointermid) {\n    if (text1.substring(text1.length - pointermid, text1.length - pointerend) ==\n        text2.substring(text2.length - pointermid, text2.length - pointerend)) {\n      pointermin = pointermid;\n      pointerend = pointermin;\n    } else {\n      pointermax = pointermid;\n    }\n    pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n  }\n  return pointermid;\n};\n\n\n/**\n * Do the two texts share a substring which is at least half the length of the\n * longer text?\n * This speedup can produce non-minimal diffs.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {Array.<string>} Five element Array, containing the prefix of\n *     text1, the suffix of text1, the prefix of text2, the suffix of\n *     text2 and the common middle.  Or null if there was no match.\n */\nfunction diff_halfMatch_(text1, text2) {\n  var longtext = text1.length > text2.length ? text1 : text2;\n  var shorttext = text1.length > text2.length ? text2 : text1;\n  if (longtext.length < 4 || shorttext.length * 2 < longtext.length) {\n    return null;  // Pointless.\n  }\n\n  /**\n   * Does a substring of shorttext exist within longtext such that the substring\n   * is at least half the length of longtext?\n   * Closure, but does not reference any external variables.\n   * @param {string} longtext Longer string.\n   * @param {string} shorttext Shorter string.\n   * @param {number} i Start index of quarter length substring within longtext.\n   * @return {Array.<string>} Five element Array, containing the prefix of\n   *     longtext, the suffix of longtext, the prefix of shorttext, the suffix\n   *     of shorttext and the common middle.  Or null if there was no match.\n   * @private\n   */\n  function diff_halfMatchI_(longtext, shorttext, i) {\n    // Start with a 1/4 length substring at position i as a seed.\n    var seed = longtext.substring(i, i + Math.floor(longtext.length / 4));\n    var j = -1;\n    var best_common = '';\n    var best_longtext_a, best_longtext_b, best_shorttext_a, best_shorttext_b;\n    while ((j = shorttext.indexOf(seed, j + 1)) != -1) {\n      var prefixLength = diff_commonPrefix(longtext.substring(i),\n                                           shorttext.substring(j));\n      var suffixLength = diff_commonSuffix(longtext.substring(0, i),\n                                           shorttext.substring(0, j));\n      if (best_common.length < suffixLength + prefixLength) {\n        best_common = shorttext.substring(j - suffixLength, j) +\n            shorttext.substring(j, j + prefixLength);\n        best_longtext_a = longtext.substring(0, i - suffixLength);\n        best_longtext_b = longtext.substring(i + prefixLength);\n        best_shorttext_a = shorttext.substring(0, j - suffixLength);\n        best_shorttext_b = shorttext.substring(j + prefixLength);\n      }\n    }\n    if (best_common.length * 2 >= longtext.length) {\n      return [best_longtext_a, best_longtext_b,\n              best_shorttext_a, best_shorttext_b, best_common];\n    } else {\n      return null;\n    }\n  }\n\n  // First check if the second quarter is the seed for a half-match.\n  var hm1 = diff_halfMatchI_(longtext, shorttext,\n                             Math.ceil(longtext.length / 4));\n  // Check again based on the third quarter.\n  var hm2 = diff_halfMatchI_(longtext, shorttext,\n                             Math.ceil(longtext.length / 2));\n  var hm;\n  if (!hm1 && !hm2) {\n    return null;\n  } else if (!hm2) {\n    hm = hm1;\n  } else if (!hm1) {\n    hm = hm2;\n  } else {\n    // Both matched.  Select the longest.\n    hm = hm1[4].length > hm2[4].length ? hm1 : hm2;\n  }\n\n  // A half-match was found, sort out the return data.\n  var text1_a, text1_b, text2_a, text2_b;\n  if (text1.length > text2.length) {\n    text1_a = hm[0];\n    text1_b = hm[1];\n    text2_a = hm[2];\n    text2_b = hm[3];\n  } else {\n    text2_a = hm[0];\n    text2_b = hm[1];\n    text1_a = hm[2];\n    text1_b = hm[3];\n  }\n  var mid_common = hm[4];\n  return [text1_a, text1_b, text2_a, text2_b, mid_common];\n};\n\n\n/**\n * Reorder and merge like edit sections.  Merge equalities.\n * Any edit section can move as long as it doesn't cross an equality.\n * @param {Array} diffs Array of diff tuples.\n */\nfunction diff_cleanupMerge(diffs) {\n  diffs.push([DIFF_EQUAL, '']);  // Add a dummy entry at the end.\n  var pointer = 0;\n  var count_delete = 0;\n  var count_insert = 0;\n  var text_delete = '';\n  var text_insert = '';\n  var commonlength;\n  while (pointer < diffs.length) {\n    switch (diffs[pointer][0]) {\n      case DIFF_INSERT:\n        count_insert++;\n        text_insert += diffs[pointer][1];\n        pointer++;\n        break;\n      case DIFF_DELETE:\n        count_delete++;\n        text_delete += diffs[pointer][1];\n        pointer++;\n        break;\n      case DIFF_EQUAL:\n        // Upon reaching an equality, check for prior redundancies.\n        if (count_delete + count_insert > 1) {\n          if (count_delete !== 0 && count_insert !== 0) {\n            // Factor out any common prefixies.\n            commonlength = diff_commonPrefix(text_insert, text_delete);\n            if (commonlength !== 0) {\n              if ((pointer - count_delete - count_insert) > 0 &&\n                  diffs[pointer - count_delete - count_insert - 1][0] ==\n                  DIFF_EQUAL) {\n                diffs[pointer - count_delete - count_insert - 1][1] +=\n                    text_insert.substring(0, commonlength);\n              } else {\n                diffs.splice(0, 0, [DIFF_EQUAL,\n                                    text_insert.substring(0, commonlength)]);\n                pointer++;\n              }\n              text_insert = text_insert.substring(commonlength);\n              text_delete = text_delete.substring(commonlength);\n            }\n            // Factor out any common suffixies.\n            commonlength = diff_commonSuffix(text_insert, text_delete);\n            if (commonlength !== 0) {\n              diffs[pointer][1] = text_insert.substring(text_insert.length -\n                  commonlength) + diffs[pointer][1];\n              text_insert = text_insert.substring(0, text_insert.length -\n                  commonlength);\n              text_delete = text_delete.substring(0, text_delete.length -\n                  commonlength);\n            }\n          }\n          // Delete the offending records and add the merged ones.\n          if (count_delete === 0) {\n            diffs.splice(pointer - count_insert,\n                count_delete + count_insert, [DIFF_INSERT, text_insert]);\n          } else if (count_insert === 0) {\n            diffs.splice(pointer - count_delete,\n                count_delete + count_insert, [DIFF_DELETE, text_delete]);\n          } else {\n            diffs.splice(pointer - count_delete - count_insert,\n                count_delete + count_insert, [DIFF_DELETE, text_delete],\n                [DIFF_INSERT, text_insert]);\n          }\n          pointer = pointer - count_delete - count_insert +\n                    (count_delete ? 1 : 0) + (count_insert ? 1 : 0) + 1;\n        } else if (pointer !== 0 && diffs[pointer - 1][0] == DIFF_EQUAL) {\n          // Merge this equality with the previous one.\n          diffs[pointer - 1][1] += diffs[pointer][1];\n          diffs.splice(pointer, 1);\n        } else {\n          pointer++;\n        }\n        count_insert = 0;\n        count_delete = 0;\n        text_delete = '';\n        text_insert = '';\n        break;\n    }\n  }\n  if (diffs[diffs.length - 1][1] === '') {\n    diffs.pop();  // Remove the dummy entry at the end.\n  }\n\n  // Second pass: look for single edits surrounded on both sides by equalities\n  // which can be shifted sideways to eliminate an equality.\n  // e.g: A<ins>BA</ins>C -> <ins>AB</ins>AC\n  var changes = false;\n  pointer = 1;\n  // Intentionally ignore the first and last element (don't need checking).\n  while (pointer < diffs.length - 1) {\n    if (diffs[pointer - 1][0] == DIFF_EQUAL &&\n        diffs[pointer + 1][0] == DIFF_EQUAL) {\n      // This is a single edit surrounded by equalities.\n      if (diffs[pointer][1].substring(diffs[pointer][1].length -\n          diffs[pointer - 1][1].length) == diffs[pointer - 1][1]) {\n        // Shift the edit over the previous equality.\n        diffs[pointer][1] = diffs[pointer - 1][1] +\n            diffs[pointer][1].substring(0, diffs[pointer][1].length -\n                                        diffs[pointer - 1][1].length);\n        diffs[pointer + 1][1] = diffs[pointer - 1][1] + diffs[pointer + 1][1];\n        diffs.splice(pointer - 1, 1);\n        changes = true;\n      } else if (diffs[pointer][1].substring(0, diffs[pointer + 1][1].length) ==\n          diffs[pointer + 1][1]) {\n        // Shift the edit over the next equality.\n        diffs[pointer - 1][1] += diffs[pointer + 1][1];\n        diffs[pointer][1] =\n            diffs[pointer][1].substring(diffs[pointer + 1][1].length) +\n            diffs[pointer + 1][1];\n        diffs.splice(pointer + 1, 1);\n        changes = true;\n      }\n    }\n    pointer++;\n  }\n  // If shifts were made, the diff needs reordering and another shift sweep.\n  if (changes) {\n    diff_cleanupMerge(diffs);\n  }\n};\n\n\nvar diff = diff_main;\ndiff.INSERT = DIFF_INSERT;\ndiff.DELETE = DIFF_DELETE;\ndiff.EQUAL = DIFF_EQUAL;\n\nmodule.exports = diff;\n\n/*\n * Modify a diff such that the cursor position points to the start of a change:\n * E.g.\n *   cursor_normalize_diff([[DIFF_EQUAL, 'abc']], 1)\n *     => [1, [[DIFF_EQUAL, 'a'], [DIFF_EQUAL, 'bc']]]\n *   cursor_normalize_diff([[DIFF_INSERT, 'new'], [DIFF_DELETE, 'xyz']], 2)\n *     => [2, [[DIFF_INSERT, 'new'], [DIFF_DELETE, 'xy'], [DIFF_DELETE, 'z']]]\n *\n * @param {Array} diffs Array of diff tuples\n * @param {Int} cursor_pos Suggested edit position. Must not be out of bounds!\n * @return {Array} A tuple [cursor location in the modified diff, modified diff]\n */\nfunction cursor_normalize_diff (diffs, cursor_pos) {\n  if (cursor_pos === 0) {\n    return [DIFF_EQUAL, diffs];\n  }\n  for (var current_pos = 0, i = 0; i < diffs.length; i++) {\n    var d = diffs[i];\n    if (d[0] === DIFF_DELETE || d[0] === DIFF_EQUAL) {\n      var next_pos = current_pos + d[1].length;\n      if (cursor_pos === next_pos) {\n        return [i + 1, diffs];\n      } else if (cursor_pos < next_pos) {\n        // copy to prevent side effects\n        diffs = diffs.slice();\n        // split d into two diff changes\n        var split_pos = cursor_pos - current_pos;\n        var d_left = [d[0], d[1].slice(0, split_pos)];\n        var d_right = [d[0], d[1].slice(split_pos)];\n        diffs.splice(i, 1, d_left, d_right);\n        return [i + 1, diffs];\n      } else {\n        current_pos = next_pos;\n      }\n    }\n  }\n  throw new Error('cursor_pos is out of bounds!')\n}\n\n/*\n * Modify a diff such that the edit position is \"shifted\" to the proposed edit location (cursor_position).\n *\n * Case 1)\n *   Check if a naive shift is possible:\n *     [0, X], [ 1, Y] -> [ 1, Y], [0, X]    (if X + Y === Y + X)\n *     [0, X], [-1, Y] -> [-1, Y], [0, X]    (if X + Y === Y + X) - holds same result\n * Case 2)\n *   Check if the following shifts are possible:\n *     [0, 'pre'], [ 1, 'prefix'] -> [ 1, 'pre'], [0, 'pre'], [ 1, 'fix']\n *     [0, 'pre'], [-1, 'prefix'] -> [-1, 'pre'], [0, 'pre'], [-1, 'fix']\n *         ^            ^\n *         d          d_next\n *\n * @param {Array} diffs Array of diff tuples\n * @param {Int} cursor_pos Suggested edit position. Must not be out of bounds!\n * @return {Array} Array of diff tuples\n */\nfunction fix_cursor (diffs, cursor_pos) {\n  var norm = cursor_normalize_diff(diffs, cursor_pos);\n  var ndiffs = norm[1];\n  var cursor_pointer = norm[0];\n  var d = ndiffs[cursor_pointer];\n  var d_next = ndiffs[cursor_pointer + 1];\n\n  if (d == null) {\n    // Text was deleted from end of original string,\n    // cursor is now out of bounds in new string\n    return diffs;\n  } else if (d[0] !== DIFF_EQUAL) {\n    // A modification happened at the cursor location.\n    // This is the expected outcome, so we can return the original diff.\n    return diffs;\n  } else {\n    if (d_next != null && d[1] + d_next[1] === d_next[1] + d[1]) {\n      // Case 1)\n      // It is possible to perform a naive shift\n      ndiffs.splice(cursor_pointer, 2, d_next, d)\n      return merge_tuples(ndiffs, cursor_pointer, 2)\n    } else if (d_next != null && d_next[1].indexOf(d[1]) === 0) {\n      // Case 2)\n      // d[1] is a prefix of d_next[1]\n      // We can assume that d_next[0] !== 0, since d[0] === 0\n      // Shift edit locations..\n      ndiffs.splice(cursor_pointer, 2, [d_next[0], d[1]], [0, d[1]]);\n      var suffix = d_next[1].slice(d[1].length);\n      if (suffix.length > 0) {\n        ndiffs.splice(cursor_pointer + 2, 0, [d_next[0], suffix]);\n      }\n      return merge_tuples(ndiffs, cursor_pointer, 3)\n    } else {\n      // Not possible to perform any modification\n      return diffs;\n    }\n  }\n}\n\n/*\n * Check diff did not split surrogate pairs.\n * Ex. [0, '\\uD83D'], [-1, '\\uDC36'], [1, '\\uDC2F'] -> [-1, '\\uD83D\\uDC36'], [1, '\\uD83D\\uDC2F']\n *     '\\uD83D\\uDC36' === 'ðŸ¶', '\\uD83D\\uDC2F' === 'ðŸ¯'\n *\n * @param {Array} diffs Array of diff tuples\n * @return {Array} Array of diff tuples\n */\nfunction fix_emoji (diffs) {\n  var compact = false;\n  var starts_with_pair_end = function(str) {\n    return str.charCodeAt(0) >= 0xDC00 && str.charCodeAt(0) <= 0xDFFF;\n  }\n  var ends_with_pair_start = function(str) {\n    return str.charCodeAt(str.length-1) >= 0xD800 && str.charCodeAt(str.length-1) <= 0xDBFF;\n  }\n  for (var i = 2; i < diffs.length; i += 1) {\n    if (diffs[i-2][0] === DIFF_EQUAL && ends_with_pair_start(diffs[i-2][1]) &&\n        diffs[i-1][0] === DIFF_DELETE && starts_with_pair_end(diffs[i-1][1]) &&\n        diffs[i][0] === DIFF_INSERT && starts_with_pair_end(diffs[i][1])) {\n      compact = true;\n\n      diffs[i-1][1] = diffs[i-2][1].slice(-1) + diffs[i-1][1];\n      diffs[i][1] = diffs[i-2][1].slice(-1) + diffs[i][1];\n\n      diffs[i-2][1] = diffs[i-2][1].slice(0, -1);\n    }\n  }\n  if (!compact) {\n    return diffs;\n  }\n  var fixed_diffs = [];\n  for (var i = 0; i < diffs.length; i += 1) {\n    if (diffs[i][1].length > 0) {\n      fixed_diffs.push(diffs[i]);\n    }\n  }\n  return fixed_diffs;\n}\n\n/*\n * Try to merge tuples with their neigbors in a given range.\n * E.g. [0, 'a'], [0, 'b'] -> [0, 'ab']\n *\n * @param {Array} diffs Array of diff tuples.\n * @param {Int} start Position of the first element to merge (diffs[start] is also merged with diffs[start - 1]).\n * @param {Int} length Number of consecutive elements to check.\n * @return {Array} Array of merged diff tuples.\n */\nfunction merge_tuples (diffs, start, length) {\n  // Check from (start-1) to (start+length).\n  for (var i = start + length - 1; i >= 0 && i >= start - 1; i--) {\n    if (i + 1 < diffs.length) {\n      var left_d = diffs[i];\n      var right_d = diffs[i+1];\n      if (left_d[0] === right_d[1]) {\n        diffs.splice(i, 2, [left_d[0], left_d[1] + right_d[1]]);\n      }\n    }\n  }\n  return diffs;\n}\n","exports = module.exports = typeof Object.keys === 'function'\n  ? Object.keys : shim;\n\nexports.shim = shim;\nfunction shim (obj) {\n  var keys = [];\n  for (var key in obj) keys.push(key);\n  return keys;\n}\n","var supportsArgumentsClass = (function(){\n  return Object.prototype.toString.call(arguments)\n})() == '[object Arguments]';\n\nexports = module.exports = supportsArgumentsClass ? supported : unsupported;\n\nexports.supported = supported;\nfunction supported(object) {\n  return Object.prototype.toString.call(object) == '[object Arguments]';\n};\n\nexports.unsupported = unsupported;\nfunction unsupported(object){\n  return object &&\n    typeof object == 'object' &&\n    typeof object.length == 'number' &&\n    Object.prototype.hasOwnProperty.call(object, 'callee') &&\n    !Object.prototype.propertyIsEnumerable.call(object, 'callee') ||\n    false;\n};\n","var pSlice = Array.prototype.slice;\nvar objectKeys = require('./lib/keys.js');\nvar isArguments = require('./lib/is_arguments.js');\n\nvar deepEqual = module.exports = function (actual, expected, opts) {\n  if (!opts) opts = {};\n  // 7.1. All identical values are equivalent, as determined by ===.\n  if (actual === expected) {\n    return true;\n\n  } else if (actual instanceof Date && expected instanceof Date) {\n    return actual.getTime() === expected.getTime();\n\n  // 7.3. Other pairs that do not both pass typeof value == 'object',\n  // equivalence is determined by ==.\n  } else if (!actual || !expected || typeof actual != 'object' && typeof expected != 'object') {\n    return opts.strict ? actual === expected : actual == expected;\n\n  // 7.4. For all other Object pairs, including Array objects, equivalence is\n  // determined by having the same number of owned properties (as verified\n  // with Object.prototype.hasOwnProperty.call), the same set of keys\n  // (although not necessarily the same order), equivalent values for every\n  // corresponding key, and an identical 'prototype' property. Note: this\n  // accounts for both named and indexed properties on Arrays.\n  } else {\n    return objEquiv(actual, expected, opts);\n  }\n}\n\nfunction isUndefinedOrNull(value) {\n  return value === null || value === undefined;\n}\n\nfunction isBuffer (x) {\n  if (!x || typeof x !== 'object' || typeof x.length !== 'number') return false;\n  if (typeof x.copy !== 'function' || typeof x.slice !== 'function') {\n    return false;\n  }\n  if (x.length > 0 && typeof x[0] !== 'number') return false;\n  return true;\n}\n\nfunction objEquiv(a, b, opts) {\n  var i, key;\n  if (isUndefinedOrNull(a) || isUndefinedOrNull(b))\n    return false;\n  // an identical 'prototype' property.\n  if (a.prototype !== b.prototype) return false;\n  //~~~I've managed to break Object.keys through screwy arguments passing.\n  //   Converting to array solves the problem.\n  if (isArguments(a)) {\n    if (!isArguments(b)) {\n      return false;\n    }\n    a = pSlice.call(a);\n    b = pSlice.call(b);\n    return deepEqual(a, b, opts);\n  }\n  if (isBuffer(a)) {\n    if (!isBuffer(b)) {\n      return false;\n    }\n    if (a.length !== b.length) return false;\n    for (i = 0; i < a.length; i++) {\n      if (a[i] !== b[i]) return false;\n    }\n    return true;\n  }\n  try {\n    var ka = objectKeys(a),\n        kb = objectKeys(b);\n  } catch (e) {//happens when one is a string literal and the other isn't\n    return false;\n  }\n  // having the same number of owned properties (keys incorporates\n  // hasOwnProperty)\n  if (ka.length != kb.length)\n    return false;\n  //the same set of keys (although not necessarily the same order),\n  ka.sort();\n  kb.sort();\n  //~~~cheap key test\n  for (i = ka.length - 1; i >= 0; i--) {\n    if (ka[i] != kb[i])\n      return false;\n  }\n  //equivalent values for every corresponding key, and\n  //~~~possibly expensive deep test\n  for (i = ka.length - 1; i >= 0; i--) {\n    key = ka[i];\n    if (!deepEqual(a[key], b[key], opts)) return false;\n  }\n  return typeof a === typeof b;\n}\n","'use strict';\n\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar toStr = Object.prototype.toString;\n\nvar isArray = function isArray(arr) {\n\tif (typeof Array.isArray === 'function') {\n\t\treturn Array.isArray(arr);\n\t}\n\n\treturn toStr.call(arr) === '[object Array]';\n};\n\nvar isPlainObject = function isPlainObject(obj) {\n\tif (!obj || toStr.call(obj) !== '[object Object]') {\n\t\treturn false;\n\t}\n\n\tvar hasOwnConstructor = hasOwn.call(obj, 'constructor');\n\tvar hasIsPrototypeOf = obj.constructor && obj.constructor.prototype && hasOwn.call(obj.constructor.prototype, 'isPrototypeOf');\n\t// Not own constructor property must be Object\n\tif (obj.constructor && !hasOwnConstructor && !hasIsPrototypeOf) {\n\t\treturn false;\n\t}\n\n\t// Own properties are enumerated firstly, so to speed up,\n\t// if last one is own, then all properties are own.\n\tvar key;\n\tfor (key in obj) { /**/ }\n\n\treturn typeof key === 'undefined' || hasOwn.call(obj, key);\n};\n\nmodule.exports = function extend() {\n\tvar options, name, src, copy, copyIsArray, clone;\n\tvar target = arguments[0];\n\tvar i = 1;\n\tvar length = arguments.length;\n\tvar deep = false;\n\n\t// Handle a deep copy situation\n\tif (typeof target === 'boolean') {\n\t\tdeep = target;\n\t\ttarget = arguments[1] || {};\n\t\t// skip the boolean and the target\n\t\ti = 2;\n\t}\n\tif (target == null || (typeof target !== 'object' && typeof target !== 'function')) {\n\t\ttarget = {};\n\t}\n\n\tfor (; i < length; ++i) {\n\t\toptions = arguments[i];\n\t\t// Only deal with non-null/undefined values\n\t\tif (options != null) {\n\t\t\t// Extend the base object\n\t\t\tfor (name in options) {\n\t\t\t\tsrc = target[name];\n\t\t\t\tcopy = options[name];\n\n\t\t\t\t// Prevent never-ending loop\n\t\t\t\tif (target !== copy) {\n\t\t\t\t\t// Recurse if we're merging plain objects or arrays\n\t\t\t\t\tif (deep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\n\t\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\t\tcopyIsArray = false;\n\t\t\t\t\t\t\tclone = src && isArray(src) ? src : [];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclone = src && isPlainObject(src) ? src : {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Never move original objects, clone them\n\t\t\t\t\t\ttarget[name] = extend(deep, clone, copy);\n\n\t\t\t\t\t// Don't bring in undefined values\n\t\t\t\t\t} else if (typeof copy !== 'undefined') {\n\t\t\t\t\t\ttarget[name] = copy;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Return the modified object\n\treturn target;\n};\n","var equal = require('deep-equal');\nvar extend = require('extend');\n\n\nvar lib = {\n  attributes: {\n    compose: function (a, b, keepNull) {\n      if (typeof a !== 'object') a = {};\n      if (typeof b !== 'object') b = {};\n      var attributes = extend(true, {}, b);\n      if (!keepNull) {\n        attributes = Object.keys(attributes).reduce(function (copy, key) {\n          if (attributes[key] != null) {\n            copy[key] = attributes[key];\n          }\n          return copy;\n        }, {});\n      }\n      for (var key in a) {\n        if (a[key] !== undefined && b[key] === undefined) {\n          attributes[key] = a[key];\n        }\n      }\n      return Object.keys(attributes).length > 0 ? attributes : undefined;\n    },\n\n    diff: function(a, b) {\n      if (typeof a !== 'object') a = {};\n      if (typeof b !== 'object') b = {};\n      var attributes = Object.keys(a).concat(Object.keys(b)).reduce(function (attributes, key) {\n        if (!equal(a[key], b[key])) {\n          attributes[key] = b[key] === undefined ? null : b[key];\n        }\n        return attributes;\n      }, {});\n      return Object.keys(attributes).length > 0 ? attributes : undefined;\n    },\n\n    transform: function (a, b, priority) {\n      if (typeof a !== 'object') return b;\n      if (typeof b !== 'object') return undefined;\n      if (!priority) return b;  // b simply overwrites us without priority\n      var attributes = Object.keys(b).reduce(function (attributes, key) {\n        if (a[key] === undefined) attributes[key] = b[key];  // null is a valid value\n        return attributes;\n      }, {});\n      return Object.keys(attributes).length > 0 ? attributes : undefined;\n    }\n  },\n\n  iterator: function (ops) {\n    return new Iterator(ops);\n  },\n\n  length: function (op) {\n    if (typeof op['delete'] === 'number') {\n      return op['delete'];\n    } else if (typeof op.retain === 'number') {\n      return op.retain;\n    } else {\n      return typeof op.insert === 'string' ? op.insert.length : 1;\n    }\n  }\n};\n\n\nfunction Iterator(ops) {\n  this.ops = ops;\n  this.index = 0;\n  this.offset = 0;\n};\n\nIterator.prototype.hasNext = function () {\n  return this.peekLength() < Infinity;\n};\n\nIterator.prototype.next = function (length) {\n  if (!length) length = Infinity;\n  var nextOp = this.ops[this.index];\n  if (nextOp) {\n    var offset = this.offset;\n    var opLength = lib.length(nextOp)\n    if (length >= opLength - offset) {\n      length = opLength - offset;\n      this.index += 1;\n      this.offset = 0;\n    } else {\n      this.offset += length;\n    }\n    if (typeof nextOp['delete'] === 'number') {\n      return { 'delete': length };\n    } else {\n      var retOp = {};\n      if (nextOp.attributes) {\n        retOp.attributes = nextOp.attributes;\n      }\n      if (typeof nextOp.retain === 'number') {\n        retOp.retain = length;\n      } else if (typeof nextOp.insert === 'string') {\n        retOp.insert = nextOp.insert.substr(offset, length);\n      } else {\n        // offset should === 0, length should === 1\n        retOp.insert = nextOp.insert;\n      }\n      return retOp;\n    }\n  } else {\n    return { retain: Infinity };\n  }\n};\n\nIterator.prototype.peek = function () {\n  return this.ops[this.index];\n};\n\nIterator.prototype.peekLength = function () {\n  if (this.ops[this.index]) {\n    // Should never return 0 if our index is being managed correctly\n    return lib.length(this.ops[this.index]) - this.offset;\n  } else {\n    return Infinity;\n  }\n};\n\nIterator.prototype.peekType = function () {\n  if (this.ops[this.index]) {\n    if (typeof this.ops[this.index]['delete'] === 'number') {\n      return 'delete';\n    } else if (typeof this.ops[this.index].retain === 'number') {\n      return 'retain';\n    } else {\n      return 'insert';\n    }\n  }\n  return 'retain';\n};\n\n\nmodule.exports = lib;\n","var diff = require('fast-diff');\nvar equal = require('deep-equal');\nvar extend = require('extend');\nvar op = require('./op');\n\n\nvar NULL_CHARACTER = String.fromCharCode(0);  // Placeholder char for embed in diff()\n\n\nvar Delta = function (ops) {\n  // Assume we are given a well formed ops\n  if (Array.isArray(ops)) {\n    this.ops = ops;\n  } else if (ops != null && Array.isArray(ops.ops)) {\n    this.ops = ops.ops;\n  } else {\n    this.ops = [];\n  }\n};\n\n\nDelta.prototype.insert = function (text, attributes) {\n  var newOp = {};\n  if (text.length === 0) return this;\n  newOp.insert = text;\n  if (attributes != null && typeof attributes === 'object' && Object.keys(attributes).length > 0) {\n    newOp.attributes = attributes;\n  }\n  return this.push(newOp);\n};\n\nDelta.prototype['delete'] = function (length) {\n  if (length <= 0) return this;\n  return this.push({ 'delete': length });\n};\n\nDelta.prototype.retain = function (length, attributes) {\n  if (length <= 0) return this;\n  var newOp = { retain: length };\n  if (attributes != null && typeof attributes === 'object' && Object.keys(attributes).length > 0) {\n    newOp.attributes = attributes;\n  }\n  return this.push(newOp);\n};\n\nDelta.prototype.push = function (newOp) {\n  var index = this.ops.length;\n  var lastOp = this.ops[index - 1];\n  newOp = extend(true, {}, newOp);\n  if (typeof lastOp === 'object') {\n    if (typeof newOp['delete'] === 'number' && typeof lastOp['delete'] === 'number') {\n      this.ops[index - 1] = { 'delete': lastOp['delete'] + newOp['delete'] };\n      return this;\n    }\n    // Since it does not matter if we insert before or after deleting at the same index,\n    // always prefer to insert first\n    if (typeof lastOp['delete'] === 'number' && newOp.insert != null) {\n      index -= 1;\n      lastOp = this.ops[index - 1];\n      if (typeof lastOp !== 'object') {\n        this.ops.unshift(newOp);\n        return this;\n      }\n    }\n    if (equal(newOp.attributes, lastOp.attributes)) {\n      if (typeof newOp.insert === 'string' && typeof lastOp.insert === 'string') {\n        this.ops[index - 1] = { insert: lastOp.insert + newOp.insert };\n        if (typeof newOp.attributes === 'object') this.ops[index - 1].attributes = newOp.attributes\n        return this;\n      } else if (typeof newOp.retain === 'number' && typeof lastOp.retain === 'number') {\n        this.ops[index - 1] = { retain: lastOp.retain + newOp.retain };\n        if (typeof newOp.attributes === 'object') this.ops[index - 1].attributes = newOp.attributes\n        return this;\n      }\n    }\n  }\n  if (index === this.ops.length) {\n    this.ops.push(newOp);\n  } else {\n    this.ops.splice(index, 0, newOp);\n  }\n  return this;\n};\n\nDelta.prototype.chop = function () {\n  var lastOp = this.ops[this.ops.length - 1];\n  if (lastOp && lastOp.retain && !lastOp.attributes) {\n    this.ops.pop();\n  }\n  return this;\n};\n\nDelta.prototype.filter = function (predicate) {\n  return this.ops.filter(predicate);\n};\n\nDelta.prototype.forEach = function (predicate) {\n  this.ops.forEach(predicate);\n};\n\nDelta.prototype.map = function (predicate) {\n  return this.ops.map(predicate);\n};\n\nDelta.prototype.partition = function (predicate) {\n  var passed = [], failed = [];\n  this.forEach(function(op) {\n    var target = predicate(op) ? passed : failed;\n    target.push(op);\n  });\n  return [passed, failed];\n};\n\nDelta.prototype.reduce = function (predicate, initial) {\n  return this.ops.reduce(predicate, initial);\n};\n\nDelta.prototype.changeLength = function () {\n  return this.reduce(function (length, elem) {\n    if (elem.insert) {\n      return length + op.length(elem);\n    } else if (elem.delete) {\n      return length - elem.delete;\n    }\n    return length;\n  }, 0);\n};\n\nDelta.prototype.length = function () {\n  return this.reduce(function (length, elem) {\n    return length + op.length(elem);\n  }, 0);\n};\n\nDelta.prototype.slice = function (start, end) {\n  start = start || 0;\n  if (typeof end !== 'number') end = Infinity;\n  var ops = [];\n  var iter = op.iterator(this.ops);\n  var index = 0;\n  while (index < end && iter.hasNext()) {\n    var nextOp;\n    if (index < start) {\n      nextOp = iter.next(start - index);\n    } else {\n      nextOp = iter.next(end - index);\n      ops.push(nextOp);\n    }\n    index += op.length(nextOp);\n  }\n  return new Delta(ops);\n};\n\n\nDelta.prototype.compose = function (other) {\n  var thisIter = op.iterator(this.ops);\n  var otherIter = op.iterator(other.ops);\n  var delta = new Delta();\n  while (thisIter.hasNext() || otherIter.hasNext()) {\n    if (otherIter.peekType() === 'insert') {\n      delta.push(otherIter.next());\n    } else if (thisIter.peekType() === 'delete') {\n      delta.push(thisIter.next());\n    } else {\n      var length = Math.min(thisIter.peekLength(), otherIter.peekLength());\n      var thisOp = thisIter.next(length);\n      var otherOp = otherIter.next(length);\n      if (typeof otherOp.retain === 'number') {\n        var newOp = {};\n        if (typeof thisOp.retain === 'number') {\n          newOp.retain = length;\n        } else {\n          newOp.insert = thisOp.insert;\n        }\n        // Preserve null when composing with a retain, otherwise remove it for inserts\n        var attributes = op.attributes.compose(thisOp.attributes, otherOp.attributes, typeof thisOp.retain === 'number');\n        if (attributes) newOp.attributes = attributes;\n        delta.push(newOp);\n      // Other op should be delete, we could be an insert or retain\n      // Insert + delete cancels out\n      } else if (typeof otherOp['delete'] === 'number' && typeof thisOp.retain === 'number') {\n        delta.push(otherOp);\n      }\n    }\n  }\n  return delta.chop();\n};\n\nDelta.prototype.concat = function (other) {\n  var delta = new Delta(this.ops.slice());\n  if (other.ops.length > 0) {\n    delta.push(other.ops[0]);\n    delta.ops = delta.ops.concat(other.ops.slice(1));\n  }\n  return delta;\n};\n\nDelta.prototype.diff = function (other, index) {\n  if (this.ops === other.ops) {\n    return new Delta();\n  }\n  var strings = [this, other].map(function (delta) {\n    return delta.map(function (op) {\n      if (op.insert != null) {\n        return typeof op.insert === 'string' ? op.insert : NULL_CHARACTER;\n      }\n      var prep = (delta === other) ? 'on' : 'with';\n      throw new Error('diff() called ' + prep + ' non-document');\n    }).join('');\n  });\n  var delta = new Delta();\n  var diffResult = diff(strings[0], strings[1], index);\n  var thisIter = op.iterator(this.ops);\n  var otherIter = op.iterator(other.ops);\n  diffResult.forEach(function (component) {\n    var length = component[1].length;\n    while (length > 0) {\n      var opLength = 0;\n      switch (component[0]) {\n        case diff.INSERT:\n          opLength = Math.min(otherIter.peekLength(), length);\n          delta.push(otherIter.next(opLength));\n          break;\n        case diff.DELETE:\n          opLength = Math.min(length, thisIter.peekLength());\n          thisIter.next(opLength);\n          delta['delete'](opLength);\n          break;\n        case diff.EQUAL:\n          opLength = Math.min(thisIter.peekLength(), otherIter.peekLength(), length);\n          var thisOp = thisIter.next(opLength);\n          var otherOp = otherIter.next(opLength);\n          if (equal(thisOp.insert, otherOp.insert)) {\n            delta.retain(opLength, op.attributes.diff(thisOp.attributes, otherOp.attributes));\n          } else {\n            delta.push(otherOp)['delete'](opLength);\n          }\n          break;\n      }\n      length -= opLength;\n    }\n  });\n  return delta.chop();\n};\n\nDelta.prototype.eachLine = function (predicate, newline) {\n  newline = newline || '\\n';\n  var iter = op.iterator(this.ops);\n  var line = new Delta();\n  var i = 0;\n  while (iter.hasNext()) {\n    if (iter.peekType() !== 'insert') return;\n    var thisOp = iter.peek();\n    var start = op.length(thisOp) - iter.peekLength();\n    var index = typeof thisOp.insert === 'string' ?\n      thisOp.insert.indexOf(newline, start) - start : -1;\n    if (index < 0) {\n      line.push(iter.next());\n    } else if (index > 0) {\n      line.push(iter.next(index));\n    } else {\n      if (predicate(line, iter.next(1).attributes || {}, i) === false) {\n        return;\n      }\n      i += 1;\n      line = new Delta();\n    }\n  }\n  if (line.length() > 0) {\n    predicate(line, {}, i);\n  }\n};\n\nDelta.prototype.transform = function (other, priority) {\n  priority = !!priority;\n  if (typeof other === 'number') {\n    return this.transformPosition(other, priority);\n  }\n  var thisIter = op.iterator(this.ops);\n  var otherIter = op.iterator(other.ops);\n  var delta = new Delta();\n  while (thisIter.hasNext() || otherIter.hasNext()) {\n    if (thisIter.peekType() === 'insert' && (priority || otherIter.peekType() !== 'insert')) {\n      delta.retain(op.length(thisIter.next()));\n    } else if (otherIter.peekType() === 'insert') {\n      delta.push(otherIter.next());\n    } else {\n      var length = Math.min(thisIter.peekLength(), otherIter.peekLength());\n      var thisOp = thisIter.next(length);\n      var otherOp = otherIter.next(length);\n      if (thisOp['delete']) {\n        // Our delete either makes their delete redundant or removes their retain\n        continue;\n      } else if (otherOp['delete']) {\n        delta.push(otherOp);\n      } else {\n        // We retain either their retain or insert\n        delta.retain(length, op.attributes.transform(thisOp.attributes, otherOp.attributes, priority));\n      }\n    }\n  }\n  return delta.chop();\n};\n\nDelta.prototype.transformPosition = function (index, priority) {\n  priority = !!priority;\n  var thisIter = op.iterator(this.ops);\n  var offset = 0;\n  while (thisIter.hasNext() && offset <= index) {\n    var length = thisIter.peekLength();\n    var nextType = thisIter.peekType();\n    thisIter.next();\n    if (nextType === 'delete') {\n      index -= Math.min(length, index - offset);\n      continue;\n    } else if (nextType === 'insert' && (offset < index || !priority)) {\n      index += length;\n    }\n    offset += length;\n  }\n  return index;\n};\n\n\nmodule.exports = Delta;\n","export var createIsSameValueZero = function createIsSameValueZero() {\n  /**\n   * @function isSameValueZero\n   *\n   * @description\n   * are the objects passed strictly equal or both NaN\n   *\n   * @param {*} objectA the object to compare against\n   * @param {*} objectB the object to test\n   * @returns {boolean} are the objects equal by the SameValueZero principle\n   */\n  return function (objectA, objectB) {\n    return objectA === objectB || objectA !== objectA && objectB !== objectB;\n  };\n};\n\n/**\n * @function toPairs\n *\n * @param {Map|Set} iterable the iterable to convert to [key, value] pairs (entries)\n * @returns {{keys: Array<*>, values: Array<*>}} the [key, value] pairs\n */\nexport var toPairs = function toPairs(iterable) {\n  var pairs = { keys: new Array(iterable.size), values: new Array(iterable.size) };\n\n  var index = 0;\n\n  iterable.forEach(function (value, key) {\n    pairs.keys[index] = key;\n    pairs.values[index++] = value;\n  });\n\n  return pairs;\n};\n\n/**\n * @function areIterablesEqual\n *\n * @description\n * determine if the iterables are equivalent in value\n *\n * @param {Map|Set} objectA the object to test\n * @param {Map|Set} objectB the object to test against\n * @param {function} comparator the comparator to determine deep equality\n * @param {boolean} shouldCompareKeys should the keys be tested in the equality comparison\n * @returns {boolean} are the objects equal in value\n */\nexport var areIterablesEqual = function areIterablesEqual(objectA, objectB, comparator, shouldCompareKeys) {\n  if (objectA.size !== objectB.size) {\n    return false;\n  }\n\n  var pairsA = toPairs(objectA);\n  var pairsB = toPairs(objectB);\n\n  return shouldCompareKeys ? comparator(pairsA.keys, pairsB.keys) && comparator(pairsA.values, pairsB.values) : comparator(pairsA.values, pairsB.values);\n};","// utils\nimport { areIterablesEqual, createIsSameValueZero } from './utils';\n\nvar HAS_MAP_SUPPORT = typeof Map === 'function';\nvar HAS_SET_SUPPORT = typeof Set === 'function';\n\nvar isSameValueZero = createIsSameValueZero();\n\nvar createComparator = function createComparator(createIsEqual) {\n  var isEqual = typeof createIsEqual === 'function' ? createIsEqual(comparator) : comparator; // eslint-disable-line\n\n  /**\n   * @function comparator\n   *\n   * @description\n   * compare the value of the two objects and return true if they are equivalent in values\n   *\n   * @param {*} objectA the object to test against\n   * @param {*} objectB the object to test\n   * @returns {boolean} are objectA and objectB equivalent in value\n   */\n  function comparator(objectA, objectB) {\n    if (isSameValueZero(objectA, objectB)) {\n      return true;\n    }\n\n    var typeOfA = typeof objectA;\n\n    if (typeOfA !== typeof objectB) {\n      return false;\n    }\n\n    if (typeOfA === 'object' && objectA && objectB) {\n      var arrayA = Array.isArray(objectA);\n      var arrayB = Array.isArray(objectB);\n\n      var index = void 0;\n\n      if (arrayA || arrayB) {\n        if (arrayA !== arrayB || objectA.length !== objectB.length) {\n          return false;\n        }\n\n        for (index = 0; index < objectA.length; index++) {\n          if (!isEqual(objectA[index], objectB[index])) {\n            return false;\n          }\n        }\n\n        return true;\n      }\n\n      var dateA = objectA instanceof Date;\n      var dateB = objectB instanceof Date;\n\n      if (dateA || dateB) {\n        return dateA === dateB && isSameValueZero(objectA.getTime(), objectB.getTime());\n      }\n\n      var regexpA = objectA instanceof RegExp;\n      var regexpB = objectB instanceof RegExp;\n\n      if (regexpA || regexpB) {\n        return regexpA === regexpB && objectA.source === objectB.source && objectA.global === objectB.global && objectA.ignoreCase === objectB.ignoreCase && objectA.multiline === objectB.multiline;\n      }\n\n      if (HAS_MAP_SUPPORT) {\n        var mapA = objectA instanceof Map;\n        var mapB = objectB instanceof Map;\n\n        if (mapA || mapB) {\n          return mapA === mapB && areIterablesEqual(objectA, objectB, comparator, true);\n        }\n      }\n\n      if (HAS_SET_SUPPORT) {\n        var setA = objectA instanceof Set;\n        var setB = objectB instanceof Set;\n\n        if (setA || setB) {\n          return setA === setB && areIterablesEqual(objectA, objectB, comparator, false);\n        }\n      }\n\n      var keysA = Object.keys(objectA);\n\n      if (keysA.length !== Object.keys(objectB).length) {\n        return false;\n      }\n\n      var key = void 0;\n\n      for (index = 0; index < keysA.length; index++) {\n        key = keysA[index];\n\n        if (!Object.prototype.hasOwnProperty.call(objectB, key) || !isEqual(objectA[key], objectB[key])) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  return comparator;\n};\n\nexport default createComparator;","// comparator\nimport createComparator from './comparator';\n\n// utils\nimport { createIsSameValueZero } from './utils';\n\nexport var createCustomEqual = createComparator;\n\nexport var deepEqual = createComparator();\nexport var sameValueZeroEqual = createIsSameValueZero();\nexport var shallowEqual = createComparator(createIsSameValueZero);\n\nexport default {\n  createCustom: createCustomEqual,\n  deep: deepEqual,\n  sameValueZero: sameValueZeroEqual,\n  shallow: shallowEqual\n};","import EventDispatcher from './eventdispatcher';\nimport Delta from 'quill-delta';\nimport deltaOp from 'quill-delta/lib/op';\nimport { shallowEqual, deepEqual } from 'fast-equals';\n\nconst SOURCE_API = 'api';\nconst SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst empty = {};\n\nexport default class Editor extends EventDispatcher {\n\n  constructor(options = {}) {\n    super();\n    this.selection = null;\n    this.activeFormats = empty;\n    setContents(this, options.contents || this.delta().insert('\\n'));\n    if (options.modules) options.modules.forEach(module => module(this));\n  }\n\n  delta(ops) {\n    return new Delta(ops);\n  }\n\n  getContents(from = 0, to = this.length) {\n    [ from, to ] = this._normalizeArguments(from, to);\n    return this.contents.slice(from, to);\n  }\n\n  getText(from = 0, to = this.length) {\n    [ from, to ] = this._normalizeArguments(from, to);\n    return this.text.slice(from, to);\n  }\n\n  getChange(producer) {\n    let change = this.delta();\n    this.updateContents = singleChange => {\n      if (singleChange.ops.length) {\n        change = change.compose(singleChange);\n        return singleChange;\n      } else {\n        return null;\n      }\n    };\n    producer(this);\n    delete this.updateContents;\n    return change;\n  }\n\n  transaction(producer, source, selection) {\n    const change = this.getChange(producer);\n    return this.updateContents(change, source, selection);\n  }\n\n  setContents(newContents, source, selection) {\n    const change = this.contents.diff(newContents);\n    return this.updateContents(change, source, selection);\n  }\n\n  setText(text, source, selection) {\n    return this.setContents(this.delta().insert(text + '\\n'), source, selection);\n  }\n\n  insertText(from, to, text, formats, source, selection) {\n    [ from, to, text, formats, source, selection ] =\n      this._normalizeArguments(from, to, text, formats, source, selection);\n    if (selection == null) selection = from + text.length;\n    let change = this.delta().retain(from).delete(to - from);\n\n    if (text === '\\n') {\n      change.insert('\\n', formats || this.getLineFormat(from));\n    } else {\n      const lineFormat = text.indexOf('\\n') === -1 ? null : this.getLineFormat(from);\n      const textFormat = formats || this.getTextFormat(from);\n      text.split('\\n').forEach((line, i) => {\n        if (i) change.insert('\\n', lineFormat);\n        line.length && change.insert(line, textFormat);\n      });\n    }\n\n    change = cleanDelete(this, from, to, change);\n    return this.updateContents(change, source, selection);\n  }\n\n  insertEmbed(from, to, embed, value, source, selection) {\n    [ from, to, embed, value, source, selection ] =\n      this._normalizeArguments(from, to, embed, value, source, selection);\n    if (selection == null) selection = from + 1;\n    let change = this.delta().retain(from).delete(to - from).insert({ [embed]: value });\n    change = cleanDelete(this, from, to, change);\n    return this.updateContents(change, source, selection);\n  }\n\n  deleteText(from, to, source, selection) {\n    [ from, to, source, selection ] = this._normalizeArguments(from, to, source, selection);\n    if (selection == null) selection = from;\n    let change = this.delta().retain(from).delete(to - from);\n    change = cleanDelete(this, from, to, change);\n    return this.updateContents(change, source, from);\n  }\n\n  getLineFormat(from, to) {\n    [ from, to ] = this._normalizeArguments(from, to);\n    let formats;\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!line.attributes) formats = {};\n      else if (!formats) formats = { ...line.attributes };\n      else formats = combineFormats(formats, line.attributes);\n    });\n\n    return formats;\n  }\n\n  getTextFormat(from, to) {\n    [ from, to ] = this._normalizeArguments(from, to);\n    let formats;\n\n    this.contents.getOps(from, to).forEach(({ op }) => {\n      if (op.insert === '\\n') return;\n      if (!op.attributes) formats = {};\n      else if (!formats) formats = { ...op.attributes };\n      else formats = combineFormats(formats, op.attributes);\n    });\n\n    if (!formats) formats = {};\n\n    if (this.activeFormats !== empty) {\n      Object.keys(this.activeFormats).forEach(name => {\n        const value = this.activeFormats[name];\n        if (value === null) delete formats[name];\n        else formats[name] = value;\n      });\n    }\n\n    return formats;\n  }\n\n  getFormat(from, to) {\n    return { ...this.getTextFormat(from, to), ...this.getLineFormat(from, to) };\n  }\n\n  formatLine(from, to, formats, source) {\n    [ from, to, formats, source ] = this._normalizeArguments(from, to, formats, source);\n    const change = this.delta();\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!change.ops.length) change.retain(line.endIndex - 1);\n      else change.retain(line.endIndex - line.startIndex - 1);\n      // Clear out old formats on the line\n      Object.keys(line.attributes).forEach(name => !formats[name] && (formats[name] = null));\n      change.retain(1, formats);\n    });\n\n    return change.ops.length ? this.updateContents(change, source) : this.contents;\n  }\n\n  formatText(from, to, formats, source) {\n    [ from, to, formats, source ] = this._normalizeArguments(from, to, formats, source);\n    if (from === to) {\n      if (this.activeFormats === empty) this.activeFormats = {};\n      Object.keys(formats).forEach(key => this.activeFormats[key] = formats[key]);\n      return;\n    }\n    Object.keys(formats).forEach(name => formats[name] === false && (formats[name] = null));\n    const change = this.delta().retain(from);\n    this.getText(from, to).split('\\n').forEach(line => {\n      line.length && change.retain(line.length, formats).retain(1);\n    });\n    change.chop();\n\n    return this.updateContents(change, source);\n  }\n\n  toggleLineFormat(from, to, format, source) {\n    [ from, to, format, source ] = this._normalizeArguments(from, to, format, source);\n    const existing = this.getLineFormat(from, to);\n    if (deepEqual(existing, format)) {\n      Object.keys(format).forEach(key => format[key] = null);\n    }\n    return this.formatLine(from, to, format, source);\n  }\n\n  toggleTextFormat(from, to, format, source) {\n    [ from, to, format, source ] = this._normalizeArguments(from, to, format, source);\n    const existing = this.getTextFormat(from, to);\n    const isSame = Object.keys(format).every(key => format[key] === existing[key]);\n    if (isSame) {\n      Object.keys(format).forEach(key => format[key] = null);\n    }\n    return this.formatText(from, to, format, source);\n  }\n\n  removeFormat(from, to, source) {\n    [ from, to, source ] = this._normalizeArguments(from, to, source);\n    const formats = {};\n\n    this.contents.getOps(from, to).forEach(({ op }) => {\n      op.attributes && Object.keys(op.attributes).forEach(key => formats[key] = null);\n    });\n\n    let change = this.delta().retain(from).retain(to - from, formats);\n\n    // If the last block was not captured be sure to clear that too\n    this.contents.getLines(from, to).forEach(line => {\n      const formats = {};\n      Object.keys(line.attributes).forEach(key => formats[key] = null);\n      change = change.compose(this.delta().retain(line.endIndex - 1).retain(1, formats));\n    });\n\n    return this.updateContents(change, source);\n  }\n\n  updateContents(change, source = SOURCE_API, selection) {\n    const oldContents = this.contents;\n    const contents = normalizeContents(oldContents.compose(change));\n    const length = contents.length();\n    const oldSelection = this.selection;\n    if (!selection) selection = this.selection ? this.selection.map(i => change.transform(i)) : oldSelection;\n    selection = selection && this.getSelectedRange(selection, length - 1);\n\n    const changeEvent = { contents, oldContents, change, selection, oldSelection, source };\n    const selectionChanged = shallowEqual(oldSelection, selection);\n\n    if (change.ops.length && this.fire('text-changing', changeEvent)) {\n      setContents(this, contents);\n      if (selection) this.selection = selection;\n\n      if (source !== SOURCE_SILENT) {\n        this.fire('text-change', changeEvent);\n        if (selectionChanged) this.fire('selection-change', changeEvent);\n      }\n      this.fire('editor-change', changeEvent);\n      return change;\n    } else {\n      return null;\n    }\n  }\n\n  setSelection(selection, source = SOURCE_USER) {\n    const oldSelection = this.selection;\n    selection = this.getSelectedRange(selection);\n    this.activeFormats = empty;\n\n    if (shallowEqual(oldSelection, selection)) return false;\n\n    this.selection = selection;\n    const event = { selection, oldSelection, source };\n\n    if (source !== SOURCE_SILENT) this.fire('selection-change', event);\n    this.fire('editor-change', event);\n    return true;\n  }\n\n  getSelectedRange(range = this.selection, max = this.length - 1) {\n    if (range == null) return range;\n    if (typeof range === 'number') range = [ range, range ];\n    if (range[0] > range[1]) [range[0], range[1]] = [range[1], range[0]];\n    return range.map(index => Math.max(0, Math.min(max, index)));\n  }\n\n  /**\n   * Normalizes range values to a proper range if it is not already. A range is a `from` and a `to` index, e.g. 0, 4.\n   * This will ensure the lower index is first. Example usage:\n   * editor._normalizeArguments(5); // [5, 5]\n   * editor._normalizeArguments(-4, 100); // for a doc with length 10, [0, 10]\n   * editor._normalizeArguments(25, 18); // [18, 25]\n   * editor._normalizeArguments([12, 13]); // [12, 13]\n   * editor._normalizeArguments(5, { bold: true }); // [5, 5, { bold: true }]\n   */\n  _normalizeArguments(from, to, ...rest) {\n    if (Array.isArray(from)) {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      [from, to] = from;\n      if (to === undefined) to = from;\n    } else if (typeof from !== 'number') {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      if (from !== undefined || rest.length) rest.unshift(from);\n      from = to = 0;\n    } else if (typeof to !== 'number') {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      to = from;\n    }\n    from = Math.max(0, Math.min(this.length, ~~from));\n    to = Math.max(0, Math.min(this.length, ~~to));\n    if (from > to) {\n      [from, to] = [to, from];\n    }\n    return [from, to].concat(rest);\n  }\n}\n\nfunction cleanDelete(editor, from, to, change) {\n  if (from !== to) {\n    const line = editor.contents.getLine(from);\n    if (!line.contents.length() && to === from + 1) return change;\n    const lineFormat = editor.getLineFormat(from);\n    if (!deepEqual(lineFormat, editor.getLineFormat(to))) {\n      const lineChange = editor.getChange(() => editor.formatLine(to, lineFormat))\n      change = change.compose(change.transform(lineChange));\n    }\n  }\n  return change;\n}\n\nfunction normalizeContents(contents) {\n  if (!contents.ops.length || contents.ops[contents.ops.length - 1].insert.slice(-1) !== '\\n') contents.insert('\\n');\n  return contents;\n}\n\nfunction setContents(editor, contents) {\n  normalizeContents(contents);\n  contents.push = function() { return this; } // freeze from modification\n  editor.contents = contents;\n  editor.length = contents.length();\n  editor.text = contents\n    .filter(op => typeof op.insert === 'string')\n    .map(op => op.insert)\n    .join('')\n    .slice(0, -1); // remove the trailing newline\n}\n\nfunction combineFormats(formats, combined) {\n  return Object.keys(combined).reduce(function(merged, name) {\n    if (formats[name] == null) return merged;\n    if (combined[name] === formats[name]) {\n      merged[name] = combined[name];\n    } else if (Array.isArray(combined[name])) {\n      if (combined[name].indexOf(formats[name]) < 0) {\n        merged[name] = combined[name].concat([formats[name]]);\n      }\n    } else {\n      merged[name] = [combined[name], formats[name]];\n    }\n    return merged;\n  }, {});\n}\n\nDelta.prototype.getLines = function(from, to, predicate) {\n  let startIndex = 0;\n  const lines = [];\n  this.eachLine((contents, attributes, number) => {\n    if (startIndex > to || (startIndex === to && from !== to)) return false;\n    const endIndex = startIndex + contents.length() + 1;\n    if (endIndex > from) {\n      lines.push({ contents, attributes, number, startIndex, endIndex });\n    }\n    startIndex = endIndex;\n  });\n  return lines;\n}\n\nDelta.prototype.getLine = function(at) {\n  return this.getLines(at, at)[0];\n}\n\nDelta.prototype.getOps = function(from, to) {\n  let startIndex = 0;\n  const ops = [];\n  this.ops.some(op => {\n    if (startIndex >= to) return true;\n    const endIndex = startIndex + deltaOp.length(op);\n    if (endIndex > from || (from === to && endIndex === to)) {\n      ops.push({ op, startIndex, endIndex });\n    }\n    startIndex = endIndex;\n  });\n  return ops;\n}\n\nDelta.prototype.getOp = function(from) {\n  return this.getOps(from, from)[0];\n}\n","\nexport function h(name, attributes) {\n  var rest = [];\n  var children = [];\n  var length = arguments.length;\n\n  while (length-- > 2) rest.push(arguments[length]);\n\n  while (rest.length) {\n    var node = rest.pop();\n    if (node && node.pop) {\n      for (length = node.length; length--; ) {\n        rest.push(node[length]);\n      }\n    } else if (node != null && node !== true && node !== false) {\n      children.push(node);\n    }\n  }\n\n  return typeof name === \"function\"\n    ? name(attributes || {}, children)\n    : {\n        name,\n        attributes: attributes || {},\n        children: children\n      };\n}\n\nexport function render(node, element) {\n  element = element ?\n    patch(element.parentNode, element, node) :\n    patch(null, null, node);\n  return element;\n}\n\n\nfunction clone(target, source) {\n  var obj = {};\n\n  for (var i in target) obj[i] = target[i];\n  for (var i in source) obj[i] = source[i];\n\n  return obj;\n}\n\nfunction updateAttribute(element, name, value, isSvg) {\n  if (name in element && name !== \"list\" && !isSvg) {\n    element[name] = value == null ? \"\" : value;\n  } else if (value != null && value !== false) {\n    element.setAttribute(name, value === true ? '' : value);\n  }\n\n  if (value == null || value === false) {\n    element.removeAttribute(name);\n  }\n}\n\nfunction createElement(node, isSvg) {\n  var element =\n    typeof node === \"string\" || typeof node === \"number\"\n      ? document.createTextNode(node)\n      : (isSvg = isSvg || node.name === \"svg\")\n        ? document.createElementNS(\n            \"http://www.w3.org/2000/svg\",\n            node.name\n          )\n        : document.createElement(node.name);\n\n  var attributes = node.attributes;\n  if (attributes) {\n    for (var i = 0; i < node.children.length; i++) {\n      element.appendChild(createElement(node.children[i], isSvg));\n    }\n\n    for (var name in attributes) {\n      updateAttribute(element, name, attributes[name], isSvg);\n    }\n  }\n\n  return element;\n}\n\nfunction getElementAttributes(element, isSvg) {\n  var attributes = {};\n  for (var i = 0; i < element.attributes.length; i++) {\n    var { name, value } = element.attributes[i];\n    if (name in element && name !== \"list\" && !isSvg) {\n      attributes[name] = element[name];\n    } else {\n      attributes[name] = value === '' ? true : value;\n    }\n  }\n  return attributes;\n}\n\nfunction updateElement(element, attributes, isSvg) {\n  var oldAttributes = getElementAttributes(element);\n  for (var name in clone(oldAttributes, attributes)) {\n    if (\n      attributes[name] !==\n      (name === \"value\" || name === \"checked\"\n        ? element[name]\n        : oldAttributes[name])\n    ) {\n      updateAttribute(\n        element,\n        name,\n        attributes[name],\n        isSvg\n      )\n    }\n  }\n}\n\nfunction removeElement(parent, element) {\n  parent.removeChild(element);\n}\n\nfunction patch(parent, element, node, isSvg) {\n  var name = element && element.nodeName !== '#text' ? element.nodeName.toLowerCase() : undefined;\n  if (element == null || name !== node.name) {\n    var newElement = createElement(node, isSvg);\n\n    if (parent) {\n      parent.insertBefore(newElement, element);\n      if (element != null) {\n        removeElement(parent, element);\n      }\n    }\n\n    element = newElement;\n  } else if (name == null) {\n    if (element.nodeValue !== node) element.nodeValue = node;\n  } else {\n    updateElement(\n      element,\n      node.attributes,\n      (isSvg = isSvg || node.name === \"svg\")\n    );\n\n    var children = node.children;\n    var i = 0;\n\n    while (i < children.length) {\n      patch(element, element.childNodes[i], children[i], isSvg);\n      i++;\n    }\n\n    while (i < element.childNodes.length) {\n      removeElement(element, element.childNodes[i]);\n    }\n  }\n  return element;\n}\n\n","import { h } from './vdom';\n\n\nexport const paragraph = {\n  name: 'paragraph',\n  selector: 'p',\n  vdom: children => <p>{children}</p>,\n};\n\n\nexport const header = {\n  name: 'header',\n  selector: 'h1, h2, h3, h4, h5, h6',\n  defaultFollows: true,\n  dom: node => ({ header: parseInt(node.nodeName.replace('H', '')) }),\n  vdom: (children, attr) => {\n    const H = `h${attr.header}`;\n    return <H>{children}</H>;\n  },\n};\n\n\nexport const list = {\n  name: 'list',\n  selector: 'ul > li, ol > li',\n  optimize: true,\n  dom: node => {\n    let indent = -1, parent = node.parentNode;\n    const list = parent.nodeName === 'OL' ? 'ordered' : 'bullet';\n    while (parent) {\n      if (/^UL|OL$/.test(parent.nodeName)) indent++;\n      else if (parent.nodeName !== 'LI') break;\n      parent = parent.parentNode;\n    }\n    const attr = { list };\n    if (indent) attr.indent = indent;\n    return attr;\n  },\n  vdom: lists => {\n    const topLevelChildren = [];\n    const levels = [];\n    // e.g. levels = [ul, li, ul, li]\n\n    lists.forEach(([children, attr]) => {\n      const List = attr.list === 'ordered' ? 'ol' : 'ul';\n      const index = Math.min((attr.indent || 0) * 2, levels.length);\n      const item = <li>{children}</li>;\n      let list = levels[index];\n      if (list && list.name === List) {\n        list.children.push(item);\n      } else {\n        list = <List>{item}</List>;\n        const childrenArray = index ? levels[index - 1].children : topLevelChildren;\n        childrenArray.push(list);\n        levels[index] = list;\n      }\n      levels[index + 1] = item;\n      levels.length = index + 2;\n    });\n\n    return topLevelChildren;\n  },\n};\n\nexport const blockquote = {\n  name: 'blockquote',\n  selector: 'blockquote',\n  vdom: children => <blockquote>{children}</blockquote>,\n};\n\n\nexport const container = {\n  name: 'container',\n  selector: 'div',\n  vdom: (children, attr) => <div contenteditable=\"true\">\n    {children && children.length && children || paragraph.vdom()}\n  </div>,\n};\n","import { h } from './vdom';\n\n\nexport const bold = {\n  name: 'bold',\n  selector: 'strong, b',\n  vdom: children => <strong>{children}</strong>,\n};\n\n\nexport const italics = {\n  name: 'italics',\n  selector: 'em, i',\n  vdom: children => <em>{children}</em>,\n};\n\n\nexport const link = {\n  name: 'link',\n  selector: 'a[href]',\n  attr: node => node.href,\n  vdom: (children, attr) => <a href={attr.link} target=\"_blank\">{children}</a>,\n};\n","import { h } from './vdom';\n\n\nexport const image = {\n  name: 'image',\n  selector: 'img',\n  dom: node => node.src,\n  vdom: value => <img src={value}/>,\n};\n\n// To represent a collaborator's cursor, for use in decorators\nexport const cursor = {\n  name: 'cursor',\n  selector: 'span.cursor',\n  dom: node => ({ name: node.dataset.name, color: node.style.backgroundColor }),\n  vdom: value => {\n    return <span class=\"cursor\" data-name={value.name} style={ `background-color: ${value.color}` }></span>\n  },\n};\n","import { paragraph, header, list, blockquote, container } from './blocks';\nimport { bold, italics, link } from './markups';\nimport { image } from './embeds';\n\n\nexport default {\n  blocks: [ paragraph, header, list, blockquote, container ],\n  markups: [ bold, italics, link ],\n  embeds: [ image ],\n};\n","const indexOf = [].indexOf;\n\n// Get the range (a tuple of indexes) for this view from the browser selection\nexport function getSelection(view) {\n  const root = view.root;\n  const selection = root.ownerDocument.defaultView.getSelection();\n\n  if (!root.contains(selection.anchorNode)) {\n    return null;\n  } else {\n    const anchorIndex = getNodeIndex(view, selection.anchorNode);\n    const focusIndex = selection.anchorNode === selection.focusNode ?\n          anchorIndex : getNodeIndex(view, selection.focusNode);\n\n    return [\n      anchorIndex + selection.anchorOffset,\n      focusIndex + selection.focusOffset,\n    ];\n  }\n}\n\n// Set the browser selection to the range (a tuple of indexes) of this view\nexport function setSelection(view, range) {\n  const root = view.root;\n  const selection = root.ownerDocument.defaultView.getSelection();\n  const hasFocus = root.contains(root.ownerDocument.activeElement);\n\n  if (range == null) {\n    if (hasFocus) {\n      root.blur();\n      selection.setBaseAndExtent(null, 0, null, 0);\n    }\n  } else {\n    const [ anchorNode, anchorOffset, focusNode, focusOffset ] = getNodesForRange(view, range);\n    selection.setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset);\n    if (!hasFocus) root.focus();\n  }\n}\n\n// Get a browser range object for the given editor range tuple\nexport function getBrowserRange(view, range) {\n  if (range[0] > range[1]) range = [ range[1], range[0] ];\n  const [ anchorNode, anchorOffset, focusNode, focusOffset ] = getNodesForRange(view, range);\n  const browserRange = document.createRange();\n  browserRange.setStart(anchorNode, anchorOffset);\n  browserRange.setEnd(focusNode, focusOffset);\n  return browserRange;\n}\n\n\n// Get the browser nodes and offsets for the range (a tuple of indexes) of this view\nexport function getNodesForRange(view, range) {\n  if (range == null) {\n    return [ null, 0, null, 0 ];\n  } else {\n    const [ anchorNode, anchorOffset ] = getNodeAndOffset(view, range[0]);\n    const [ focusNode, focusOffset ] = range[0] === range[1] ?\n          [ anchorNode, anchorOffset ] : getNodeAndOffset(view, range[1]);\n\n    return [ anchorNode, anchorOffset, focusNode, focusOffset ];\n  }\n}\n\nexport function getNodeAndOffset(view, index) {\n  const root = view.root;\n  const blocksSelector = view.paper.blocks.selector;\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      return (node.nodeType === Node.TEXT_NODE || node.offsetParent) &&\n        NodeFilter.FILTER_ACCEPT ||\n        NodeFilter.FILTER_REJECT;\n    }\n  });\n\n  let count = 0, node, firstBlockSeen = false;\n  walker.currentNode = root;\n  while ((node = walker.nextNode())) {\n    if (node.nodeType === Node.TEXT_NODE) {\n      const size = node.nodeValue.length\n      if (index <= count + size) return [ node, index - count ];\n      count += size;\n    } else if (node.matches(blocksSelector)) {\n      if (firstBlockSeen) count += 1;\n      else firstBlockSeen = true;\n\n      // If the selection lands at the beginning of a block, and the first node isn't a text node, place the selection\n      if (count === index && (!node.firstChild || node.firstChild.nodeType !== Node.TEXT_NODE)) {\n        return [ node, 0 ];\n      }\n    } else if (node.nodeName === 'BR' && node.parentNode.lastChild !== node) {\n      count += 1;\n      // If the selection lands after this br, and the next node isn't a text node, place the selection\n      if (count === index && (!node.nextSibling || node.nextSibling.nodeType !== Node.TEXT_NODE)) {\n        return [ node.parentNode, indexOf.call(node.parentNode.childNodes, node) + 1 ];\n      }\n    }\n  }\n  return [ null, 0 ];\n}\n\n// Get the index the node starts at in the content\nexport function getNodeIndex(view, node) {\n  const root = view.root;\n  const blocksSelector = view.paper.blocks.selector;\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      return (node.nodeType === Node.TEXT_NODE || node.offsetParent) &&\n        NodeFilter.FILTER_ACCEPT ||\n        NodeFilter.FILTER_REJECT;\n    }\n  });\n\n  walker.currentNode = node;\n  let index = node.nodeType === Node.ELEMENT_NODE ? 0 : -1;\n  while ((node = walker.previousNode())) {\n    if (node.nodeType === Node.TEXT_NODE) index += node.nodeValue.length;\n    else if (node.nodeName === 'BR' && node.parentNode.lastChild !== node) index++;\n    else if (node !== root && node.matches(blocksSelector)) index++;\n  }\n  return index;\n}\n\n","/*!\n * escape-html\n * Copyright(c) 2012-2013 TJ Holowaychuk\n * Copyright(c) 2015 Andreas Lubbe\n * Copyright(c) 2015 Tiancheng \"Timothy\" Gu\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module variables.\n * @private\n */\n\nvar matchHtmlRegExp = /[\"'&<>]/;\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = escapeHtml;\n\n/**\n * Escape special characters in the given string of html.\n *\n * @param  {string} string The string to escape for inserting into HTML\n * @return {string}\n * @public\n */\n\nfunction escapeHtml(string) {\n  var str = '' + string;\n  var match = matchHtmlRegExp.exec(str);\n\n  if (!match) {\n    return str;\n  }\n\n  var escape;\n  var html = '';\n  var index = 0;\n  var lastIndex = 0;\n\n  for (index = match.index; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34: // \"\n        escape = '&quot;';\n        break;\n      case 38: // &\n        escape = '&amp;';\n        break;\n      case 39: // '\n        escape = '&#39;';\n        break;\n      case 60: // <\n        escape = '&lt;';\n        break;\n      case 62: // >\n        escape = '&gt;';\n        break;\n      default:\n        continue;\n    }\n\n    if (lastIndex !== index) {\n      html += str.substring(lastIndex, index);\n    }\n\n    lastIndex = index + 1;\n    html += escape;\n  }\n\n  return lastIndex !== index\n    ? html + str.substring(lastIndex, index)\n    : html;\n}\n","import Delta from 'quill-delta';\nimport { deepEqual } from 'fast-equals';\nimport escape from 'escape-html';\nimport { h } from './vdom';\n\nconst br = <br/>;\nconst voidElements = {\n  area: true, base: true, br: true, col: true, embed: true, hr: true, img: true, input: true,\n  link: true, meta: true, param: true, source: true, track: true, wbr: true\n};\n\n\nexport function deltaToVdom(view, delta) {\n  const paper = view.paper;\n  const { blocks, markups, embeds } = paper;\n  const blockData = [];\n\n  delta.eachLine((line, attr) => {\n    let inlineChildren = [];\n\n    // Collect block children\n    line.forEach(op => {\n      if (op.insert) {\n        let children = [];\n        if (typeof op.insert === 'string') {\n          op.insert.split(/\\r/).forEach((child, i) => {\n            if (i !== 0) children.push(br);\n            child && children.push(child.replace(/  /g, '\\xA0 ').replace(/^ | $/g, '\\xA0'));\n          });\n        } else {\n          const embed = embeds.find(op.insert);\n          if (embed) {\n            const node = embed.vdom.call(paper, op.insert[embed.name]);\n            children.push(node);\n          }\n        }\n\n        if (op.attributes) {\n          // Sort them by the order found in markups and be efficient\n          Object.keys(op.attributes).sort((a, b) => markups.priority(b) - markups.priority(a)).forEach(name => {\n            const markup = markups.get(name);\n            if (markup) {\n              const node = markup.vdom.call(paper, children, op.attributes);\n              node.markup = markup; // Store for merging\n              children = [ node ];\n            }\n          });\n        }\n        inlineChildren.push.apply(inlineChildren, children);\n      }\n    });\n\n    // Merge markups to optimize\n    inlineChildren = mergeChildren(inlineChildren);\n    if (!inlineChildren.length || inlineChildren[inlineChildren.length - 1] === br) {\n      inlineChildren.push(br);\n    }\n\n    let block = blocks.find(attr);\n    if (!block) block = blocks.getDefault();\n\n    blockData.push([ block, inlineChildren, attr ]);\n  });\n\n  // If a block has optimize=true on it, vdom will be called with all sibling nodes of the same block\n  let blockChildren = [], prevBlock;\n  let collect = [];\n  blockData.forEach((data, i) => {\n    const [ block, children, attr ] = data;\n    if (block.optimize) {\n      collect.push([ children, attr ]);\n      const next = blockData[i + 1];\n      if (!next || next[0] !== block) {\n        const children = block.vdom.call(paper, collect);\n        children.forEach(child => child.key = Math.random());\n        blockChildren = blockChildren.concat(children);\n        collect = [];\n      }\n    } else {\n      const node = block.vdom.call(paper, children, attr);\n      blockChildren.push(node);\n    }\n  });\n\n  return blocks.get('container').vdom.call(paper, blockChildren);\n}\n\n\nexport function deltaFromDom(view, root = view.root) {\n  const paper = view.paper;\n  const { blocks, markups, embeds } = paper;\n\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      return (node.nodeType === Node.TEXT_NODE || node.offsetParent) &&\n        NodeFilter.FILTER_ACCEPT ||\n        NodeFilter.FILTER_REJECT;\n    }\n  });\n  const delta = new Delta();\n  let currentBlock, firstBlockSeen = false, node;\n\n  walker.currentNode = root;\n\n  while ((node = walker.nextNode())) {\n    const isBr = node.nodeName === 'BR' && node.parentNode.lastChild !== node;\n\n    if (node.nodeType === Node.TEXT_NODE || isBr) {\n      const text = isBr ? '\\r' : node.nodeValue.replace(/\\xA0/g, ' ');\n      let parent = node.parentNode, attr = {};\n\n      while (parent && !blocks.matches(parent) && parent !== root) {\n        if (markups.matches(parent)) {\n          const markup = markups.find(parent);\n          attr[markup.name] = markup.dom ? markup.dom.call(paper, parent) : true;\n        }\n        parent = parent.parentNode;\n      }\n      delta.insert(text, attr);\n    } else if (embeds.matches(node)) {\n      const embed = embeds.find(node);\n      if (embed) {\n        delta.insert({ [embed.name]: embed.dom.call(paper, node) });\n      }\n    } else if (blocks.matches(node)) {\n      if (firstBlockSeen) delta.insert('\\n', currentBlock);\n      else firstBlockSeen = true;\n      const block = blocks.find(node);\n      if (block !== blocks.getDefault()) {\n        currentBlock = block.dom ? block.dom.call(paper, node) : { [block.name]: true };\n      } else {\n        currentBlock = undefined;\n      }\n    }\n  }\n  delta.insert('\\n', currentBlock);\n  return delta;\n}\n\n/**\n * Converts a delta object into an HTML string based off of the supplied Paper definition.\n */\nexport function deltaToHTML(view) {\n  return childrenToHTML(deltaToVdom(view).children);\n}\n\n/**\n * Converts an HTML string into a delta object based off of the supplied Paper definition.\n */\nexport function deltaFromHTML(view, html) {\n  var doc = new DOMParser().parseFromString('<div>' + html + '</div>', 'text/html');\n  const container = doc.body.firstChild;\n  return deltaFromDom(view, container);\n}\n\n\n// Joins adjacent markup nodes\nfunction mergeChildren(oldChildren) {\n  const children = [];\n  oldChildren.forEach((next, i) => {\n    const prev = children[children.length - 1];\n\n    if (prev && typeof prev !== 'string' && typeof next !== 'string' && prev.markup &&\n      prev.markup === next.markup && deepEqual(prev.attributes, next.attributes))\n    {\n      prev.children = prev.children.concat(next.children);\n    } else {\n      children.push(next);\n    }\n  });\n  return children;\n}\n\n// vdom node to HTML string\nfunction nodeToHTML(node) {\n  const attr = Object.keys(node.attributes)\n    .reduce((attr, name) =>\n      `${attr} ${escape(name)}=\"${escape(node.attributes[name])}\"`, '');\n  const children = childrenToHTML(node.children);\n  const closingTag = children || !voidElements[node.name] ? `</${node.name}>` : '';\n  return `<${node.name}${attr}>${children}${closingTag}`;\n}\n\n// vdom children to HTML string\nfunction childrenToHTML(children) {\n  if (!children || !children.length) return '';\n  return children.reduce((html, child) => html + (child.name ? nodeToHTML(child) : escape(child)), '');\n}\n","\n\nexport class Paper {\n  constructor(types) {\n    this.blocks = new Types();\n    this.markups = new Types();\n    this.embeds = new Types();\n    if (types && types.blocks) types.blocks.forEach(block => this.blocks.add(block));\n    if (types && types.markups) types.markups.forEach(markup => this.markups.add(markup));\n    if (types && types.embeds) types.embeds.forEach(embed => this.embeds.add(embed));\n  }\n}\n\n\nclass Types {\n  constructor() {\n    this.selector = '';\n    this.types = {};\n    this.array = [];\n    this.priorities = {};\n  }\n\n  add(definition, index) {\n    if (!definition.name || !definition.selector || !definition.vdom) {\n      throw new Error('DOMType definitions must include a name, selector, and vdom function');\n    }\n    if (this.types[definition.name]) this.remove(definition.name);\n    this.selector += (this.selector ? ', ' : '') + definition.selector;\n    this.types[definition.name] = definition;\n    if (typeof index !== 'number') {\n      this.priorities[name] = this.array.length;\n      this.array.push(definition);\n    } else {\n      this.array.splice(i, 0, definition);\n      this.array.forEach(({ name }, i) => this.priorities[name] = i);\n    }\n  }\n\n  remove(name) {\n    if (!this.types[name]) return;\n    delete this.types[name];\n    this.array = this.array.filter(domType => domType.name !== name);\n    this.array.forEach(({ name }, i) => this.priorities[name] = i);\n    this.selector = this.array.map(type => type.selector).join(', ');\n  }\n\n  get(name) {\n    return this.types[name];\n  }\n\n  priority(name) {\n    return this.priorities[name];\n  }\n\n  getDefault() {\n    return this.array[0];\n  }\n\n  matches(node) {\n    if (node instanceof Node) {\n      return node.matches(this.selector);\n    } else {\n      return nodeMatches(node, this.selector);\n    }\n  }\n\n  find(nodeOrAttr) {\n    if (nodeOrAttr instanceof Node) {\n      return this.array.find(domType => nodeOrAttr.matches(domType.selector));\n    } else if (nodeOrAttr && typeof nodeOrAttr === 'object') {\n      let domType;\n      Object.keys(nodeOrAttr).some(name => domType = this.get(name));\n      return domType;\n    }\n  }\n}\n","/* global define, KeyboardEvent, module */\n\n(function () {\n\n  var keyboardeventKeyPolyfill = {\n    polyfill: polyfill,\n    keys: {\n      3: 'Cancel',\n      6: 'Help',\n      8: 'Backspace',\n      9: 'Tab',\n      12: 'Clear',\n      13: 'Enter',\n      16: 'Shift',\n      17: 'Control',\n      18: 'Alt',\n      19: 'Pause',\n      20: 'CapsLock',\n      27: 'Escape',\n      28: 'Convert',\n      29: 'NonConvert',\n      30: 'Accept',\n      31: 'ModeChange',\n      32: ' ',\n      33: 'PageUp',\n      34: 'PageDown',\n      35: 'End',\n      36: 'Home',\n      37: 'ArrowLeft',\n      38: 'ArrowUp',\n      39: 'ArrowRight',\n      40: 'ArrowDown',\n      41: 'Select',\n      42: 'Print',\n      43: 'Execute',\n      44: 'PrintScreen',\n      45: 'Insert',\n      46: 'Delete',\n      48: ['0', ')'],\n      49: ['1', '!'],\n      50: ['2', '@'],\n      51: ['3', '#'],\n      52: ['4', '$'],\n      53: ['5', '%'],\n      54: ['6', '^'],\n      55: ['7', '&'],\n      56: ['8', '*'],\n      57: ['9', '('],\n      91: 'OS',\n      93: 'ContextMenu',\n      144: 'NumLock',\n      145: 'ScrollLock',\n      181: 'VolumeMute',\n      182: 'VolumeDown',\n      183: 'VolumeUp',\n      186: [';', ':'],\n      187: ['=', '+'],\n      188: [',', '<'],\n      189: ['-', '_'],\n      190: ['.', '>'],\n      191: ['/', '?'],\n      192: ['`', '~'],\n      219: ['[', '{'],\n      220: ['\\\\', '|'],\n      221: [']', '}'],\n      222: [\"'\", '\"'],\n      224: 'Meta',\n      225: 'AltGraph',\n      246: 'Attn',\n      247: 'CrSel',\n      248: 'ExSel',\n      249: 'EraseEof',\n      250: 'Play',\n      251: 'ZoomOut'\n    }\n  };\n\n  // Function keys (F1-24).\n  var i;\n  for (i = 1; i < 25; i++) {\n    keyboardeventKeyPolyfill.keys[111 + i] = 'F' + i;\n  }\n\n  // Printable ASCII characters.\n  var letter = '';\n  for (i = 65; i < 91; i++) {\n    letter = String.fromCharCode(i);\n    keyboardeventKeyPolyfill.keys[i] = [letter.toLowerCase(), letter.toUpperCase()];\n  }\n\n  function polyfill () {\n    if (!('KeyboardEvent' in window) ||\n        'key' in KeyboardEvent.prototype) {\n      return false;\n    }\n\n    // Polyfill `key` on `KeyboardEvent`.\n    var proto = {\n      get: function (x) {\n        var key = keyboardeventKeyPolyfill.keys[this.which || this.keyCode];\n\n        if (Array.isArray(key)) {\n          key = key[+this.shiftKey];\n        }\n\n        return key;\n      }\n    };\n    Object.defineProperty(KeyboardEvent.prototype, 'key', proto);\n    return proto;\n  }\n\n  if (typeof define === 'function' && define.amd) {\n    define('keyboardevent-key-polyfill', keyboardeventKeyPolyfill);\n  } else if (typeof exports !== 'undefined' && typeof module !== 'undefined') {\n    module.exports = keyboardeventKeyPolyfill;\n  } else if (window) {\n    window.keyboardeventKeyPolyfill = keyboardeventKeyPolyfill;\n  }\n\n})();\n","require('keyboardevent-key-polyfill').polyfill();\n\nvar modifierKeys = {\n  Control: true,\n  Meta: true,\n  Shift: true,\n  Alt: true\n};\n\n\n/**\n * Returns the textual representation of a shortcut given a keyboard event. Examples of shortcuts:\n * Cmd+L\n * Cmd+Shift+M\n * Ctrl+O\n * Backspace\n * T\n * Right\n * Shift+Down\n * Shift+F1\n *\n */\nexports.fromEvent = function(event) {\n  var shortcutArray = [];\n  var key = event.key;\n\n  if (event.metaKey) shortcutArray.push('Cmd');\n  if (event.ctrlKey) shortcutArray.push('Ctrl');\n  if (event.altKey) shortcutArray.push('Alt');\n  if (event.shiftKey) shortcutArray.push('Shift');\n\n  if (!modifierKeys[key]) {\n    // a and A, b and B, should be the same shortcut\n    if (key.length === 1) key = key.toUpperCase();\n    shortcutArray.push(key);\n  }\n\n  return shortcutArray.join('+');\n}\n","import EventDispatcher from './eventdispatcher';\nimport Editor from './editor';\nimport { render } from './view/vdom';\nimport defaultDom from './view/defaultDom';\nimport { getSelection, setSelection, getBrowserRange, getNodeAndOffset, getNodeIndex } from './selection';\nimport { deltaToVdom, deltaFromDom, deltaToHTML } from './view/dom';\nimport { Paper } from './paper';\nimport shortcuts from 'shortcut-string';\nimport { shallowEqual } from 'fast-equals';\nimport diff from 'fast-diff';\n\nconst SOURCE_API = 'api';\nconst SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst isMac = navigator.userAgent.indexOf('Macintosh') !== -1;\nconst modExpr = /Ctrl|Cmd/;\n\n\nexport default class View extends EventDispatcher {\n\n  constructor(editor, options = {}) {\n    super();\n    if (!editor) throw new Error('Editor view requires an editor');\n    this.editor = editor;\n    this.root = document.createElement('div');\n    this.paper = new Paper(options.paper || defaultDom);\n    this.enabled = true;\n    this.isMac = isMac;\n    this._settingEditorSelection = false;\n    this._settingBrowserSelection = false;\n\n    if (options.modules) options.modules.forEach(module => module(this));\n  }\n\n  hasFocus() {\n    return this.root.contains(this.root.ownerDocument.activeElement);\n  }\n\n  focus() {\n    this.root.focus();\n  }\n\n  blur() {\n    this.root.blur();\n  }\n\n  disable() {\n    this.enable(false);\n  }\n\n  enable(enabled = true) {\n    this.enabled = enabled;\n    this.update();\n  }\n\n  getBounds(from, to) {\n    const range = this.editor._normalizeArguments(from, to);\n    const browserRange = getBrowserRange(this, range);\n    if (browserRange.endContainer.nodeType === Node.ELEMENT_NODE) {\n      browserRange.setEnd(browserRange.endContainer, browserRange.endOffset + 1);\n    }\n    return browserRange.getBoundingClientRect();\n  }\n\n  getAllBounds(from, to) {\n    const range = this.editor._normalizeArguments(from, to);\n    const browserRange = getBrowserRange(this, range);\n    if (browserRange.endContainer.nodeType === Node.ELEMENT_NODE) {\n      browserRange.setEnd(browserRange.endContainer, browserRange.endOffset + 1);\n    }\n    return browserRange.getClientRects();\n  }\n\n  getHTML() {\n    return deltaToHTML(this, this.editor.contents);\n  }\n\n  setHTML(html) {\n    this.editor.setContents(deltaFromHTML(this, html));\n  }\n\n  update(changeEvent) {\n    let contents = this.editor.contents;\n    this.decorations = this.editor.getChange(() => this.fire('decorate', this.editor, changeEvent));\n    if (this.decorations.ops.length) {\n      contents = contents.compose(this.decorations);\n      this.reverseDecorations = contents.diff(this.editor.contents);\n    } else {\n      this.reverseDecorations = this.decorations;\n    }\n    const vdom = deltaToVdom(this, contents);\n    if (!this.enabled) vdom.attributes.contenteditable = undefined;\n    this.pauseObserver();\n    this.root = render(vdom, this.root);\n    this.resumeObserver();\n    this.updateBrowserSelection();\n    this.fire('update', changeEvent);\n  }\n\n  updateBrowserSelection() {\n    if (this._settingEditorSelection) return;\n    this._settingBrowserSelection = true;\n    setSelection(this, this.editor.selection);\n    setTimeout(() => this._settingBrowserSelection = false, 20);\n  }\n\n  updateEditorSelection() {\n    if (this._settingBrowserSelection) return this._settingBrowserSelection = false;\n    const range = getSelection(this);\n    this._settingEditorSelection = true;\n    this.editor.setSelection(range);\n    this._settingEditorSelection = false;\n    if (!shallowEqual(range, this.editor.selection)) this.updateBrowserSelection();\n  }\n\n  mount(container) {\n    container.appendChild(this.root);\n    this.root.ownerDocument.execCommand('defaultParagraphSeparator', false, 'p');\n\n    const onKeyDown = event => {\n      let shortcut = shortcuts.fromEvent(event);\n      this.fire(`shortcut:${shortcut}`, event, shortcut);\n      this.fire(`shortcut`, event, shortcut);\n      if (modExpr.test(shortcut)) {\n        shortcut = shortcut.replace(modExpr, 'Mod');\n        this.fire(`shortcut:${shortcut}`, event, shortcut);\n        this.fire(`shortcut`, event, shortcut);\n      }\n    };\n\n    // TODO this was added to replace the mutation observer, however, it does not accurately capture changes that\n    // occur with native changes such as spell-check replacements, cut or delete using the app menus, etc. Paste should\n    // be handled elsewhere (probably?).\n    // const onInput = () => {\n    //   if (!this.editor.selection) throw new Error('How did an input event occur without a selection?');\n    //   const [ from, to ] = this.editor.getSelectedRange();\n    //   const [ node, offset ] = getNodeAndOffset(this, from);\n    //   if (!node || (node.nodeType !== Node.TEXT_NODE && node.nodeName !== 'BR')) {\n    //     return this.update();\n    //     //throw new Error('Text entry should always result in a text node');\n    //   }\n    //   const text = node.nodeValue.slice(offset, offset + 1).replace(/\\xA0/g, ' ');\n    //   const contents = this.editor.contents;\n    //   this.editor.insertText(this.editor.selection, text, null, SOURCE_USER);\n    //   if (this.editor.contents === contents) {\n    //     this.update();\n    //   }\n    // };\n\n    const onSelectionChange = () => {\n      this.updateEditorSelection();\n    };\n\n    this.root.addEventListener('keydown', onKeyDown);\n    // this.root.addEventListener('input', onInput);\n    container.ownerDocument.addEventListener('selectionchange', onSelectionChange);\n\n    const observer = new MutationObserver(list => {\n      const seen = new Set();\n      list = list.filter(m => {\n        if (seen.has(m.target)) return false;\n        seen.add(m.target);\n        return true;\n      });\n\n      const selection = getSelection(this);\n      const mutation = list[0];\n      const isTextChange = list.length === 1 && mutation.type === 'characterData' ||\n        (mutation.type === 'childList' && mutation.addedNodes.length === 1 &&\n         mutation.addedNodes[0].nodeType === Node.TEXT_NODE);\n\n      // Only one text node has been altered. Optimize for this most common case.\n      if (isTextChange) {\n        const change = this.editor.delta();\n        let index = getNodeIndex(this, mutation.target);\n        change.retain(index);\n        if (mutation.type === 'characterData') {\n          const diffs = diff(mutation.oldValue.replace(/\\xA0/g, ' '), mutation.target.nodeValue.replace(/\\xA0/g, ' '));\n          diffs.forEach(([ action, string ]) => {\n            if (action === diff.EQUAL) change.retain(string.length);\n            else if (action === diff.DELETE) change.delete(string.length);\n            else if (action === diff.INSERT) change.insert(string);\n          });\n          change.chop();\n        } else {\n          change.insert(mutation.addedNodes[0].nodeValue.replace(/\\xA0/g, ' '));\n        }\n\n        if (change.ops.length) {\n          // console.log('changing a little', change);\n          editor.updateContents(change, SOURCE_USER, selection);\n        }\n      } else if (list.length === 1 && mutation.type === 'childList' &&\n        addedNodes.length === 1 && mutation.addedNodes[0].nodeType === Node.TEXT_NODE)\n      {\n\n      } else {\n        let contents = deltaFromDom(this, this.root);\n        contents = contents.compose(this.reverseDecorations);\n        const change = this.editor.contents.diff(contents);\n        // console.log('changing a lot (possibly)', change);\n        editor.updateContents(change, SOURCE_USER, selection);\n      }\n    });\n\n    const opts = { characterData: true, characterDataOldValue: true, subtree: true,childList: true, attributes: true };\n    this.resumeObserver = () => observer.observe(this.root, opts);\n    this.pauseObserver = () => observer.disconnect();\n    this.resumeObserver();\n\n\n    // Use mutation tracking during development to catch errors\n    // TODO delete mutation observer\n    let checking = 0;\n    const devObserver = new MutationObserver(list => {\n      if (checking) clearTimeout(checking);\n      checking = setTimeout(() => {\n        checking = 0;\n        const diff = editor.contents.compose(this.decorations).diff(deltaFromDom(view));\n        if (diff.length()) {\n          console.error('Delta out of sync with DOM:', diff);\n        }\n      }, 20);\n    });\n    devObserver.observe(this.root, { characterData: true, characterDataOldValue: true, childList: true, attributes: true, subtree: true });\n\n    this.editor.on('text-changing', event => this._preventIncorrectFormats(event));\n    this.editor.on('text-change', event => this.update(event));\n    this.editor.on('selection-change', () => !this._settingEditorSelection && this.updateBrowserSelection());\n    this.update();\n\n    this.unmount = () => {\n      devObserver.disconnect();\n      observer.disconnect();\n      this.root.removeEventListener('keydown', onKeyDown);\n      // this.root.removeEventListener('input', onInput);\n      this.root.ownerDocument.removeEventListener('selectionchange', onSelectionChange);\n      this.root.remove();\n      this.unmount = () => {};\n    }\n  }\n\n  unmount() {}\n\n\n  _preventIncorrectFormats({ change }) {\n    return !change.ops.some(op => {\n      if (typeof op.insert === 'object') {\n        return !this.paper.embeds.find(op.insert);\n      } else if (op.attributes) {\n        return !(this.paper.blocks.find(op.attributes) || this.paper.markups.find(op.attributes));\n      }\n    });\n  }\n\n}\n","const SOURCE_USER = 'user';\nconst lastWord = /\\w+[^\\w]*$/;\nconst firstWord = /^[^\\w]*\\w+/;\nconst lastLine = /[^\\n]*$/;\nconst firstLine = /^[^\\n]*/;\n\n// Basic text input module. Prevent any actions other than typing characters and handle with the API.\nexport default function input(view) {\n  const editor = view.editor;\n\n  function onEnter(event, shortcut) {\n    if (event.defaultPrevented) return;\n    event.preventDefault();\n    let [ from, to ] = editor.getSelectedRange();\n\n    if (shortcut === 'Shift+Enter') {\n      editor.insertText(from, to, '\\r', null, SOURCE_USER);\n    } else {\n      const line = editor.contents.getLine(from);\n      let attributes = line.attributes;\n      const block = view.paper.blocks.find(attributes);\n      const isDefault = !block;\n      const length = line.contents.length();\n      if (isDefault || block.defaultFollows) {\n        attributes = {};\n      }\n      if (!length && !isDefault && !block.defaultFollows && from === to) {\n        editor.formatLine(from, to, {}, SOURCE_USER);\n      } else {\n        let selection = from + 1;\n        if (from === to && from === line.endIndex - 1) {\n          from++;\n          to++;\n        }\n        editor.insertText(from, to, '\\n', attributes, SOURCE_USER, selection);\n      }\n    }\n  }\n\n  function onBackspace(event, shortcut) {\n    if (event.defaultPrevented) return;\n    event.preventDefault();\n\n    let [ from, to ] = editor.getSelectedRange();\n    if (from + to === 0) {\n      const line = editor.contents.getLine(from);\n      const block = view.paper.blocks.find(line.attributes);\n      if (block) editor.formatLine(0, {}, SOURCE_USER);\n    } else {\n      // The \"from\" block needs to stay the same. The \"to\" block gets merged into it\n      if (from === to) {\n        if (shortcut === 'Alt+Backspace' && view.isMac) {\n          const match = editor.getText().slice(0, from).match(lastWord);\n          if (match) from -= match[0].length;\n        } else if (shortcut === 'Mod+Backspace' && view.isMac) {\n          const match = editor.getText().slice(0, from).match(lastLine);\n          if (match) from -= match[0].length;\n        } else {\n          const line = editor.contents.getLine(from);\n          if (from === line.startIndex) {\n            const block = view.paper.blocks.find(line.attributes);\n            if (block && !block.defaultFollows) {\n              const prevLine = editor.contents.getLine(line.startIndex - 1);\n              const prevBlock = prevLine && view.paper.blocks.find(prevLine.attributes);\n              if (block !== prevBlock) {\n                editor.formatLine(from, {}, SOURCE_USER);\n                return;\n              }\n            }\n          }\n\n          from--;\n        }\n      }\n      editor.deleteText(from, to, SOURCE_USER);\n    }\n  }\n\n  function onDelete(event, shortcut) {\n    if (event.defaultPrevented) return;\n    event.preventDefault();\n\n    let [ from, to ] = editor.getSelectedRange();\n    if (from === to && from === editor.length) return;\n\n    if (from === to) {\n      if (shortcut === 'Alt+Delete' && view.isMac) {\n        const match = editor.getText().slice(from).match(firstWord);\n        if (match) to += match[0].length;\n      } else {\n        to++;\n      }\n    }\n    editor.deleteText(from, to, SOURCE_USER);\n  }\n\n  function onTab(event, shortcut) {\n    if (event.defaultPrevented) return;\n    event.preventDefault();\n\n    const direction = shortcut === 'Tab' || shortcut === 'Mod+]' ? 1 : -1;\n    const [ from, to ] = editor.getSelectedRange();\n    const lines = editor.contents.getLines(from, to);\n\n    editor.transaction(() => {\n      lines.forEach((line, i) => {\n        if (line.attributes.list) {\n          let prevLine = lines[i -1];\n          if (!prevLine && line.number > 1) prevLine = editor.contents.getLine(line.startIndex - 1);\n          const prevIndent = prevLine && prevLine.attributes.list ? prevLine.attributes.indent || 0 : -1;\n\n          let indent = line.attributes.indent || 0;\n          indent += direction;\n          if (indent > prevIndent + 1) return console.log('will not indent too much');\n          if (indent < 0) {\n            editor.formatLine(line.startIndex, {});\n          } else {\n            const attributes = { ...line.attributes, indent };\n            editor.formatLine(line.startIndex, attributes);\n          }\n        }\n      });\n    }, SOURCE_USER);\n  }\n\n  view.on('shortcut:Enter', onEnter);\n  view.on('shortcut:Shift+Enter', onEnter);\n  view.on('shortcut:Backspace', onBackspace);\n  view.on('shortcut:Alt+Backspace', onBackspace);\n  view.on('shortcut:Mod+Backspace', onBackspace);\n  view.on('shortcut:Delete', onDelete);\n  view.on('shortcut:Alt+Delete', onDelete);\n  view.on('shortcut:Tab', onTab);\n  view.on('shortcut:Shift+Tab', onTab);\n}\n","const SOURCE_USER = 'user';\n\n\nexport const keymap = {\n  'Ctrl+B': editor => editor.toggleTextFormat(editor.selection, { bold: true }, SOURCE_USER),\n  'Ctrl+I': editor => editor.toggleTextFormat(editor.selection, { italics: true }, SOURCE_USER),\n  'Ctrl+1': editor => editor.toggleLineFormat(editor.selection, { header: 1 }, SOURCE_USER),\n  'Ctrl+2': editor => editor.toggleLineFormat(editor.selection, { header: 2 }, SOURCE_USER),\n  'Ctrl+3': editor => editor.toggleLineFormat(editor.selection, { header: 3 }, SOURCE_USER),\n  'Ctrl+4': editor => editor.toggleLineFormat(editor.selection, { header: 4 }, SOURCE_USER),\n  'Ctrl+5': editor => editor.toggleLineFormat(editor.selection, { header: 5 }, SOURCE_USER),\n  'Ctrl+6': editor => editor.toggleLineFormat(editor.selection, { header: 6 }, SOURCE_USER),\n  'Ctrl+0': editor => editor.formatLine(editor.selection, { }, SOURCE_USER),\n};\n\nexport const macKeymap = {\n  'Cmd+B': keymap['Ctrl+B'],\n  'Cmd+I': keymap['Ctrl+I'],\n  'Cmd+1': keymap['Ctrl+1'],\n  'Cmd+2': keymap['Ctrl+2'],\n  'Cmd+3': keymap['Ctrl+3'],\n  'Cmd+4': keymap['Ctrl+4'],\n  'Cmd+5': keymap['Ctrl+5'],\n  'Cmd+6': keymap['Ctrl+6'],\n  'Cmd+0': keymap['Ctrl+0'],\n};\n\n// Basic text input module. Prevent any actions other than typing characters and handle with the API.\nexport default function keyShortcuts(view) {\n  const editor = view.editor;\n\n  view.on('shortcut', (event, shortcut) => {\n    if (event.defaultPrevented) return;\n    const map = view.isMac ? macKeymap : keymap;\n\n    if (shortcut in map) {\n      event.preventDefault();\n      map[shortcut](editor);\n    }\n  });\n}\n","const SOURCE_USER = 'user';\nconst defaultSettings = {\n  delay: 4000,\n  maxStack: 500,\n};\n\n/**\n * Stores history for all user-generated changes. Like-changes will be combined until a selection or timeout by delay\n * breaks the combining. E.g. if a user types \"Hello\" the 5 changes will be combined into one history. If the user moves\n * the cursor somewhere and then back to the end and types \" World\" the next 6 changes are combined separately from the\n * first 5.\n *\n * The default settings can be adjusted by wrapping history. To remove the timeout and make it act like a textarea you\n * could set delay to zero like this:\n * modules = [\n *   view => history(view, { delay: 0 })\n * ]\n */\nexport default function history(view, settings = {}) {\n  const editor = view.editor;\n  settings = { ...defaultSettings, settings };\n\n  const stack = {\n    undo: [],\n    redo: [],\n  };\n  let lastRecorded = 0;\n  let lastAction;\n  let ignoreChange = false;\n\n  function undo(event) {\n    action(event, 'undo', 'redo');\n  }\n\n  function redo() {\n    action(event, 'redo', 'undo');\n  }\n\n  function action(event, source, dest) {\n    if (event.defaultPrevented) return;\n    event.preventDefault();\n    if (stack[source].length === 0) return;\n    let entry = stack[source].pop();\n    stack[dest].push(entry);\n    lastRecorded = 0;\n    ignoreChange = true;\n    editor.updateContents(entry[source], SOURCE_USER, entry[source + 'Selection']);\n    ignoreChange = false;\n  }\n\n  function record(change, contents, oldContents, selection, oldSelection) {\n    const timestamp = Date.now();\n    const action = getAction(change);\n    stack.redo.length = 0;\n\n    let undoChange = contents.diff(oldContents);\n    // Break combining if actions are different (e.g. a delete then an insert should break it)\n    if (!action || lastAction !== action) lastRecorded = 0;\n    lastAction = action;\n\n    if ((!settings.delay || lastRecorded + settings.delay > timestamp) && stack.undo.length > 0) {\n      // Combine with the last change\n      let entry = stack.undo.pop();\n      oldSelection = entry.undoSelection;\n      undoChange = undoChange.compose(entry.undo);\n      change = entry.redo.compose(change);\n    } else {\n      lastRecorded = timestamp;\n    }\n\n    stack.undo.push({\n      redo: change,\n      undo: undoChange,\n      redoSelection: selection,\n      undoSelection: oldSelection,\n    });\n\n    if (stack.undo.length > settings.maxStack) {\n      stack.undo.shift();\n    }\n  }\n\n\n  function transform(change) {\n    stack.undo.forEach(function(entry) {\n      entry.undo = change.transform(entry.undo, true);\n      entry.redo = change.transform(entry.redo, true);\n    });\n    stack.redo.forEach(function(entry) {\n      entry.undo = change.transform(entry.undo, true);\n      entry.redo = change.transform(entry.redo, true);\n    });\n  }\n\n\n  editor.on('text-change', ({ change, contents, oldContents, selection, oldSelection, source }) => {\n    if (ignoreChange) return;\n    if (source === SOURCE_USER) {\n      record(change, contents, oldContents, selection, oldSelection);\n    } else {\n      transform(change);\n    }\n  });\n\n  editor.on('selection-change', ({ change }) => {\n    if (change) return;\n    // Break the history merging when selection changes\n    lastRecorded = 0;\n  });\n\n  if (view.isMac) {\n    view.on('shortcut:Cmd+Z', undo);\n    view.on('shortcut:Cmd+Shift+Z', redo);\n  } else {\n    view.on('shortcut:Ctrl+Z', undo);\n    view.on('shortcut:Cmd+Y', redo);\n  }\n}\n\nfunction getAction(change) {\n  if (change.ops.length === 1 || change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes) {\n    const changeOp = change.ops[change.ops.length - 1];\n    if (changeOp.delete) return 'delete';\n    if (changeOp.insert === '\\n') return 'newline';\n    if (changeOp.insert) return 'insert';\n  }\n  return '';\n}\n","const SOURCE_USER = 'user';\nconst bullet = /^[-*] $/;\nconst ordered = /^(-?\\d+)\\. $/;\nconst header = /^#{1,6} $/;\n\n/**\n * A list of [ RegExp, Function ] tuples to convert text into a formatted block with the attributes returned by the\n * function. The function's argument will be the captured text from the regular expression.\n */\nexport const blockReplacements = [\n  [ /^(#{1,6}) $/, capture => ({ header: capture.length }) ],\n  [ /^[-*] $/, () => ({ list: 'bullet' }) ],\n  [ /^1\\. $/, () => ({ list: 'ordered' }) ],\n  [ /^> $/, () => ({ blockquote: true }) ],\n];\n\n/**\n * A list of [ RegExp, Function ] tuples to convert text into another string of text which is returned by the function.\n * The function's argument will be the captured text from the regular expression.\n */\nexport const textReplacements = [\n  [ /--$/, () => 'â€”' ],\n  [ /\\.\\.\\.$/, () => 'â€¦' ],\n];\n\n/**\n * Allow text representations to format a block\n */\nexport function blockReplace(index, prefix) {\n  return blockReplacements.some(([ regexp, getAttributes ]) => {\n    const match = prefix.match(regexp);\n    if (match) {\n      const attributes = getAttributes(match[1]);\n      const change = editor.getChange(() => {\n        editor.formatLine(index, attributes);\n        editor.deleteText(index - prefix.length, index);\n      });\n      editor.updateContents(change, SOURCE_USER, index - prefix.length);\n      return true;\n    }\n  });\n}\n\nexport function textReplace(index, prefix) {\n  return textReplacements.some(([ regexp, replaceWith ]) => {\n    const match = prefix.match(regexp);\n    if (match) {\n      editor.insertText(index - match[0].length, index, replaceWith(match[1]), null, SOURCE_USER);\n      return true;\n    }\n  });\n}\n\nexport const defaultHandlers = [ blockReplace, textReplace ];\n\n\nexport default function(handlers = defaultHandlers) {\n\n  return view => {\n    const editor = view.editor;\n    let ignore = false;\n\n    function onTextChange({ change, source }) {\n      if (ignore || source !== 'user' || !editor.selection || !isTextEntry(change)) return;\n      const index = editor.selection[1];\n      const lineStart = editor.text.lastIndexOf('\\n', index - 1) + 1;\n      const prefix = editor.text.slice(lineStart, index);\n\n      ignore = true;\n      handlers.some(handler => handler(index, prefix));\n      ignore = false;\n    }\n\n    editor.on('text-change', onTextChange);\n  };\n}\n\n\nfunction isTextEntry(change) {\n  return (\n    change.ops.length === 1 ||\n    (change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes)\n  ) &&\n    change.ops[change.ops.length - 1].insert &&\n    change.ops[change.ops.length - 1].insert !== '\\n';\n}\n","\n/**\n * Replaces regular quotes with smart quotes as they are typed. Does not affect pasted content.\n * Uses the text-changing event to prevent the original change and replace it with the new one. This makes the smart-\n * quotes act more seemlessly and includes them as part of regular text undo/redo instead of breaking it like the smart-\n * entry conversions do.\n */\nexport default function smartQuotes(view) {\n  const editor = view.editor;\n\n  function onTextChange({ change, source, selection }) {\n    if (source !== 'user' || !editor.selection || !isTextEntry(change)) return;\n\n    const index = editor.selection[1];\n    const lastOp = change.ops[change.ops.length - 1];\n    const lastChars = editor.text.slice(index - 1, index) + lastOp.insert.slice(-1);\n\n    const replaced = lastChars.replace(/(?:^|[\\s\\{\\[\\(\\<'\"\\u2018\\u201C])(\")$/, 'â€œ')\n            .replace(/\"$/, 'â€')\n            .replace(/(?:^|[\\s\\{\\[\\(\\<'\"\\u2018\\u201C])(')$/, 'â€˜')\n            .replace(/'$/, 'â€™');\n\n    if (replaced !== lastChars) {\n      const quote = replaced.slice(-1);\n      lastOp.insert = lastOp.insert.slice(0, -1) + quote;\n      editor.updateContents(change, source, selection);\n      return false;\n    }\n  }\n\n  editor.on('text-changing', onTextChange);\n}\n\n\n/**\n * Adds smartquotes to a document as a decorator, not affecting the source, leaving it with regular quotes.\n */\nexport function smartQuotesDecorator(view) {\n  const quotes = [\n    [ /(^|\\s)\"/g, /(^|\\s)\"/, '$1â€œ' ],\n    [ /\"/g, /\"/, 'â€'],\n    [ /\\b'/g, /'/, 'â€™'],\n    [ /'/g, /'/, 'â€˜'],\n  ];\n\n  view.on('decorate', editor => {\n    let { text } = editor;\n    quotes.forEach(([ expr, replacer, replaceWith ]) => {\n      let match;\n      while ((match = expr.exec(text))) {\n        const replacement = match[0].replace(replacer, replaceWith);\n        text = text.slice(0, match.index) + replacement + text.slice(expr.lastIndex);\n        editor.insertText(match.index, expr.lastIndex, replacement);\n      }\n    });\n  });\n}\n\n\nfunction isTextEntry(change) {\n  return (\n    change.ops.length === 1 ||\n    (change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes)\n  ) &&\n    change.ops[change.ops.length - 1].insert &&\n    change.ops[change.ops.length - 1].insert !== '\\n';\n}\n","import Editor from './editor';\nimport View from './view';\n\nimport input from './modules/input';\nimport keyShortcuts from './modules/key-shortcuts';\nimport history from './modules/history';\nimport placeholder from './modules/placeholder';\nimport smartEntry from './modules/smart-entry';\nimport smartQuotes from './modules/smart-quotes';\n\nconst defaultViewModules = [ input, keyShortcuts, history ];\n\nexport { Editor, View, input, keyShortcuts, history, placeholder, smartEntry, smartQuotes, defaultViewModules };\n","import { Editor, View, defaultViewModules, placeholder, smartEntry, smartQuotes } from './index';\nimport { cursor } from './view/embeds';\nimport { h } from './view/vdom';\n\nconst editor = new Editor();\nconst view = new View(editor, { modules: defaultViewModules.concat([\n  smartQuotes, smartEntry()\n]) });\n\nwindow.editor = editor;\nwindow.view = view;\n\n// ***** Search feature\nconst style = document.createElement('style');\nstyle.textContent = 'span.search { background: yellow }';\ndocument.head.appendChild(style);\n\nconst searchInput = document.createElement('input');\nlet searchString = '';\nsearchInput.type = 'search';\ndocument.body.appendChild(searchInput);\nsearchInput.addEventListener('input', () => {\n  searchString = searchInput.value.toLowerCase().trim();\n  view.update();\n});\n\nview.paper.markups.add({\n  name: 'search',\n  selector: 'span.search',\n  vdom: children => <span class=\"search\">{children}</span>,\n});\nconst searchDisplay = document.createElement('div');\nsearchDisplay.setAttribute('style', 'position:fixed;top:0;bottom:0;left:0;right:0;pointer-events:none;z-index:1000000;mix-blend-mode:multiply');\ndocument.body.appendChild(searchDisplay);\n\n// view.on('decorate', editor => {\n//   if (!searchString) return;\n//   const text = editor.getText().toLowerCase();\n//   let lastIndex = 0, index;\n//   while ((index = text.indexOf(searchString, lastIndex)) !== -1) {\n//     lastIndex = index + searchString.length;\n//     editor.formatText(index, lastIndex, { search: true });\n//   }\n// });\nview.on('update', () => {\n  searchDisplay.innerHTML = '';\n  if (!searchString) return;\n  const text = editor.getText().toLowerCase();\n  let lastIndex = 0, index;\n  while ((index = text.indexOf(searchString, lastIndex)) !== -1) {\n    lastIndex = index + searchString.length;\n    const rects = view.getAllBounds(index, lastIndex);\n    for (var i = 0; i < rects.length; i++) {\n      const rect = rects[i];\n      const hit = document.createElement('span');\n      hit.className = 'search';\n      hit.setAttribute('style', `top:${rect.top}px;width:${rect.width}px;left:${rect.left}px;height:${rect.height}px;position:absolute;`);\n      searchDisplay.appendChild(hit);\n    }\n  }\n});\n// ***** Search feature\n\nview.paper.embeds.add(cursor);\nlet pos = 10;\nlet changes = editor.delta();\n\nview.on('decorate', (editor, event) => {\n  if (event && event.change && event.source === 'user') {\n    changes = changes.compose(event.change);\n    changes = changes.slice(0, changes.transform(pos));\n  }\n  editor.insertEmbed(changes.transform(pos), 'cursor', { name: 'Jacob', color: 'blue' });\n});\n\n\n\neditor.setText(`Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur quis sagittis libero. Etiam egestas rhoncus risus, sed accumsan nisi laoreet a. Praesent pulvinar porttitor lorem, vel tempor est vulputate nec. Duis magna justo, ultrices at ullamcorper a, sagittis quis mi. Duis id libero non augue faucibus faucibus sed nec sapien. Vivamus pulvinar justo nec metus dapibus, quis tincidunt justo fermentum. Aliquam erat volutpat. Nam hendrerit libero ut nunc rutrum pellentesque. Nulla erat eros, molestie ac nibh non, consectetur luctus lorem. Mauris vel egestas nisi.\nMauris sed mi cursus urna pretium posuere sit amet id lorem. Maecenas tristique commodo diam at elementum. Maecenas dapibus risus at mauris consequat, ac semper justo commodo. Sed tempor mattis nisi, in accumsan felis gravida non. In dignissim pellentesque ornare. Mauris lorem sem, consectetur eu ornare at, laoreet sed dui. Nam gravida justo tempus ligula pharetra, sit amet vestibulum lorem sagittis. In mauris purus, cursus vitae tempus at, tincidunt et arcu. Etiam sed libero ac mi fermentum hendrerit. Cras vel cursus urna, sed pretium nisl. Mauris sodales tempor ex nec iaculis. Nulla ac erat ac nunc malesuada viverra. Pellentesque nec ipsum in arcu consectetur elementum a ut metus. Integer sit amet eleifend nulla. Morbi ac felis malesuada, dapibus libero eget, posuere neque. Cras porta ut metus sed vulputate.`);\n\nview.mount(document.body);\n"],"names":["dispatcherEvents","WeakMap","EventDispatcher","type","listener","getEventListeners","add","delete","once","off","args","apply","on","uncanceled","forEach","obj","events","get","set","Object","create","Set","extend","op","diff","deepEqual","SOURCE_API","SOURCE_USER","SOURCE_SILENT","empty","Editor","options","selection","activeFormats","setContents","contents","delta","insert","modules","module","ops","Delta","from","to","length","_normalizeArguments","slice","text","producer","change","updateContents","singleChange","compose","source","getChange","newContents","formats","retain","getLineFormat","lineFormat","indexOf","textFormat","getTextFormat","split","line","i","cleanDelete","embed","value","getLines","attributes","combineFormats","getOps","keys","name","endIndex","startIndex","key","getText","chop","format","existing","formatLine","isSame","every","formatText","oldContents","normalizeContents","oldSelection","map","transform","getSelectedRange","changeEvent","selectionChanged","shallowEqual","fire","event","range","max","Math","min","index","rest","Array","isArray","undefined","unshift","concat","editor","getLine","lineChange","push","filter","join","combined","reduce","merged","prototype","predicate","lines","eachLine","number","at","some","deltaOp","getOp","h","children","arguments","node","pop","render","element","patch","parentNode","clone","target","updateAttribute","isSvg","setAttribute","removeAttribute","createElement","document","createTextNode","createElementNS","appendChild","getElementAttributes","updateElement","oldAttributes","removeElement","parent","removeChild","nodeName","toLowerCase","newElement","insertBefore","nodeValue","childNodes","paragraph","selector","vdom","header","defaultFollows","dom","parseInt","replace","attr","H","list","optimize","indent","test","topLevelChildren","levels","lists","List","item","childrenArray","blockquote","container","bold","italics","link","href","image","src","cursor","dataset","color","style","backgroundColor","blocks","markups","embeds","getSelection","view","root","ownerDocument","defaultView","contains","anchorNode","anchorIndex","getNodeIndex","focusIndex","focusNode","anchorOffset","focusOffset","setSelection","hasFocus","activeElement","blur","setBaseAndExtent","getNodesForRange","focus","getBrowserRange","browserRange","createRange","setStart","setEnd","getNodeAndOffset","blocksSelector","paper","walker","createTreeWalker","NodeFilter","SHOW_ELEMENT","SHOW_TEXT","acceptNode","nodeType","Node","TEXT_NODE","offsetParent","FILTER_ACCEPT","FILTER_REJECT","count","firstBlockSeen","currentNode","nextNode","size","matches","firstChild","lastChild","nextSibling","call","ELEMENT_NODE","previousNode","br","voidElements","area","base","col","hr","img","input","meta","param","track","wbr","deltaToVdom","blockData","inlineChildren","child","find","sort","a","b","priority","markup","mergeChildren","block","getDefault","blockChildren","collect","data","next","random","deltaFromDom","currentBlock","isBr","deltaToHTML","childrenToHTML","oldChildren","prev","nodeToHTML","escape","closingTag","html","Paper","types","Types","array","priorities","definition","Error","remove","splice","domType","nodeMatches","nodeOrAttr","define","isMac","navigator","userAgent","modExpr","View","defaultDom","enabled","_settingEditorSelection","_settingBrowserSelection","enable","update","endContainer","endOffset","getBoundingClientRect","getClientRects","deltaFromHTML","decorations","reverseDecorations","contenteditable","pauseObserver","resumeObserver","updateBrowserSelection","setTimeout","execCommand","onKeyDown","shortcut","shortcuts","fromEvent","onSelectionChange","updateEditorSelection","addEventListener","observer","MutationObserver","seen","has","m","mutation","isTextChange","addedNodes","diffs","oldValue","action","string","EQUAL","DELETE","INSERT","opts","characterData","characterDataOldValue","subtree","childList","observe","disconnect","checking","devObserver","clearTimeout","console","error","_preventIncorrectFormats","unmount","removeEventListener","babelHelpers.typeof","lastWord","firstWord","lastLine","onEnter","defaultPrevented","preventDefault","insertText","isDefault","onBackspace","match","prevLine","prevBlock","deleteText","onDelete","onTab","direction","transaction","prevIndent","log","keymap","toggleTextFormat","toggleLineFormat","macKeymap","keyShortcuts","defaultSettings","delay","maxStack","history","settings","stack","undo","redo","lastRecorded","lastAction","ignoreChange","dest","entry","record","timestamp","Date","now","getAction","undoChange","undoSelection","redoSelection","shift","changeOp","blockReplacements","capture","textReplacements","blockReplace","prefix","regexp","getAttributes","textReplace","replaceWith","defaultHandlers","handlers","ignore","onTextChange","isTextEntry","lineStart","lastIndexOf","handler","smartQuotes","lastOp","lastChars","replaced","quote","defaultViewModules","smartEntry","window","textContent","head","searchInput","searchString","body","trim","searchDisplay","innerHTML","lastIndex","rects","getAllBounds","rect","hit","className","top","width","left","height","pos","changes","insertEmbed","setText","mount"],"mappings":"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"}