{"version":3,"file":"typewriter.js","sources":["../src/event-dispatcher.js","../src/diff.js","../src/equal.js","../src/delta.js","../src/editor.js","../src/view/vdom.js","../src/view/dom-utils.js","../src/view/blocks.js","../src/view/markups.js","../src/view/embeds.js","../src/view/defaultPaper.js","../src/view/selection.js","../src/escape-html.js","../src/paper.js","../src/view/dom.js","../src/shortcut-string.js","../src/view.js","../src/modules/input.js","../src/modules/key-shortcuts.js","../src/modules/history.js","../src/modules/placeholder.js","../src/modules/smart-entry.js","../src/modules/smart-quotes.js","../node_modules/svelte/shared.js","../src/ui/HoverMenu.html","../src/modules/hover-menu.js","../src/index.js"],"sourcesContent":["const dispatcherEvents = new WeakMap();\n\n\nexport default class EventDispatcher {\n\n  on(type, listener) {\n    getEventListeners(this, type, true).add(listener);\n  }\n\n  off(type, listener) {\n    const events = getEventListeners(this, type);\n    events && events.delete(listener);\n  }\n\n  once(type, listener) {\n    function once(...args) {\n      this.off(type, once);\n      listener.apply(this, args);\n    }\n    this.on(type, once);\n  }\n\n  fire(type, ...args) {\n    let uncanceled = true;\n    const events = getEventListeners(this, type);\n    if (events) events.forEach(listener => {\n      uncanceled && listener.apply(this, args) !== false || (uncanceled = false);\n    });\n    return uncanceled;\n  }\n}\n\n\nfunction getEventListeners(obj, type, autocreate) {\n  let events = dispatcherEvents.get(obj);\n  if (!events && autocreate) dispatcherEvents.set(obj, events = Object.create(null));\n  return events && events[type] || autocreate && (events[type] = new Set());\n}\n","/**\n * This library modifies the diff-patch-match library by Neil Fraser\n * by removing the patch and match functionality and certain advanced\n * options in the diff function. The original license is as follows:\n *\n * ===\n *\n * Diff Match and Patch\n *\n * Copyright 2006 Google Inc.\n * http://code.google.com/p/google-diff-match-patch/\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * The data structure representing a diff is an array of tuples:\n * [[DIFF_DELETE, 'Hello'], [DIFF_INSERT, 'Goodbye'], [DIFF_EQUAL, ' world.']]\n * which means: delete 'Hello', add 'Goodbye' and keep ' world.'\n */\nvar DIFF_DELETE = -1;\nvar DIFF_INSERT = 1;\nvar DIFF_EQUAL = 0;\n\n\n/**\n * Find the differences between two texts.  Simplifies the problem by stripping\n * any common prefix or suffix off the texts before diffing.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @param {Int} cursor_pos Expected edit position in text1 (optional)\n * @return {Array} Array of diff tuples.\n */\nexport default function diff(text1, text2, cursor_pos) {\n  // Check for equality (speedup).\n  if (text1 == text2) {\n    if (text1) {\n      return [[DIFF_EQUAL, text1]];\n    }\n    return [];\n  }\n\n  // Check cursor_pos within bounds\n  if (cursor_pos < 0 || text1.length < cursor_pos) {\n    cursor_pos = null;\n  }\n\n  // Trim off common prefix (speedup).\n  var commonlength = diff_commonPrefix(text1, text2);\n  var commonprefix = text1.substring(0, commonlength);\n  text1 = text1.substring(commonlength);\n  text2 = text2.substring(commonlength);\n\n  // Trim off common suffix (speedup).\n  commonlength = diff_commonSuffix(text1, text2);\n  var commonsuffix = text1.substring(text1.length - commonlength);\n  text1 = text1.substring(0, text1.length - commonlength);\n  text2 = text2.substring(0, text2.length - commonlength);\n\n  // Compute the diff on the middle block.\n  var diffs = diff_compute_(text1, text2);\n\n  // Restore the prefix and suffix.\n  if (commonprefix) {\n    diffs.unshift([DIFF_EQUAL, commonprefix]);\n  }\n  if (commonsuffix) {\n    diffs.push([DIFF_EQUAL, commonsuffix]);\n  }\n  diff_cleanupMerge(diffs);\n  if (cursor_pos != null) {\n    diffs = fix_cursor(diffs, cursor_pos);\n  }\n  diffs = fix_emoji(diffs);\n  return diffs;\n};\n\n\n/**\n * Find the differences between two texts.  Assumes that the texts do not\n * have any common prefix or suffix.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @return {Array} Array of diff tuples.\n */\nfunction diff_compute_(text1, text2) {\n  var diffs;\n\n  if (!text1) {\n    // Just add some text (speedup).\n    return [[DIFF_INSERT, text2]];\n  }\n\n  if (!text2) {\n    // Just delete some text (speedup).\n    return [[DIFF_DELETE, text1]];\n  }\n\n  var longtext = text1.length > text2.length ? text1 : text2;\n  var shorttext = text1.length > text2.length ? text2 : text1;\n  var i = longtext.indexOf(shorttext);\n  if (i != -1) {\n    // Shorter text is inside the longer text (speedup).\n    diffs = [[DIFF_INSERT, longtext.substring(0, i)],\n             [DIFF_EQUAL, shorttext],\n             [DIFF_INSERT, longtext.substring(i + shorttext.length)]];\n    // Swap insertions for deletions if diff is reversed.\n    if (text1.length > text2.length) {\n      diffs[0][0] = diffs[2][0] = DIFF_DELETE;\n    }\n    return diffs;\n  }\n\n  if (shorttext.length == 1) {\n    // Single character string.\n    // After the previous speedup, the character can't be an equality.\n    return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n  }\n\n  // Check to see if the problem can be split in two.\n  var hm = diff_halfMatch_(text1, text2);\n  if (hm) {\n    // A half-match was found, sort out the return data.\n    var text1_a = hm[0];\n    var text1_b = hm[1];\n    var text2_a = hm[2];\n    var text2_b = hm[3];\n    var mid_common = hm[4];\n    // Send both pairs off for separate processing.\n    var diffs_a = diff(text1_a, text2_a);\n    var diffs_b = diff(text1_b, text2_b);\n    // Merge the results.\n    return diffs_a.concat([[DIFF_EQUAL, mid_common]], diffs_b);\n  }\n\n  return diff_bisect_(text1, text2);\n};\n\n\n/**\n * Find the 'middle snake' of a diff, split the problem in two\n * and return the recursively constructed diff.\n * See Myers 1986 paper: An O(ND) Difference Algorithm and Its Variations.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @return {Array} Array of diff tuples.\n * @private\n */\nfunction diff_bisect_(text1, text2) {\n  // Cache the text lengths to prevent multiple calls.\n  var text1_length = text1.length;\n  var text2_length = text2.length;\n  var max_d = Math.ceil((text1_length + text2_length) / 2);\n  var v_offset = max_d;\n  var v_length = 2 * max_d;\n  var v1 = new Array(v_length);\n  var v2 = new Array(v_length);\n  // Setting all elements to -1 is faster in Chrome & Firefox than mixing\n  // integers and undefined.\n  for (var x = 0; x < v_length; x++) {\n    v1[x] = -1;\n    v2[x] = -1;\n  }\n  v1[v_offset + 1] = 0;\n  v2[v_offset + 1] = 0;\n  var delta = text1_length - text2_length;\n  // If the total number of characters is odd, then the front path will collide\n  // with the reverse path.\n  var front = (delta % 2 != 0);\n  // Offsets for start and end of k loop.\n  // Prevents mapping of space beyond the grid.\n  var k1start = 0;\n  var k1end = 0;\n  var k2start = 0;\n  var k2end = 0;\n  for (var d = 0; d < max_d; d++) {\n    // Walk the front path one step.\n    for (var k1 = -d + k1start; k1 <= d - k1end; k1 += 2) {\n      var k1_offset = v_offset + k1;\n      var x1;\n      if (k1 == -d || (k1 != d && v1[k1_offset - 1] < v1[k1_offset + 1])) {\n        x1 = v1[k1_offset + 1];\n      } else {\n        x1 = v1[k1_offset - 1] + 1;\n      }\n      var y1 = x1 - k1;\n      while (x1 < text1_length && y1 < text2_length &&\n             text1.charAt(x1) == text2.charAt(y1)) {\n        x1++;\n        y1++;\n      }\n      v1[k1_offset] = x1;\n      if (x1 > text1_length) {\n        // Ran off the right of the graph.\n        k1end += 2;\n      } else if (y1 > text2_length) {\n        // Ran off the bottom of the graph.\n        k1start += 2;\n      } else if (front) {\n        var k2_offset = v_offset + delta - k1;\n        if (k2_offset >= 0 && k2_offset < v_length && v2[k2_offset] != -1) {\n          // Mirror x2 onto top-left coordinate system.\n          var x2 = text1_length - v2[k2_offset];\n          if (x1 >= x2) {\n            // Overlap detected.\n            return diff_bisectSplit_(text1, text2, x1, y1);\n          }\n        }\n      }\n    }\n\n    // Walk the reverse path one step.\n    for (var k2 = -d + k2start; k2 <= d - k2end; k2 += 2) {\n      var k2_offset = v_offset + k2;\n      var x2;\n      if (k2 == -d || (k2 != d && v2[k2_offset - 1] < v2[k2_offset + 1])) {\n        x2 = v2[k2_offset + 1];\n      } else {\n        x2 = v2[k2_offset - 1] + 1;\n      }\n      var y2 = x2 - k2;\n      while (x2 < text1_length && y2 < text2_length &&\n             text1.charAt(text1_length - x2 - 1) ==\n             text2.charAt(text2_length - y2 - 1)) {\n        x2++;\n        y2++;\n      }\n      v2[k2_offset] = x2;\n      if (x2 > text1_length) {\n        // Ran off the left of the graph.\n        k2end += 2;\n      } else if (y2 > text2_length) {\n        // Ran off the top of the graph.\n        k2start += 2;\n      } else if (!front) {\n        var k1_offset = v_offset + delta - k2;\n        if (k1_offset >= 0 && k1_offset < v_length && v1[k1_offset] != -1) {\n          var x1 = v1[k1_offset];\n          var y1 = v_offset + x1 - k1_offset;\n          // Mirror x2 onto top-left coordinate system.\n          x2 = text1_length - x2;\n          if (x1 >= x2) {\n            // Overlap detected.\n            return diff_bisectSplit_(text1, text2, x1, y1);\n          }\n        }\n      }\n    }\n  }\n  // Diff took too long and hit the deadline or\n  // number of diffs equals number of characters, no commonality at all.\n  return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];\n};\n\n\n/**\n * Given the location of the 'middle snake', split the diff in two parts\n * and recurse.\n * @param {string} text1 Old string to be diffed.\n * @param {string} text2 New string to be diffed.\n * @param {number} x Index of split point in text1.\n * @param {number} y Index of split point in text2.\n * @return {Array} Array of diff tuples.\n */\nfunction diff_bisectSplit_(text1, text2, x, y) {\n  var text1a = text1.substring(0, x);\n  var text2a = text2.substring(0, y);\n  var text1b = text1.substring(x);\n  var text2b = text2.substring(y);\n\n  // Compute both diffs serially.\n  var diffs = diff(text1a, text2a);\n  var diffsb = diff(text1b, text2b);\n\n  return diffs.concat(diffsb);\n};\n\n\n/**\n * Determine the common prefix of two strings.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {number} The number of characters common to the start of each\n *     string.\n */\nfunction diff_commonPrefix(text1, text2) {\n  // Quick check for common null cases.\n  if (!text1 || !text2 || text1.charAt(0) != text2.charAt(0)) {\n    return 0;\n  }\n  // Binary search.\n  // Performance analysis: http://neil.fraser.name/news/2007/10/09/\n  var pointermin = 0;\n  var pointermax = Math.min(text1.length, text2.length);\n  var pointermid = pointermax;\n  var pointerstart = 0;\n  while (pointermin < pointermid) {\n    if (text1.substring(pointerstart, pointermid) ==\n        text2.substring(pointerstart, pointermid)) {\n      pointermin = pointermid;\n      pointerstart = pointermin;\n    } else {\n      pointermax = pointermid;\n    }\n    pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n  }\n  return pointermid;\n};\n\n\n/**\n * Determine the common suffix of two strings.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {number} The number of characters common to the end of each string.\n */\nfunction diff_commonSuffix(text1, text2) {\n  // Quick check for common null cases.\n  if (!text1 || !text2 ||\n      text1.charAt(text1.length - 1) != text2.charAt(text2.length - 1)) {\n    return 0;\n  }\n  // Binary search.\n  // Performance analysis: http://neil.fraser.name/news/2007/10/09/\n  var pointermin = 0;\n  var pointermax = Math.min(text1.length, text2.length);\n  var pointermid = pointermax;\n  var pointerend = 0;\n  while (pointermin < pointermid) {\n    if (text1.substring(text1.length - pointermid, text1.length - pointerend) ==\n        text2.substring(text2.length - pointermid, text2.length - pointerend)) {\n      pointermin = pointermid;\n      pointerend = pointermin;\n    } else {\n      pointermax = pointermid;\n    }\n    pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n  }\n  return pointermid;\n};\n\n\n/**\n * Do the two texts share a substring which is at least half the length of the\n * longer text?\n * This speedup can produce non-minimal diffs.\n * @param {string} text1 First string.\n * @param {string} text2 Second string.\n * @return {Array.<string>} Five element Array, containing the prefix of\n *     text1, the suffix of text1, the prefix of text2, the suffix of\n *     text2 and the common middle.  Or null if there was no match.\n */\nfunction diff_halfMatch_(text1, text2) {\n  var longtext = text1.length > text2.length ? text1 : text2;\n  var shorttext = text1.length > text2.length ? text2 : text1;\n  if (longtext.length < 4 || shorttext.length * 2 < longtext.length) {\n    return null;  // Pointless.\n  }\n\n  /**\n   * Does a substring of shorttext exist within longtext such that the substring\n   * is at least half the length of longtext?\n   * Closure, but does not reference any external variables.\n   * @param {string} longtext Longer string.\n   * @param {string} shorttext Shorter string.\n   * @param {number} i Start index of quarter length substring within longtext.\n   * @return {Array.<string>} Five element Array, containing the prefix of\n   *     longtext, the suffix of longtext, the prefix of shorttext, the suffix\n   *     of shorttext and the common middle.  Or null if there was no match.\n   * @private\n   */\n  function diff_halfMatchI_(longtext, shorttext, i) {\n    // Start with a 1/4 length substring at position i as a seed.\n    var seed = longtext.substring(i, i + Math.floor(longtext.length / 4));\n    var j = -1;\n    var best_common = '';\n    var best_longtext_a, best_longtext_b, best_shorttext_a, best_shorttext_b;\n    while ((j = shorttext.indexOf(seed, j + 1)) != -1) {\n      var prefixLength = diff_commonPrefix(longtext.substring(i),\n                                           shorttext.substring(j));\n      var suffixLength = diff_commonSuffix(longtext.substring(0, i),\n                                           shorttext.substring(0, j));\n      if (best_common.length < suffixLength + prefixLength) {\n        best_common = shorttext.substring(j - suffixLength, j) +\n            shorttext.substring(j, j + prefixLength);\n        best_longtext_a = longtext.substring(0, i - suffixLength);\n        best_longtext_b = longtext.substring(i + prefixLength);\n        best_shorttext_a = shorttext.substring(0, j - suffixLength);\n        best_shorttext_b = shorttext.substring(j + prefixLength);\n      }\n    }\n    if (best_common.length * 2 >= longtext.length) {\n      return [best_longtext_a, best_longtext_b,\n              best_shorttext_a, best_shorttext_b, best_common];\n    } else {\n      return null;\n    }\n  }\n\n  // First check if the second quarter is the seed for a half-match.\n  var hm1 = diff_halfMatchI_(longtext, shorttext,\n                             Math.ceil(longtext.length / 4));\n  // Check again based on the third quarter.\n  var hm2 = diff_halfMatchI_(longtext, shorttext,\n                             Math.ceil(longtext.length / 2));\n  var hm;\n  if (!hm1 && !hm2) {\n    return null;\n  } else if (!hm2) {\n    hm = hm1;\n  } else if (!hm1) {\n    hm = hm2;\n  } else {\n    // Both matched.  Select the longest.\n    hm = hm1[4].length > hm2[4].length ? hm1 : hm2;\n  }\n\n  // A half-match was found, sort out the return data.\n  var text1_a, text1_b, text2_a, text2_b;\n  if (text1.length > text2.length) {\n    text1_a = hm[0];\n    text1_b = hm[1];\n    text2_a = hm[2];\n    text2_b = hm[3];\n  } else {\n    text2_a = hm[0];\n    text2_b = hm[1];\n    text1_a = hm[2];\n    text1_b = hm[3];\n  }\n  var mid_common = hm[4];\n  return [text1_a, text1_b, text2_a, text2_b, mid_common];\n};\n\n\n/**\n * Reorder and merge like edit sections.  Merge equalities.\n * Any edit section can move as long as it doesn't cross an equality.\n * @param {Array} diffs Array of diff tuples.\n */\nfunction diff_cleanupMerge(diffs) {\n  diffs.push([DIFF_EQUAL, '']);  // Add a dummy entry at the end.\n  var pointer = 0;\n  var count_delete = 0;\n  var count_insert = 0;\n  var text_delete = '';\n  var text_insert = '';\n  var commonlength;\n  while (pointer < diffs.length) {\n    switch (diffs[pointer][0]) {\n      case DIFF_INSERT:\n        count_insert++;\n        text_insert += diffs[pointer][1];\n        pointer++;\n        break;\n      case DIFF_DELETE:\n        count_delete++;\n        text_delete += diffs[pointer][1];\n        pointer++;\n        break;\n      case DIFF_EQUAL:\n        // Upon reaching an equality, check for prior redundancies.\n        if (count_delete + count_insert > 1) {\n          if (count_delete !== 0 && count_insert !== 0) {\n            // Factor out any common prefixies.\n            commonlength = diff_commonPrefix(text_insert, text_delete);\n            if (commonlength !== 0) {\n              if ((pointer - count_delete - count_insert) > 0 &&\n                  diffs[pointer - count_delete - count_insert - 1][0] ==\n                  DIFF_EQUAL) {\n                diffs[pointer - count_delete - count_insert - 1][1] +=\n                    text_insert.substring(0, commonlength);\n              } else {\n                diffs.splice(0, 0, [DIFF_EQUAL,\n                                    text_insert.substring(0, commonlength)]);\n                pointer++;\n              }\n              text_insert = text_insert.substring(commonlength);\n              text_delete = text_delete.substring(commonlength);\n            }\n            // Factor out any common suffixies.\n            commonlength = diff_commonSuffix(text_insert, text_delete);\n            if (commonlength !== 0) {\n              diffs[pointer][1] = text_insert.substring(text_insert.length -\n                  commonlength) + diffs[pointer][1];\n              text_insert = text_insert.substring(0, text_insert.length -\n                  commonlength);\n              text_delete = text_delete.substring(0, text_delete.length -\n                  commonlength);\n            }\n          }\n          // Delete the offending records and add the merged ones.\n          if (count_delete === 0) {\n            diffs.splice(pointer - count_insert,\n                count_delete + count_insert, [DIFF_INSERT, text_insert]);\n          } else if (count_insert === 0) {\n            diffs.splice(pointer - count_delete,\n                count_delete + count_insert, [DIFF_DELETE, text_delete]);\n          } else {\n            diffs.splice(pointer - count_delete - count_insert,\n                count_delete + count_insert, [DIFF_DELETE, text_delete],\n                [DIFF_INSERT, text_insert]);\n          }\n          pointer = pointer - count_delete - count_insert +\n                    (count_delete ? 1 : 0) + (count_insert ? 1 : 0) + 1;\n        } else if (pointer !== 0 && diffs[pointer - 1][0] == DIFF_EQUAL) {\n          // Merge this equality with the previous one.\n          diffs[pointer - 1][1] += diffs[pointer][1];\n          diffs.splice(pointer, 1);\n        } else {\n          pointer++;\n        }\n        count_insert = 0;\n        count_delete = 0;\n        text_delete = '';\n        text_insert = '';\n        break;\n    }\n  }\n  if (diffs[diffs.length - 1][1] === '') {\n    diffs.pop();  // Remove the dummy entry at the end.\n  }\n\n  // Second pass: look for single edits surrounded on both sides by equalities\n  // which can be shifted sideways to eliminate an equality.\n  // e.g: A<ins>BA</ins>C -> <ins>AB</ins>AC\n  var changes = false;\n  pointer = 1;\n  // Intentionally ignore the first and last element (don't need checking).\n  while (pointer < diffs.length - 1) {\n    if (diffs[pointer - 1][0] == DIFF_EQUAL &&\n        diffs[pointer + 1][0] == DIFF_EQUAL) {\n      // This is a single edit surrounded by equalities.\n      if (diffs[pointer][1].substring(diffs[pointer][1].length -\n          diffs[pointer - 1][1].length) == diffs[pointer - 1][1]) {\n        // Shift the edit over the previous equality.\n        diffs[pointer][1] = diffs[pointer - 1][1] +\n            diffs[pointer][1].substring(0, diffs[pointer][1].length -\n                                        diffs[pointer - 1][1].length);\n        diffs[pointer + 1][1] = diffs[pointer - 1][1] + diffs[pointer + 1][1];\n        diffs.splice(pointer - 1, 1);\n        changes = true;\n      } else if (diffs[pointer][1].substring(0, diffs[pointer + 1][1].length) ==\n          diffs[pointer + 1][1]) {\n        // Shift the edit over the next equality.\n        diffs[pointer - 1][1] += diffs[pointer + 1][1];\n        diffs[pointer][1] =\n            diffs[pointer][1].substring(diffs[pointer + 1][1].length) +\n            diffs[pointer + 1][1];\n        diffs.splice(pointer + 1, 1);\n        changes = true;\n      }\n    }\n    pointer++;\n  }\n  // If shifts were made, the diff needs reordering and another shift sweep.\n  if (changes) {\n    diff_cleanupMerge(diffs);\n  }\n};\n\n\ndiff.INSERT = DIFF_INSERT;\ndiff.DELETE = DIFF_DELETE;\ndiff.EQUAL = DIFF_EQUAL;\n\n/*\n * Modify a diff such that the cursor position points to the start of a change:\n * E.g.\n *   cursor_normalize_diff([[DIFF_EQUAL, 'abc']], 1)\n *     => [1, [[DIFF_EQUAL, 'a'], [DIFF_EQUAL, 'bc']]]\n *   cursor_normalize_diff([[DIFF_INSERT, 'new'], [DIFF_DELETE, 'xyz']], 2)\n *     => [2, [[DIFF_INSERT, 'new'], [DIFF_DELETE, 'xy'], [DIFF_DELETE, 'z']]]\n *\n * @param {Array} diffs Array of diff tuples\n * @param {Int} cursor_pos Suggested edit position. Must not be out of bounds!\n * @return {Array} A tuple [cursor location in the modified diff, modified diff]\n */\nfunction cursor_normalize_diff (diffs, cursor_pos) {\n  if (cursor_pos === 0) {\n    return [DIFF_EQUAL, diffs];\n  }\n  for (var current_pos = 0, i = 0; i < diffs.length; i++) {\n    var d = diffs[i];\n    if (d[0] === DIFF_DELETE || d[0] === DIFF_EQUAL) {\n      var next_pos = current_pos + d[1].length;\n      if (cursor_pos === next_pos) {\n        return [i + 1, diffs];\n      } else if (cursor_pos < next_pos) {\n        // copy to prevent side effects\n        diffs = diffs.slice();\n        // split d into two diff changes\n        var split_pos = cursor_pos - current_pos;\n        var d_left = [d[0], d[1].slice(0, split_pos)];\n        var d_right = [d[0], d[1].slice(split_pos)];\n        diffs.splice(i, 1, d_left, d_right);\n        return [i + 1, diffs];\n      } else {\n        current_pos = next_pos;\n      }\n    }\n  }\n  throw new Error('cursor_pos is out of bounds!')\n}\n\n/*\n * Modify a diff such that the edit position is \"shifted\" to the proposed edit location (cursor_position).\n *\n * Case 1)\n *   Check if a naive shift is possible:\n *     [0, X], [ 1, Y] -> [ 1, Y], [0, X]    (if X + Y === Y + X)\n *     [0, X], [-1, Y] -> [-1, Y], [0, X]    (if X + Y === Y + X) - holds same result\n * Case 2)\n *   Check if the following shifts are possible:\n *     [0, 'pre'], [ 1, 'prefix'] -> [ 1, 'pre'], [0, 'pre'], [ 1, 'fix']\n *     [0, 'pre'], [-1, 'prefix'] -> [-1, 'pre'], [0, 'pre'], [-1, 'fix']\n *         ^            ^\n *         d          d_next\n *\n * @param {Array} diffs Array of diff tuples\n * @param {Int} cursor_pos Suggested edit position. Must not be out of bounds!\n * @return {Array} Array of diff tuples\n */\nfunction fix_cursor (diffs, cursor_pos) {\n  var norm = cursor_normalize_diff(diffs, cursor_pos);\n  var ndiffs = norm[1];\n  var cursor_pointer = norm[0];\n  var d = ndiffs[cursor_pointer];\n  var d_next = ndiffs[cursor_pointer + 1];\n\n  if (d == null) {\n    // Text was deleted from end of original string,\n    // cursor is now out of bounds in new string\n    return diffs;\n  } else if (d[0] !== DIFF_EQUAL) {\n    // A modification happened at the cursor location.\n    // This is the expected outcome, so we can return the original diff.\n    return diffs;\n  } else {\n    if (d_next != null && d[1] + d_next[1] === d_next[1] + d[1]) {\n      // Case 1)\n      // It is possible to perform a naive shift\n      ndiffs.splice(cursor_pointer, 2, d_next, d)\n      return merge_tuples(ndiffs, cursor_pointer, 2)\n    } else if (d_next != null && d_next[1].indexOf(d[1]) === 0) {\n      // Case 2)\n      // d[1] is a prefix of d_next[1]\n      // We can assume that d_next[0] !== 0, since d[0] === 0\n      // Shift edit locations..\n      ndiffs.splice(cursor_pointer, 2, [d_next[0], d[1]], [0, d[1]]);\n      var suffix = d_next[1].slice(d[1].length);\n      if (suffix.length > 0) {\n        ndiffs.splice(cursor_pointer + 2, 0, [d_next[0], suffix]);\n      }\n      return merge_tuples(ndiffs, cursor_pointer, 3)\n    } else {\n      // Not possible to perform any modification\n      return diffs;\n    }\n  }\n}\n\n/*\n * Check diff did not split surrogate pairs.\n * Ex. [0, '\\uD83D'], [-1, '\\uDC36'], [1, '\\uDC2F'] -> [-1, '\\uD83D\\uDC36'], [1, '\\uD83D\\uDC2F']\n *     '\\uD83D\\uDC36' === 'ðŸ¶', '\\uD83D\\uDC2F' === 'ðŸ¯'\n *\n * @param {Array} diffs Array of diff tuples\n * @return {Array} Array of diff tuples\n */\nfunction fix_emoji (diffs) {\n  var compact = false;\n  var starts_with_pair_end = function(str) {\n    return str.charCodeAt(0) >= 0xDC00 && str.charCodeAt(0) <= 0xDFFF;\n  }\n  var ends_with_pair_start = function(str) {\n    return str.charCodeAt(str.length-1) >= 0xD800 && str.charCodeAt(str.length-1) <= 0xDBFF;\n  }\n  for (var i = 2; i < diffs.length; i += 1) {\n    if (diffs[i-2][0] === DIFF_EQUAL && ends_with_pair_start(diffs[i-2][1]) &&\n        diffs[i-1][0] === DIFF_DELETE && starts_with_pair_end(diffs[i-1][1]) &&\n        diffs[i][0] === DIFF_INSERT && starts_with_pair_end(diffs[i][1])) {\n      compact = true;\n\n      diffs[i-1][1] = diffs[i-2][1].slice(-1) + diffs[i-1][1];\n      diffs[i][1] = diffs[i-2][1].slice(-1) + diffs[i][1];\n\n      diffs[i-2][1] = diffs[i-2][1].slice(0, -1);\n    }\n  }\n  if (!compact) {\n    return diffs;\n  }\n  var fixed_diffs = [];\n  for (var i = 0; i < diffs.length; i += 1) {\n    if (diffs[i][1].length > 0) {\n      fixed_diffs.push(diffs[i]);\n    }\n  }\n  return fixed_diffs;\n}\n\n/*\n * Try to merge tuples with their neigbors in a given range.\n * E.g. [0, 'a'], [0, 'b'] -> [0, 'ab']\n *\n * @param {Array} diffs Array of diff tuples.\n * @param {Int} start Position of the first element to merge (diffs[start] is also merged with diffs[start - 1]).\n * @param {Int} length Number of consecutive elements to check.\n * @return {Array} Array of merged diff tuples.\n */\nfunction merge_tuples (diffs, start, length) {\n  // Check from (start-1) to (start+length).\n  for (var i = start + length - 1; i >= 0 && i >= start - 1; i--) {\n    if (i + 1 < diffs.length) {\n      var left_d = diffs[i];\n      var right_d = diffs[i+1];\n      if (left_d[0] === right_d[1]) {\n        diffs.splice(i, 2, [left_d[0], left_d[1] + right_d[1]]);\n      }\n    }\n  }\n  return diffs;\n}\n","\nexport function shallowEqual(objA, objB) {\n  return valueEqual(objA, objB, strictEqual);\n}\n\nexport function deepEqual(objA, objB) {\n  return valueEqual(objA, objB, valueEqual);\n}\n\nfunction strictEqual(valueA, valueB) {\n  return valueA === valueB;\n}\n\nfunction valueEqual(valueA, valueB, propEqual) {\n  if (valueA === valueB) return true;\n  if (valueA instanceof Date && valueB instanceof Date) return valueA.getTime() === valueB.getTime();\n  if (!valueA || !valueB || typeof valueA !== 'object' && typeof valueB !== 'object')\n    return valueA === valueB;\n  return objectEqual(valueA, valueB, propEqual);\n}\n\nfunction objectEqual(objA, objB, propEqual) {\n  if (objA.prototype !== objB.prototype) return false;\n  const keysA = Object.keys(objA);\n  const keysB = Object.keys(objB);\n  if (keysA.length !== keysB.length) return false;\n  return keysA.every((key, i) => key === keysB[i] && propEqual(objA[key], objB[key], propEqual));\n}\n","import diff from './diff';\nimport { deepEqual } from './equal';\n\nconst NULL_CHARACTER = String.fromCharCode(0);  // Placeholder char for embed in diff()\n\nexport default class Delta {\n\n  constructor(ops = []) {\n    this.ops = ops;\n  }\n\n  /**\n   * Appends an insert operation. Returns this for chainability.\n   *\n   * @param {String|Object} text Represents text or embed to insert\n   * @param {Object} attributes Optional attributes to apply\n   */\n  insert(text, attributes) {\n    var newOp = {};\n    if (text.length === 0) return this;\n    newOp.insert = text;\n    if (attributes != null && typeof attributes === 'object' && Object.keys(attributes).length > 0) {\n      newOp.attributes = attributes;\n    }\n    return this._push(newOp);\n  }\n\n  /**\n   * Appends a delete operation. Returns this for chainability.\n   *\n   * @param {Number} length Number of characters to delete\n   */\n  delete(length) {\n    if (length <= 0) return this;\n    return this._push({ delete: length });\n  }\n\n  /**\n   * Appends a retain operation. Returns this for chainability.\n   *\n   * @param {Number} length Number of characters to retain\n   * @param {Object} attributes Optional attributes to apply\n   * @returns {Delta} This delta\n   */\n  retain(length, attributes) {\n    if (length <= 0) return this;\n    var newOp = { retain: length };\n    if (attributes != null && typeof attributes === 'object' && Object.keys(attributes).length > 0) {\n      newOp.attributes = attributes;\n    }\n    return this._push(newOp);\n  }\n\n  /**\n   * Freezes delta from future modifications. Returns this for chainability.\n   *\n   * @returns {Delta} This delta\n   */\n  freeze() {\n    this._push = () => this;\n    return this;\n  }\n\n  /**\n   * Adds a new operation. Returns this for chainability.\n   *\n   * @param {Object} newOp A new operation\n   * @returns {Delta} This delta\n   */\n  _push(newOp) {\n    var index = this.ops.length;\n    var lastOp = this.ops[index - 1];\n    if (typeof lastOp === 'object') {\n      if (typeof newOp.delete === 'number' && typeof lastOp.delete === 'number') {\n        this.ops[index - 1] = { delete: lastOp.delete + newOp.delete };\n        return this;\n      }\n      // Since it does not matter if we insert before or after deleting at the same index,\n      // always prefer to insert first\n      if (typeof lastOp.delete === 'number' && newOp.insert != null) {\n        index -= 1;\n        lastOp = this.ops[index - 1];\n        if (typeof lastOp !== 'object') {\n          this.ops.unshift(newOp);\n          return this;\n        }\n      }\n      if (deepEqual(newOp.attributes, lastOp.attributes)) {\n        if (typeof newOp.insert === 'string' && typeof lastOp.insert === 'string') {\n          this.ops[index - 1] = { insert: lastOp.insert + newOp.insert };\n          if (typeof newOp.attributes === 'object') this.ops[index - 1].attributes = newOp.attributes\n          return this;\n        } else if (typeof newOp.retain === 'number' && typeof lastOp.retain === 'number') {\n          this.ops[index - 1] = { retain: lastOp.retain + newOp.retain };\n          if (typeof newOp.attributes === 'object') this.ops[index - 1].attributes = newOp.attributes\n          return this;\n        }\n      }\n    }\n    if (index === this.ops.length) {\n      this.ops.push(newOp);\n    } else {\n      this.ops.splice(index, 0, newOp);\n    }\n    return this;\n  }\n\n  /**\n   * Chops off trailing retain instructions to make the delta concise.\n   *\n   * @returns {Delta} This delta\n   */\n  chop() {\n    var lastOp = this.ops[this.ops.length - 1];\n    if (lastOp && lastOp.retain && !lastOp.attributes) {\n      this.ops.pop();\n    }\n    return this;\n  }\n\n  /**\n   * Returns an iterator to iterate over the operations of this delta.\n   *\n   * @returns {Iterator} An operation iterator with methods hasNext, next, peek, peekLength, & peekType\n   */\n  iterator() {\n    return new Iterator(this.ops);\n  }\n\n  /**\n   * Returns an array of operations that passes a given function.\n   *\n   * @param {Function} predicate Function to test each operation against. Return true to keep the operation, false\n   *                             otherwise\n   * @returns {Array} Filtered resulting array\n   */\n  filter(predicate) {\n    return this.ops.filter(predicate);\n  }\n\n  /**\n   * Iterates through operations, calling the provided function for each operation.\n   *\n   * @param {Function} predicate Function to call during iteration, passing in the current operation\n   */\n  forEach(predicate) {\n    this.ops.forEach(predicate);\n  }\n\n  /**\n   * Returns a new array with the results of calling provided function on each operation.\n   *\n   * @param {Function} predicate Function to call, passing in the current operation, returning an element of the new\n   *                             array to be returned\n   * @returns {Array} A new array with each element being the result of the given function\n   */\n  map(predicate) {\n    return this.ops.map(predicate);\n  }\n\n  /**\n   * Create an array of two arrays, the first with operations that pass the given function, the other that failed.\n   *\n   * @param {Function} predicate Function to call, passing in the current operation, returning whether that operation\n   *                             passed\n   * @returns {Array} A new array of two Arrays, the first with passed operations, the other with failed operations\n   */\n  partition(predicate) {\n    var passed = [], failed = [];\n    this.forEach(op => {\n      var target = predicate(op) ? passed : failed;\n      target.push(op);\n    });\n    return [passed, failed];\n  }\n\n  /**\n   * Applies given function against an accumulator and each operation to reduce to a single value.\n   *\n   * @param {Function} predicate Function to call per iteration, returning an accumulated value\n   * @param {*} initial Initial value to pass to first call to predicate\n   * @returns {*} The accumulated value\n   */\n  reduce(predicate, initial) {\n    return this.ops.reduce(predicate, initial);\n  }\n\n  changeLength() {\n    return this.reduce((length, entry) => {\n      if (entry.insert) {\n        return length + getOpLength(entry);\n      } else if (entry.delete) {\n        return length - entry.delete;\n      }\n      return length;\n    }, 0);\n  }\n\n  /**\n   * Returns length of a Delta, which is the sum of the lengths of its operations.\n   *\n   * @returns {Number} The length of this delta\n   */\n  length() {\n    return this.reduce((length, entry) => {\n      return length + getOpLength(entry);\n    }, 0);\n  }\n\n  /**\n   * Returns copy of delta with subset of operations.\n   *\n   * @param {Number} start Start index of subset, defaults to 0\n   * @param {Number} end End index of subset, defaults to rest of operations\n   * @returns {Array} An array slice of the operations\n   */\n  slice(start = 0, end) {\n    if (typeof end !== 'number') end = Infinity;\n    var ops = [];\n    var iter = this.iterator();\n    var index = 0;\n    while (index < end && iter.hasNext()) {\n      var nextOp;\n      if (index < start) {\n        nextOp = iter.next(start - index);\n      } else {\n        nextOp = iter.next(end - index);\n        ops.push(nextOp);\n      }\n      index += getOpLength(nextOp);\n    }\n    return new Delta(ops);\n  }\n\n  /**\n   * Returns a Delta that is equivalent to applying the operations of own Delta, followed by another Delta.\n   *\n   * @param {Delta} other Delta to compose\n   */\n  compose(other) {\n    var thisIter = this.iterator();\n    var otherIter = other.iterator();\n    var delta = new Delta();\n    while (thisIter.hasNext() || otherIter.hasNext()) {\n      if (otherIter.peekType() === 'insert') {\n        delta._push(otherIter.next());\n      } else if (thisIter.peekType() === 'delete') {\n        delta._push(thisIter.next());\n      } else {\n        var length = Math.min(thisIter.peekLength(), otherIter.peekLength());\n        var thisOp = thisIter.next(length);\n        var otherOp = otherIter.next(length);\n        if (typeof otherOp.retain === 'number') {\n          var newOp = {};\n          if (typeof thisOp.retain === 'number') {\n            newOp.retain = length;\n          } else {\n            newOp.insert = thisOp.insert;\n          }\n          // Preserve null when composing with a retain, otherwise remove it for inserts\n          var attributes = composeAttributes(thisOp.attributes, otherOp.attributes, typeof thisOp.retain === 'number');\n          if (attributes) newOp.attributes = attributes;\n          delta._push(newOp);\n        // Other op should be delete, we could be an insert or retain\n        // Insert + delete cancels out\n        } else if (typeof otherOp.delete === 'number' && typeof thisOp.retain === 'number') {\n          delta._push(otherOp);\n        }\n      }\n    }\n    return delta.chop();\n  }\n\n  /**\n   * Returns a new Delta representing the concatenation of this and another document Delta's operations.\n   *\n   * @param {Delta} other Document Delta to concatenate\n   * @returns {Delta} Concatenated document Delta\n   */\n  concat(other) {\n    var delta = new Delta(this.ops.slice());\n    if (other.ops.length > 0) {\n      delta._push(other.ops[0]);\n      delta.ops = delta.ops.concat(other.ops.slice(1));\n    }\n    return delta;\n  }\n\n  /**\n   * Returns a Delta representing the difference between two documents. Optionally, accepts a suggested index where\n   * change took place, often representing a cursor position before change.\n   *\n   * @param {Delta} other Document Delta to diff against\n   * @param {Number} index Suggested index where change took place\n   * @returns {Delta} Difference between the two documents\n   */\n  diff(other, index) {\n    if (this.ops === other.ops) {\n      return new Delta();\n    }\n    var strings = [this, other].map((delta) => {\n      return delta.map((op) => {\n        if (op.insert != null) {\n          return typeof op.insert === 'string' ? op.insert : NULL_CHARACTER;\n        }\n        var prep = (delta === other) ? 'on' : 'with';\n        throw new Error('diff() called ' + prep + ' non-document');\n      }).join('');\n    });\n    var delta = new Delta();\n    var diffResult = diff(strings[0], strings[1], index);\n    var thisIter = this.iterator();\n    var otherIter = other.iterator();\n    diffResult.forEach((component) => {\n      var length = component[1].length;\n      while (length > 0) {\n        var opLength = 0;\n        switch (component[0]) {\n          case diff.INSERT:\n            opLength = Math.min(otherIter.peekLength(), length);\n            delta._push(otherIter.next(opLength));\n            break;\n          case diff.DELETE:\n            opLength = Math.min(length, thisIter.peekLength());\n            thisIter.next(opLength);\n            delta.delete(opLength);\n            break;\n          case diff.EQUAL:\n            opLength = Math.min(thisIter.peekLength(), otherIter.peekLength(), length);\n            var thisOp = thisIter.next(opLength);\n            var otherOp = otherIter.next(opLength);\n            if (deepEqual(thisOp.insert, otherOp.insert)) {\n              delta.retain(opLength, diffAttributes(thisOp.attributes, otherOp.attributes));\n            } else {\n              delta._push(otherOp).delete(opLength);\n            }\n            break;\n        }\n        length -= opLength;\n      }\n    });\n    return delta.chop();\n  }\n\n  /**\n   * Iterates through document Delta, calling a given function with a Delta and attributes object, representing the line\n   * segment.\n   *\n   * @param {Function} predicate Function to call on each line group\n   * @param {String} newline Newline character, defaults to \\n\n   */\n  eachLine(predicate, newline = '\\n') {\n    var iter = this.iterator();\n    var ops = new Delta();\n    var index = 0;\n    var lineStart = 0;\n    var currentIndex = 0;\n\n    while (iter.hasNext()) {\n      if (iter.peekType() !== 'insert') return;\n\n      var op = iter.peek();\n      var nextLength = iter.peekLength();\n      var start = getOpLength(op) - nextLength;\n      var newlineIndex = typeof op.insert === 'string' ? op.insert.indexOf(newline, start) - start : -1;\n\n      if (newlineIndex < 0) {\n        currentIndex += nextLength;\n        ops._push(iter.next());\n      } else if (newlineIndex > 0) {\n        currentIndex += newlineIndex;\n        ops._push(iter.next(newlineIndex));\n      } else {\n        currentIndex += 1;\n        var attributes = iter.next(1).attributes || {};\n        var line = { ops, attributes, start: lineStart, end: currentIndex, index: index };\n        if (predicate(line, index) === false) {\n          return;\n        }\n        index += 1;\n        lineStart = currentIndex;\n        ops = new Delta();\n      }\n    }\n    if (ops.length() > 0) {\n      var line = { ops, attributes: {}, start: lineStart, end: currentIndex, index };\n      predicate(line, index);\n    }\n  }\n\n  // Extends Delta, get the lines from `from` to `to`.\n  getLines(from = 0, to = Infinity, newline) {\n    const lines = [];\n    this.eachLine(line => {\n      if (line.start > to || (line.start === to && from !== to)) return false;\n      if (line.end > from) {\n        lines.push(line);\n      }\n    }, newline);\n    return lines;\n  }\n\n  // Extends Delta, get the line at `at`.\n  getLine(at, newline) {\n    return this.getLines(at, at, newline)[0];\n  }\n\n  // Extends Delta, get the ops from `from` to `to`.\n  getOps(from, to) {\n    let start = 0;\n    const ops = [];\n    this.ops.some(op => {\n      if (start >= to) return true;\n      const end = start + getOpLength(op);\n      if (end > from || (from === to && end === to)) {\n        ops.push({ op, start, end });\n      }\n      start = end;\n    });\n    return ops;\n  }\n\n  // Extends Delta, get the op at `at`.\n  getOp(at) {\n    return this.getOps(at, at)[0];\n  }\n\n  /**\n   * Transform given Delta against own operations. Used as an alias for transformPosition when called with a number.\n   *\n   * @param {Delta} other Delta to transform\n   * @param {Boolean} priority Boolean used to break ties. If true, then this takes priority over other, that is, its\n   *                           actions are considered to happen \"first.\"\n   * @returns {Delta} Transformed Delta\n   */\n  transform(other, priority = false) {\n    if (typeof other === 'number') {\n      return this.transformPosition(other, priority);\n    }\n    var thisIter = this.iterator();\n    var otherIter = other.iterator();\n    var delta = new Delta();\n    while (thisIter.hasNext() || otherIter.hasNext()) {\n      if (thisIter.peekType() === 'insert' && (priority || otherIter.peekType() !== 'insert')) {\n        delta.retain(getOpLength(thisIter.next()));\n      } else if (otherIter.peekType() === 'insert') {\n        delta._push(otherIter.next());\n      } else {\n        var length = Math.min(thisIter.peekLength(), otherIter.peekLength());\n        var thisOp = thisIter.next(length);\n        var otherOp = otherIter.next(length);\n        if (thisOp.delete) {\n          // Our delete either makes their delete redundant or removes their retain\n          continue;\n        } else if (otherOp.delete) {\n          delta._push(otherOp);\n        } else {\n          // We retain either their retain or insert\n          delta.retain(length, transformAttributes(thisOp.attributes, otherOp.attributes, priority));\n        }\n      }\n    }\n    return delta.chop();\n  }\n\n  /**\n   * Transform an index against the delta. Useful for representing cursor/selection positions.\n   *\n   * @param {Number} index Index to transform\n   * @param {Boolean} priority Boolean used to break ties. If true, then this takes priority over other, that is, its\n   *                           actions are considered to happen \"first.\"\n   * @returns {Number} Transformed index\n   */\n  transformPosition(index, priority = false) {\n    var thisIter = this.iterator();\n    var offset = 0;\n    while (thisIter.hasNext() && offset <= index) {\n      var length = thisIter.peekLength();\n      var nextType = thisIter.peekType();\n      thisIter.next();\n      if (nextType === 'delete') {\n        index -= Math.min(length, index - offset);\n        continue;\n      } else if (nextType === 'insert' && (offset < index || !priority)) {\n        index += length;\n      }\n      offset += length;\n    }\n    return index;\n  }\n\n}\n\n\n/**\n * Create an attributes object that is equivalent to applying the attributes of the target followed by the source.\n *\n * @param {Object} target Target attributes object which will have the source applied to\n * @param {Object} source Source attributes object being applied to the target\n * @param {Boolean} keepNull Whether to keep null values from source\n * @returns {Object} A new attributes object (or undefined if empty) with both\n */\nexport function composeAttributes(target = {}, source = {}, keepNull) {\n  var attributes = { ...target, ...source };\n\n  if (!keepNull) Object.keys(attributes).forEach(key => {\n    if (attributes[key] == null) delete attributes[key];\n  });\n\n  return Object.keys(attributes).length > 0 ? attributes : undefined;\n}\n\n/**\n * Finds the difference between two attributes objects. Returns the source attributes that are different from the\n * target attributes.\n *\n * @param {Object} target An attributes object\n * @param {Object} source An attributes object\n * @returns {Object} The difference between the two attribute objects or undefined if there is none\n */\nexport function diffAttributes(target = {}, source = {}) {\n  var attributes = Object.keys(target).concat(Object.keys(source)).reduce((attributes, key) => {\n    if (!deepEqual(target[key], source[key])) {\n      attributes[key] = source[key] === undefined ? null : source[key];\n    }\n    return attributes;\n  }, {});\n\n  return Object.keys(attributes).length > 0 ? attributes : undefined;\n}\n\n/**\n * Transforms the attributes of source over target (or the other way around if priority is set). Will return an\n * attributes object which has all the values from source if priority if false or will have the values from source that\n * are set on target.\n *\n * @param {Object} target An attributes object\n * @param {Object} source An attributes object\n * @param {Boolean} priority If target has priority over source\n */\nexport function transformAttributes(target, source, priority) {\n  if (typeof target !== 'object') return source;\n  if (typeof source !== 'object') return undefined;\n  if (!priority) return source;  // b simply overwrites us without priority\n\n  var attributes = Object.keys(source).reduce((attributes, key) => {\n    if (target[key] === undefined) attributes[key] = source[key];  // null is a valid value\n    return attributes;\n  }, {});\n\n  return Object.keys(attributes).length > 0 ? attributes : undefined;\n}\n\n/**\n * Determines the length of a Delta operation.\n *\n * @param {Object} op An operation entry from a Delta object\n * @returns {Number} The length of the op\n */\nexport function getOpLength(op) {\n  if (typeof op.delete === 'number') {\n    return op.delete;\n  } else if (typeof op.retain === 'number') {\n    return op.retain;\n  } else {\n    return typeof op.insert === 'string' ? op.insert.length : 1;\n  }\n}\n\n/**\n * An iterator to handle iterating over a list of Delta operations efficiently.\n */\nexport class Iterator {\n\n  constructor(ops) {\n    this.ops = ops;\n    this.index = 0;\n    this.offset = 0;\n  }\n\n  /**\n   * Determine if there will be another operation returned by `next`.\n   *\n   * @returns {Boolean} Whether there are more operations to iterate over\n   */\n  hasNext() {\n    return this.peekLength() < Infinity;\n  }\n\n  /**\n   * Get the next operation, optionally limited/sliced by length. If an operation is sliced by length, the next call to\n   * `next` will return more of that operation until it is returned in full.\n   *\n   * @param {Number} length Optionally limit the returned operation by length, slicing it down as needed\n   */\n  next(length = Infinity) {\n    var nextOp = this.ops[this.index];\n    if (!nextOp) return { retain: Infinity };\n\n    var offset = this.offset;\n    var opLength = getOpLength(nextOp);\n\n    // Update index and offset\n    if (length >= opLength - offset) {\n      length = opLength - offset;\n      this.index += 1;\n      this.offset = 0;\n    } else {\n      this.offset += length;\n    }\n\n    if (typeof nextOp.delete === 'number') {\n      return { delete: length };\n    } else {\n      var retOp = {};\n      if (nextOp.attributes) {\n        retOp.attributes = nextOp.attributes;\n      }\n\n      if (typeof nextOp.retain === 'number') {\n        retOp.retain = length;\n      } else if (typeof nextOp.insert === 'string') {\n        retOp.insert = nextOp.insert.substr(offset, length);\n      } else {\n        // offset should === 0, length should === 1\n        retOp.insert = nextOp.insert;\n      }\n      return retOp;\n    }\n  }\n\n  /**\n   * Return the next entry.\n   *\n   * @returns {Object} The next entry in the ops array.\n   */\n  peek() {\n    return this.ops[this.index];\n  }\n\n  /**\n   * Check the length of the next entry.\n   *\n   * @returns {Number} The length of the next entry or Infinity if there is no next entry\n   */\n  peekLength() {\n    if (this.ops[this.index]) {\n      // Should never return 0 if our index is being managed correctly\n      return getOpLength(this.ops[this.index]) - this.offset;\n    } else {\n      return Infinity;\n    }\n  }\n\n  /**\n   * Check the type of the next entry, delete, retain, or insert.\n   *\n   * @returns {String} The type of the next entry\n   */\n  peekType() {\n    if (this.ops[this.index]) {\n      if (typeof this.ops[this.index].delete === 'number') {\n        return 'delete';\n      } else if (typeof this.ops[this.index].retain === 'number') {\n        return 'retain';\n      } else {\n        return 'insert';\n      }\n    }\n    return 'retain';\n  }\n}\n","import EventDispatcher from './event-dispatcher';\nimport Delta from './delta';\nimport { shallowEqual, deepEqual } from './equal';\n\nconst SOURCE_API = 'api';\nconst SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst empty = {};\n\n/**\n * Event for text changes, called before the change has occurred. If a listener returns false the change will be\n * canceled and not committed.\n *\n * @event Editor#text-changing\n * @type  {Object}\n * @property {Delta} change       The change which is being applied to the content\n * @property {Delta} content      The new content after the change\n * @property {Delta} oldContent   The old content before the change\n * @property {Array} seleciton    The selection after the change\n * @property {Array} oldSelection The selection before the change\n * @property {String} source      The source of the change, api, user, or silent\n */\n\n/**\n * Event for text changes, called after the change has occurred.\n *\n * @event Editor#text-change\n * @type  {Object}\n * @property {Delta} change       The change which is being applied to the content\n * @property {Delta} content      The new content after the change\n * @property {Delta} oldContent   The old content before the change\n * @property {Array} seleciton    The selection after the change\n * @property {Array} oldSelection The selection before the change\n * @property {String} source      The source of the change, api, user, or silent\n */\n\n/**\n * Event for selection changes. If part of a text change the `change`, `content`, and `oldContent` properties will be\n * set. Otherwise they will not be set.\n *\n * @event Editor#selection-change\n * @type  {Object}\n * @property {Delta} change       [ Optional ] The change which is being applied to the content\n * @property {Delta} content      [ Optional ] The new content after the change\n * @property {Delta} oldContent   [ Optional ] The old content before the change\n * @property {Array} seleciton    The selection after the change\n * @property {Array} oldSelection The selection before the change\n * @property {String} source      The source of the change, api, user, or silent\n */\n\n/**\n * A Typewriter Editor handles the logic for selection and editing of contents. It has no dependency on browser APIs\n * and can be used in Node.js as easily as the browser. It has no logic to limit formatting (i.e. it does not disallow\n * using bold, headers, links, or FOOBAR), that will need to be limited outside of the editor itself.\n *\n * @fires Editor#text-changing\n * @fires Editor#text-change\n * @fires Editor#selection-change\n *\n * @readonly @property {Delta}  contents      The data model for the text editor\n * @readonly @property {Number} length        The length of the contents\n * @readonly @property {String} text          The text of the contents\n * @readonly @property {Array}  selection     The current editor selection, a tuple of `[ from, to ]` or `null`\n * @readonly @property {Object} activeFormats The currently active formats (formats that will apply on the next insert)\n */\nexport default class Editor extends EventDispatcher {\n\n  /**\n   * Create a new Typewriter editor.\n   *\n   * @param {Object} options Options for this editor include initial `contents` and `modules`:\n   * @param {Delta}  options.contents The initial contents of this editor\n   * @param {Array}  options.modules  An array of functions which will be executed with the editor being passed as an\n   *                                  argument.\n   */\n  constructor(options = {}) {\n    super();\n    this.contents = null;\n    this.length = 0;\n    this.selection = null;\n    this.activeFormats = empty;\n    setContents(this, options.contents || this.delta().insert('\\n'));\n    this.modules = {};\n    this._queuedEvents = []; // Event queuing ensure they are fired in order\n    if (options.modules) Object.keys(options.modules).forEach(key => this.modules[key] = options.modules[key](this));\n  }\n\n  /**\n   * Convenience method for creating a new delta (allows other modules to not need to require Delta). Used for creating\n   * change deltas for updating the contents.\n   *\n   * @param {Array} ops [Optional] The initial ops for the delta\n   * @returns {Delta}   A new Delta object\n   */\n  delta(ops) {\n    return new Delta(ops);\n  }\n\n  /**\n   * Returns the contents or a slice of them.\n   *\n   * @param {Number} from The starting index\n   * @param {Number} to   The ending index\n   * @returns {Delta}     The contents of this editor\n   */\n  getContents(from = 0, to = this.length) {\n    [ from, to ] = this._normalizeRange(from, to);\n    return this.contents.slice(from, to);\n  }\n\n  /**\n   * Returns the text for the editor or a slice of it.\n   *\n   * @param {Number} from The starting index\n   * @param {Number} to   The ending index\n   * @returns {String}    The text in the editor\n   */\n  getText(from = 0, to = this.length - 1) {\n    [ from, to ] = this._normalizeRange(from, to);\n    return this.getContents(from, to)\n      .filter(op => typeof op.insert === 'string')\n      .map(op => op.insert)\n      .join('');\n  }\n\n  /**\n   * Returns the text for the editor with null characters in place of embeds. This can be used to determine the index of\n   * given words or lines of text within the contents.\n   *\n   * @param {Number} from The starting index\n   * @param {Number} to   The ending index\n   * @returns {String}    The text in the editor with embed spaces\n   */\n  getExactText(from = 0, to = this.length - 1) {\n    [ from, to ] = this._normalizeRange(from, to);\n    return this.getContents(from, to)\n      .map(op => typeof op.insert === 'string' ? op.insert : '\\0')\n      .join('');\n  }\n\n  /**\n   * Set the selection to a new location (or null for no selection). Will return false if the new selection is the same\n   * as the old selection. Dispatches \"selection-change\" once the selection is changed. This \"selection-change\" event\n   * won't have { contents, oldContnts, change } in it since the selection is changing without any content updates.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Boolean}        Whether the selection changed or not\n   */\n  setSelection(from, to, source = SOURCE_USER) {\n    const oldSelection = this.selection;\n    let selection;\n\n    if (from === null) {\n      selection = null;\n      if (typeof to === 'string') source = to;\n    } else {\n      [from, to, source ] = this._normalizeSelection(from, to, source);\n      selection = [ from, to ].map(i => Math.min(i, this.length - 1));\n    }\n\n    if (shallowEqual(oldSelection, selection)) return false;\n\n    // Reset the active formats when selection changes (do this before setting selection)\n    this.activeFormats = selection ? this.getTextFormat(Math.min(selection[0], selection[1])) : empty;\n    this.selection = selection;\n    const event = { selection, oldSelection, source };\n\n    if (source !== SOURCE_SILENT) this.fire('selection-change', event);\n    this.fire('editor-change', event);\n    return true;\n  }\n\n  /**\n   * The method that all other methods use to update the contents (even setContents & setText). This method will\n   * dispatch the event \"text-changing\". If a listener returns `false` then the change will be canceled and null will\n   * be returned. Otherwise, the change will be successful and if the `source` is not \"silent\" a \"text-change\" event\n   * will be fired with an event object containing `{ contents, oldContents, selection, oldSelection, source }`. If the\n   * selection has changed as part of this update a \"selection-change\" event will also be fired with the same event\n   * object.\n   *\n   * @param {Delta} change    A delta change to the document\n   * @param {String} source   The source of the change, user, api, or silent\n   * @param {Array} selection Optional selection after the change has been applied\n   * @returns {Delta}         Returns the change when successful, or null if not\n   */\n  updateContents(change, source = SOURCE_API, selection) {\n    if (!change.chop().ops.length) return null;\n\n    const oldContents = this.contents;\n    const contents = normalizeContents(oldContents.compose(change));\n    const length = contents.length();\n    const oldSelection = this.selection;\n    if (!selection) selection = oldSelection ? oldSelection.map(i => change.transform(i)) : oldSelection;\n    selection = selection && this.getSelectedRange(selection, length - 1);\n\n    const changeEvent = { contents, oldContents, change, selection, oldSelection, source };\n    const selectionChanged = !shallowEqual(oldSelection, selection);\n\n    if (!this.fire('text-changing', changeEvent)) return null;\n\n    setContents(this, contents);\n\n    if (selection) {\n      // Reset the active formats when selection changes (do this before setting selection)\n      this.activeFormats = selection ? this.getTextFormat(Math.min(selection[0], selection[1])) : empty;\n      this.selection = selection;\n    }\n\n    const events = [];\n    if (source !== SOURCE_SILENT) {\n      events.push([ 'text-change', changeEvent ]);\n      if (selectionChanged) events.push([ 'selection-change', changeEvent ]);\n    }\n    events.push([ 'editor-change', changeEvent ]);\n    this._queueEvents(events);\n    return change;\n  }\n\n  /**\n   * Sets the entire contents of the editor. This will calculate the difference between the old content and the new and\n   * only apply the difference, if any.\n   *\n   * @param {Delta} newContents The contents of the editor, as a delta object\n   * @param {String} source     The source of the change, user, api, or silent\n   * @param {Array} selection   Optional selection after the change has been applied\n   * @returns {Delta}           Returns the change when successful, or null if not\n   */\n  setContents(newContents, source, selection) {\n    const change = this.contents.diff(normalizeContents(newContents));\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Sets the text content of the editor, removing existing contents and formatting.\n   *\n   * @param {String} text     Set the contents of this editor as text\n   * @param {String} source   The source of the change, user, api, or silent\n   * @param {Array} selection Optional selection after the change has been applied\n   * @returns {Delta}         Returns the change when successful, or null if not\n   */\n  setText(text, source, selection) {\n    return this.setContents(this.delta().insert(text + '\\n'), source, selection);\n  }\n\n  /**\n   * Inserts text into the content of the editor, removing text between from and to if provided. If `text` is a newline\n   * (\"\\n\") then the formats will apply to the line, otherwise they will apply to the text only (even if there are\n   * newlines in the text).\n   *\n   * @param {Number} from      Insert the text at this index, can also be a range Array tuple, default 0\n   * @param {Number} to        If provided and not equal to `from` will delete the text between `from` and `to`\n   * @param {String} text      The text to insert into the editor's contents\n   * @param {String} formats   The formats of the inserted text. If null the formats at `from` will be used.\n   * @param {String} source    The source of the change, user, api, or silent\n   * @param {Array}  selection Optional selection after the change has been applied\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  insertText(from, to, text, formats, source, selection) {\n    [ from, to, text, formats, source, selection ] =\n      this._normalizeRange(from, to, text, formats, source, selection);\n\n    // If we are not inserting a newline, make sure from and to are within the selectable range\n    if (text !== '\\n') [ from, to ] = this.getSelectedRange([ from, to ]);\n\n    if (typeof formats === 'string') [ formats, source, selection ] = [ null, formats, source ];\n    if (selection == null && this.selection !== null) selection = from + text.length;\n    let change = this.delta().retain(from).delete(to - from);\n\n    if (text === '\\n') {\n      change.insert('\\n', formats || this.getLineFormat(from));\n    } else {\n      const lineFormat = text.indexOf('\\n') === -1 ? null : this.getLineFormat(from);\n      const textFormat = formats || this.getTextFormat(from);\n      text.split('\\n').forEach((line, i) => {\n        if (i) change.insert('\\n', lineFormat);\n        line.length && change.insert(line, textFormat);\n      });\n    }\n\n    change = cleanDelete(this, from, to, change);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Inserts an embed into the content of the editor, removing text between from and to if provided.\n   *\n   * @param {Number} from      Insert the embed at this index, can also be a range Array tuple, default 0\n   * @param {Number} to        If provided and not equal to `from` will delete the text between `from` and `to`\n   * @param {String} embed     Insert the text into the editor's contents\n   * @param {mixed}  value     Insert the text into the editor's contents\n   * @param {String} formats   The formats of the inserted text. If null the formats at `from` will be used.\n   * @param {String} source    The source of the change, user, api, or silent\n   * @param {Array}  selection Optional selection after the change has been applied\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  insertEmbed(from, to, embed, value, formats, source, selection) {\n    [ from, to, embed, value, source, selection ] =\n      this._normalizeRange(from, to, embed, value, source, selection);\n    if (typeof formats === 'string') [ formats, source, selection ] = [ null, formats, source ];\n    if (from >= this.length) from = this.length - 1;\n    if (to >= this.length) to = this.length - 1;\n    if (selection == null && this.selection !== null) selection = from + 1;\n    const textFormat = formats || this.getTextFormat(from);\n    let change = this.delta().retain(from).delete(to - from).insert({ [embed]: value }, textFormat);\n    change = cleanDelete(this, from, to, change);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Deletes text from `from` to `to`.\n   *\n   * @param {Number} from      Insert the text as this index, can also be a range Array tuple, default 0\n   * @param {Number} to        Will delete the text between `from` and `to`\n   * @param {String} source    The source of the change, user, api, or silent\n   * @param {Array}  selection Optional selection after the change has been applied\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  deleteText(from, to, source, selection) {\n    [ from, to, source, selection ] = this._normalizeRange(from, to, source, selection);\n    if (from === to) return null;\n    if (selection == null && this.selection !== null) selection = from;\n    let change = this.delta().retain(from).delete(to - from);\n    change = cleanDelete(this, from, to, change);\n\n    // Keep the active format of the text to the right of the cursor when deleting\n    let activeFormats;\n    if (selection === from) activeFormats = this.getTextFormat(from, from + 1);\n\n    const result = this.updateContents(change, source, selection);\n\n    if (result && activeFormats) this.activeFormats = activeFormats;\n    return result;\n  }\n\n  /**\n   * Get the line formats for the line that `from` is in to the line that `to` is in. Returns only the common formats\n   * between all the lines. If `from` equals `to` (or `to` is not provided) the formats will be all of those for the\n   * line `from` is on. If two lines are touched and they have different formats, an empty object will be returned.\n   *\n   * @param {Number} from Getting line formats starting at `from`\n   * @param {Number} to   Getting line formats ending at `to`\n   * @returns {Object}    An object with all the common formats among the lines which intersect from and to\n   */\n  getLineFormat(from, to) {\n    [ from, to ] = this._normalizeRange(from, to);\n    let formats;\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!line.attributes) formats = {};\n      else if (!formats) formats = { ...line.attributes };\n      else formats = combineFormats(formats, line.attributes);\n    });\n\n    return formats;\n  }\n\n  /**\n   * Get the text formats for all the text from `from` to `to`. Returns only the common formats between the two indexes.\n   * Will also return the `activeFormats`. Active formats are those which are toggled on when the selection is collapsed\n   * (from and to are equal) indicating inserted text should use (or not use) those formats.\n   *\n   * @param {Number} from Getting text formats starting at `from`\n   * @param {Number} to   Getting text formats ending at `to`\n   * @returns {Object}    An object with all the common formats among the text\n   */\n  getTextFormat(from, to) {\n    [ from, to ] = this._normalizeRange(from, to);\n    let formats;\n\n    // optimize for current selection\n    const seleciton = this.selection;\n    if (from === to && shallowEqual(this.selection, [ from, to ])) {\n      return this.activeFormats;\n    }\n\n    this.contents.getOps(from, to).forEach(({ op }) => {\n      if (/^\\n+$/.test(op.insert)) return;\n      if (!op.attributes) formats = {};\n      else if (!formats) formats = { ...op.attributes };\n      else formats = combineFormats(formats, op.attributes);\n    });\n\n    if (!formats) formats = {};\n\n    return formats;\n  }\n\n  /**\n   * Get the text and line formats for all the lines and text from `from` to `to`.\n   *\n   * @param {Number} from Getting line and text formats starting at `from`\n   * @param {Number} to   Getting line and text formats ending at `to`\n   * @returns {Object}    An object with all the common formats among the lines and text which intersect from and to\n   */\n  getFormat(from, to) {\n    return { ...this.getTextFormat(from, to), ...this.getLineFormat(from, to) };\n  }\n\n  /**\n   * Formats the lines intersected by `from` and `to` with the given line formats. To remove an existing format pass in\n   * `null` or `false` to turn it off (e.g. `{ blockquote: false }`).\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the line\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  formatLine(from, to, formats, source) {\n    [ from, to, formats, source ] = this._normalizeRange(from, to, formats, source);\n    const change = this.delta();\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!change.ops.length) change.retain(line.end - 1);\n      else change.retain(line.end - line.start - 1);\n      // Clear out old formats on the line\n      Object.keys(line.attributes).forEach(name => !formats[name] && (formats[name] = null));\n      change.retain(1, formats);\n    });\n    change.chop();\n\n    return change.ops.length ? this.updateContents(change, source) : null;\n  }\n\n  /**\n   * Adds additional attributes or classes to the lines intersected by `from` and `to`. Markups are easy to nest to add\n   * additional attributes/classes, but you cannot do that with lines/blocks.\n   * Setting a class to false will remove a previous decoration, but it will not remove a class which is part of the\n   * block definition. This method is a cross-over with HTML view and should be used sparingly.\n   *\n   * Example:\n   * ```js\n   * editor.decorateLine(0, {\n   *   attributes: { 'data-placeholder': 'Enter Text' },\n   *   classes: { active: true, empty: true }\n   * });\n   * // <p data-placeholder=\"Enter Text\" class=\"active empty\">\n   * ```\n   *\n   * @param {Number} from        The starting index\n   * @param {Number} to          The ending index\n   * @param {String} decorations The attributes/classes for the line.\n   * @param {String} source      The source of the change, user, api, or silent\n   * @returns {Delta}            Returns the change when successful, or null if not\n   */\n  decorateLine(from, to, decorations, source) {\n    [ from, to, decorations, source ] = this._normalizeRange(from, to, decorations, source);\n    const change = this.delta();\n\n    if (decorations.attributes) {\n      Object.keys(decorations.attributes).forEach(name => {\n        if (decorations.attributes[name] === '') decorations.attributes[name] = true;\n      });\n    }\n\n    this.contents.getLines(from, to).forEach(line => {\n      if (!change.ops.length) change.retain(line.end - 1);\n      else change.retain(line.end - line.start - 1);\n      let { attributes, classes } = decorations;\n\n      // Merge with any existing formats on the line\n      if (attributes) {\n        if (line.attributes.attributes) {\n          decorations = { ...decorations, attributes: { ...line.attributes.attributes, ...attributes }};\n        }\n\n        Object.keys(attributes).forEach(name => {\n          const value = attributes[name];\n          if (value == null || value === false) delete decorations.attributes[name];\n        });\n\n        if (!Object.keys(decorations.attributes).length) {\n          decorations = { ...decorations, attributes: null };\n        }\n      }\n      if (classes) {\n        if (line.attributes.classes) {\n          decorations = { ...decorations, classes: { ...line.attributes.classes, ...classes }};\n        }\n\n        Object.keys(classes).forEach(name => {\n          if (!classes[name]) delete decorations.classes[name];\n        });\n\n        if (!Object.keys(decorations.classes).length) {\n          decorations = { ...decorations, classes: null };\n        }\n      }\n\n      change.retain(1, decorations);\n    });\n    change.chop();\n\n    return change.ops.length ? this.updateContents(change, source) : null;\n  }\n\n  /**\n   * Formats the text from `from` to `to` with the given text formats. To remove an existing format pass in `null` or\n   * `false` to turn it off (e.g. `{ bold: false }`).\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the text\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  formatText(from, to, formats, source) {\n    [ from, to, formats, source ] = this._normalizeRange(from, to, formats, source);\n    if (from === to) {\n      if (this.activeFormats === empty) this.activeFormats = {};\n      Object.keys(formats).forEach(key => {\n        const value = formats[key];\n        if (value == null || value === false) delete this.activeFormats[key];\n        else this.activeFormats[key] = value;\n      });\n      return;\n    }\n    Object.keys(formats).forEach(name => formats[name] === false && (formats[name] = null));\n    const change = this.delta().retain(from);\n    this.getText(from, to).split('\\n').forEach(line => {\n      line.length && change.retain(line.length, formats);\n      change.retain(1);\n    });\n    change.chop();\n\n    return this.updateContents(change, source);\n  }\n\n  /**\n   * Toggles the line formats from `from` to `to` with the given line formats. If the line has the exact formats already\n   * they will be removed, otherwise they will be added.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the line\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  toggleLineFormat(from, to, format, source) {\n    [ from, to, format, source ] = this._normalizeRange(from, to, format, source);\n    const existing = this.getLineFormat(from, to);\n    if (deepEqual(existing, format)) {\n      Object.keys(format).forEach(key => format[key] = null);\n    }\n    return this.formatLine(from, to, format, source);\n  }\n\n  /**\n   * Toggles the text formats from `from` to `to` with the given text formats. If the text has the exact formats already\n   * they will be removed, otherwise they will be added.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the text\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  toggleTextFormat(from, to, format, source) {\n    [ from, to, format, source ] = this._normalizeRange(from, to, format, source);\n    const existing = this.getTextFormat(from, to);\n    const isSame = Object.keys(format).every(key => format[key] === existing[key]);\n    if (isSame) {\n      Object.keys(format).forEach(key => format[key] = null);\n    }\n    return this.formatText(from, to, format, source);\n  }\n\n  /**\n   * Removes all formatting, text and line formats, for the text and lines from `from` to `to`.\n   *\n   * @param {Number} from      The starting index\n   * @param {Number} to        The ending index\n   * @param {String} formats   The formats for the text\n   * @param {String} source    The source of the change, user, api, or silent\n   * @returns {Delta}          Returns the change when successful, or null if not\n   */\n  removeFormat(from, to, source) {\n    [ from, to, source ] = this._normalizeRange(from, to, source);\n    const formats = {};\n\n    this.contents.getOps(from, to).forEach(({ op }) => {\n      op.attributes && Object.keys(op.attributes).forEach(key => formats[key] = null);\n    });\n\n    let change = this.delta().retain(from).retain(to - from, formats);\n\n    // If the last block was not captured be sure to clear that too\n    this.contents.getLines(from, to).forEach(line => {\n      const formats = {};\n      Object.keys(line.attributes).forEach(key => formats[key] = null);\n      change = change.compose(this.delta().retain(line.end - 1).retain(1, formats));\n    });\n\n    return this.updateContents(change, source);\n  }\n\n  /**\n   * Create a change delta calling one or more methods on the editor. The changes will not be applied as normal but will\n   * be collated into a single change delta and returned from this methnod. Example:\n   * ```js\n   * var change = editor.getChange(function() {\n   *   editor.deleteText(0, 5);\n   *   editor.insertText('\\n', { blockquote: true });\n   *   editor.formatText(10, 20, { bold: true });\n   * });\n   *\n   * editor.updateContents(change, 'user');\n   * ```\n   *\n   * @param {Function} producer A function in which to call methods on the editor to produce a change\n   * @returns {Delta}           The sum of all the changes made within the producer\n   */\n  getChange(producer) {\n    let change = this.delta();\n    this.updateContents = singleChange => {\n      if (singleChange.ops.length) {\n        change = change.compose(singleChange);\n        return singleChange;\n      } else {\n        return null;\n      }\n    };\n    producer(this);\n    delete this.updateContents;\n    return change;\n  }\n\n  /**\n   * Make several changes to the editor apply all at one in one commit. Changes made with the transaction will be\n   * applied all together and the \"text-changing\", \"text-change\", and \"selection-change\" events will be dispatched only\n   * once. Use this to combine multiple changes into one.\n   *\n   * @param {Function} producer A function which should make changes with the editor\n   * @param {String} source     The source of the change, user, api, or silent\n   * @param {Array} selection   Optional selection after the change has been applied\n   * @returns {Delta}           Returns the change when successful, or null if not\n   */\n  transaction(producer, source, selection) {\n    const change = this.getChange(producer);\n    return this.updateContents(change, source, selection);\n  }\n\n  /**\n   * Returns the selected range (or the provided range) in index order (lowest number first) and within the bounds of\n   * the content, between 0 and content.length() - 1 (the selection cannot be past the trailing newline).\n   *\n   * @param {Array} range Optional range, defaults to current selection\n   * @param {Number} max  The maxium number the range can be\n   */\n  getSelectedRange(range = this.selection, max = this.length - 1) {\n    if (range == null) return range;\n    if (typeof range === 'number') range = [ range, range ];\n    if (range[0] > range[1]) [range[0], range[1]] = [range[1], range[0]];\n    return range.map(index => Math.max(0, Math.min(max, index)));\n  }\n\n  _queueEvents(events) {\n    const alreadyRunning = this._queuedEvents.length;\n    this._queuedEvents.push(...events);\n    if (alreadyRunning) return;\n    while (this._queuedEvents.length) {\n      const event = this._queuedEvents.shift();\n      this.fire(...event);\n    }\n  }\n\n  /**\n   * Normalizes range values to a proper range if it is not already. A range is a `from` and a `to` index, e.g. 0, 4.\n   * This will ensure the lower index is first. Example usage:\n   * editor._normalizeRange(5); // [5, 5]\n   * editor._normalizeRange(-4, 100); // for a doc with length 10, [0, 10]\n   * editor._normalizeRange(25, 18); // [18, 25]\n   * editor._normalizeRange([12, 13]); // [12, 13]\n   * editor._normalizeRange(5, { bold: true }); // [5, 5, { bold: true }]\n   */\n  _normalizeRange(from, to, ...rest) {\n    [ from, to, ...rest ] = this._normalizeSelection(from, to, ...rest);\n    if (from > to) {\n      const toValue = from;\n      from = to;\n      to = toValue;\n    }\n    return [from, to].concat(rest);\n  }\n\n  _normalizeSelection(from, to, ...rest) {\n    if (Array.isArray(from)) {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      [from, to] = from;\n      if (to === undefined) to = from;\n    } else if (typeof from !== 'number') {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      if (from !== undefined || rest.length) rest.unshift(from);\n      from = to = 0;\n    } else if (typeof to !== 'number') {\n      if (to !== undefined || rest.length) rest.unshift(to);\n      to = from;\n    }\n    from = Math.max(0, Math.min(this.length, Math.floor(from)));\n    to = Math.max(0, Math.min(this.length, Math.floor(to)));\n    return [from, to].concat(rest);\n  }\n}\n\n// Ensures the format for the current line in a delete remains the same when multiple lines are deleted. This is needed\n// because the last line holds the formatting after a delete, but the first line is expected to be the retained format\nfunction cleanDelete(editor, from, to, change) {\n  if (from !== to) {\n    const line = editor.contents.getLine(from);\n    if (!line.ops.length() && to === from + 1) return change;\n    const lineFormat = editor.getLineFormat(from);\n    if (!deepEqual(lineFormat, editor.getLineFormat(to))) {\n      const lineChange = editor.getChange(() => editor.formatLine(to, lineFormat))\n      change = change.compose(change.transform(lineChange));\n    }\n  }\n  return change;\n}\n\n// Ensures contents end with a newline\nfunction normalizeContents(contents) {\n  // Contents only have inserts. Deletes and retains belong to changes only.\n  contents.ops = contents.ops.filter(op => op.insert);\n  const lastOp = contents.ops[contents.ops.length - 1];\n  if (!lastOp || typeof lastOp.insert !== 'string' || lastOp.insert.slice(-1) !== '\\n') contents.insert('\\n');\n  return contents;\n}\n\n// Delta no operation method\nfunction deltaNoop() {\n  return this;\n}\n\n// Sets the contents onto the editor after ensuring they end in a newline, freezes the contents from change, and\n// updates the length and text of the editor to the latest\nfunction setContents(editor, contents) {\n  contents = normalizeContents(contents);\n  contents.freeze();\n  editor.contents = contents;\n  editor.length = contents.length();\n}\n\n// Combine formats removing ones that don't exist in both and creating an array for those with multiple values\nfunction combineFormats(formats, combined) {\n  return Object.keys(combined).reduce(function(merged, name) {\n    if (formats[name] == null) return merged;\n    if (combined[name] === formats[name]) {\n      merged[name] = combined[name];\n    } else if (Array.isArray(combined[name])) {\n      if (combined[name].indexOf(formats[name]) < 0) {\n        merged[name] = combined[name].concat([formats[name]]);\n      }\n    } else {\n      merged[name] = [combined[name], formats[name]];\n    }\n    return merged;\n  }, {});\n}\n","// Based off of https://github.com/jorgebucaran/ultradom/ MIT licensed\n\nexport function h(name, attributes) {\n  var rest = [];\n  var children = [];\n  var length = arguments.length;\n\n  while (length-- > 2) rest.push(arguments[length]);\n\n  while (rest.length) {\n    var node = rest.pop();\n    if (node && node.pop) {\n      for (length = node.length; length--; ) {\n        rest.push(node[length]);\n      }\n    } else if (node != null && node !== true && node !== false) {\n      children.push(node);\n    }\n  }\n\n  return typeof name === \"function\"\n    ? name(attributes || {}, children)\n    : {\n        name,\n        attributes: attributes || {},\n        children: children\n      };\n}\n\nexport function render(node, element) {\n  element = element ?\n    patch(element.parentNode, element, node) :\n    patch(null, null, node);\n  return element;\n}\n\nexport function renderChildren(node, element) {\n  patchChildren(element, node.children);\n}\n\n\nfunction clone(target, source) {\n  var obj = {};\n\n  for (var i in target) obj[i] = target[i];\n  for (var i in source) obj[i] = source[i];\n\n  return obj;\n}\n\nfunction eventListener(event) {\n  return event.currentTarget.events[event.type](event);\n}\n\nfunction updateAttribute(element, name, value, isSvg) {\n  if (name[0] === \"o\" && name[1] === \"n\") {\n    if (!element.events) {\n      element.events = {};\n    }\n    name = name.slice(2);\n    const oldValue = element.events[name];\n    element.events[name] = value;\n    if (value) {\n      if (!oldValue) {\n        element.addEventListener(name, eventListener);\n      }\n    } else {\n      element.removeEventListener(name, eventListener);\n    }\n  } else if (name in element && name !== \"list\" && !isSvg) {\n    element[name] = value == null ? \"\" : value;\n  } else if (value != null && value !== false) {\n    element.setAttribute(name, value === true ? '' : value);\n  }\n\n  if (value == null || value === false) {\n    element.removeAttribute(name);\n  }\n}\n\nfunction createElement(node, isSvg) {\n  var element =\n    typeof node === \"string\" || typeof node === \"number\"\n      ? document.createTextNode(node)\n      : (isSvg = isSvg || node.name === \"svg\")\n        ? document.createElementNS(\n            \"http://www.w3.org/2000/svg\",\n            node.name\n          )\n        : document.createElement(node.name);\n\n  var attributes = node.attributes;\n  if (attributes) {\n    for (var i = 0; i < node.children.length; i++) {\n      element.appendChild(createElement(node.children[i], isSvg));\n    }\n\n    for (var name in attributes) {\n      updateAttribute(element, name, attributes[name], isSvg);\n    }\n  }\n\n  return element;\n}\n\nfunction getElementAttributes(element, isSvg) {\n  var attributes = {};\n  for (var i = 0; i < element.attributes.length; i++) {\n    var { name, value } = element.attributes[i];\n    if (name in element && name !== \"list\" && !isSvg) {\n      attributes[name] = element[name];\n    } else {\n      attributes[name] = value === '' ? true : value;\n    }\n  }\n  return attributes;\n}\n\nfunction updateElement(element, attributes, isSvg) {\n  var oldAttributes = getElementAttributes(element);\n  for (var name in clone(oldAttributes, attributes)) {\n    if (\n      attributes[name] !==\n      (name === \"value\" || name === \"checked\"\n        ? element[name]\n        : oldAttributes[name])\n    ) {\n      updateAttribute(\n        element,\n        name,\n        attributes[name],\n        isSvg\n      )\n    }\n  }\n}\n\nfunction removeElement(parent, element) {\n  parent.removeChild(element);\n}\n\nfunction patchChildren(element, children, isSvg) {\n  var i = 0;\n\n  while (i < children.length) {\n    patch(element, element.childNodes[i], children[i], isSvg);\n    i++;\n  }\n\n  while (i < element.childNodes.length) {\n    removeElement(element, element.childNodes[i]);\n  }\n}\n\nfunction patch(parent, element, node, isSvg) {\n  var name = element && element.nodeName !== '#text' ? element.nodeName.toLowerCase() : undefined;\n  if (element == null || name !== node.name) {\n    var newElement = createElement(node, isSvg);\n\n    if (parent) {\n      parent.insertBefore(newElement, element);\n      if (element != null) {\n        removeElement(parent, element);\n      }\n    }\n\n    element = newElement;\n  } else if (name == null) {\n    if (element.nodeValue !== node) element.nodeValue = node;\n  } else {\n    updateElement(\n      element,\n      node.attributes,\n      (isSvg = isSvg || node.name === \"svg\")\n    );\n\n    patchChildren(element, node.children, isSvg);\n  }\n  return element;\n}\n","\n\nexport function decorateBlock(vdom, attr) {\n  if (!attr.attributes && !attr.classes) return vdom;\n  const { attributes, classes } = attr;\n  if (attributes) {\n    Object.keys(attributes).forEach(name => {\n      vdom.attributes[name] = attributes[name];\n    });\n  }\n  if (classes) {\n    const classArray = Object.keys(classes);\n    if (classArray.length) {\n      if (vdom.attributes.class) classArray.unshift(vdom.attributes.class);\n      vdom.attributes.class = classArray.join(' ');\n    }\n  }\n  return vdom;\n}\n\nexport function undecorateBlock(node, block, attr) {\n  const ignoreClasses = {};\n  const ignoreAttributes = { class: true };\n  block.selector.replace(/\\.([-\\w])/, (_, name) => ignoreClasses[name] = true);\n  block.selector.replace(/\\[([-\\w])[^\\]]\\]/, (_, name) => ignoreAttributes[name] = true);\n  let attrLength = node.attributes.length;\n\n  if (node.classList.length) {\n    attrLength--;\n    const classes = {};\n    let match = false;\n\n    for (let i = 0; i < node.classList.length; i++) {\n      const name = node.classList.item(i);\n      if (!ignoreClasses[name]) {\n        match = true;\n        classes[name] = true;\n      }\n    }\n    if (match) attr.classes = classes;\n  }\n\n  if (attrLength) {\n    const attributes = {};\n    let match = false;\n\n    for (let i = 0; i < node.attributes.length; i++) {\n      const attribute = node.attributes[i];\n      if (!ignoreAttributes[attribute.name]) {\n        match = true;\n        attributes[attribute.name] = attribute.value || true;\n      }\n    }\n    if (match) attr.attributes = attributes;\n  }\n  return attr;\n}\n","import { h } from './vdom';\nimport { decorateBlock } from './dom-utils';\n\n\nexport const paragraph = {\n  name: 'paragraph',\n  selector: 'p',\n  vdom: children => <p>{children}</p>,\n};\n\n\nexport const header = {\n  name: 'header',\n  selector: 'h1, h2, h3, h4, h5, h6',\n  defaultFollows: true,\n  dom: node => ({ header: parseInt(node.nodeName.replace('H', '')) }),\n  vdom: (children, attr) => {\n    const H = `h${attr.header}`;\n    return <H>{children}</H>;\n  },\n};\n\n\nexport const list = {\n  name: 'list',\n  selector: 'ul > li, ol > li',\n  optimize: true,\n  dom: node => {\n    let indent = -1, parent = node.parentNode;\n    const list = parent.nodeName === 'OL' ? 'ordered' : 'bullet';\n    while (parent) {\n      if (/^UL|OL$/.test(parent.nodeName)) indent++;\n      else if (parent.nodeName !== 'LI') break;\n      parent = parent.parentNode;\n    }\n    const attr = { list };\n    if (indent) attr.indent = indent;\n    return attr;\n  },\n  vdom: lists => {\n    const topLevelChildren = [];\n    const levels = [];\n    // e.g. levels = [ul, li, ul, li]\n\n    lists.forEach(([children, attr]) => {\n      const List = attr.list === 'ordered' ? 'ol' : 'ul';\n      const index = Math.min((attr.indent || 0) * 2, levels.length);\n      const item = decorateBlock(<li>{children}</li>, attr);\n      let list = levels[index];\n      if (list && list.name === List) {\n        list.children.push(item);\n      } else {\n        list = <List>{item}</List>;\n        const childrenArray = index ? levels[index - 1].children : topLevelChildren;\n        childrenArray.push(list);\n        levels[index] = list;\n      }\n      levels[index + 1] = item;\n      levels.length = index + 2;\n    });\n\n    return topLevelChildren;\n  },\n};\n\nexport const blockquote = {\n  name: 'blockquote',\n  selector: 'blockquote p',\n  optimize: true,\n  vdom: quotes => {\n    return <blockquote>{quotes.map(([children, attr]) => decorateBlock(<p>{children}</p>, attr))}</blockquote>;\n  },\n};\n\nexport const codeblock = {\n  name: 'code-block',\n  selector: 'pre code, pre',\n  optimize: true,\n  vdom: lines => {\n    return <pre>{lines.map(([children, attr]) => [children, '\\n'])}</pre>;\n  },\n};\n\nexport const hr = {\n  name: 'hr',\n  selector: 'hr',\n  vdom: () => <hr/>,\n};\n","import { h } from './vdom';\n\n\nexport const bold = {\n  name: 'bold',\n  selector: 'strong, b',\n  styleSelector: '[style*=\"bold\"]',\n  vdom: children => <strong>{children}</strong>,\n};\n\n\nexport const italic = {\n  name: 'italic',\n  selector: 'em, i',\n  styleSelector: '[style*=\"italic\"]',\n  vdom: children => <em>{children}</em>,\n};\n\n\nexport const code = {\n  name: 'code',\n  selector: 'code',\n  vdom: children => <code>{children}</code>,\n};\n\n\nexport const link = {\n  name: 'link',\n  selector: 'a[href]',\n  dom: node => node.href,\n  vdom: (children, attr) => <a href={attr.link} target=\"_blank\">{children}</a>,\n};\n","import { h } from './vdom';\n\n\nexport const image = {\n  name: 'image',\n  selector: 'img',\n  dom: node => node.src,\n  vdom: value => <img src={value}/>,\n};\n\nexport const br = {\n  name: 'br',\n  selector: 'br',\n  vdom: value => <br/>,\n};\n\n// To represent a collaborator's cursor, for use in decorators\nexport const cursor = {\n  name: 'cursor',\n  selector: 'span.cursor',\n  dom: node => ({ name: node.dataset.name, color: node.style.backgroundColor }),\n  vdom: value => {\n    return <span class=\"cursor\" data-name={value.name} style={ `background-color: ${value.color}` }></span>\n  },\n};\n","import { paragraph, header, list, blockquote, codeblock, hr } from './blocks';\nimport { bold, italic, code, link } from './markups';\nimport { image, br } from './embeds';\n\n\nexport default {\n  blocks: [ paragraph, header, list, blockquote, hr ],\n  markups: [ italic, bold, link ],\n  embeds: [ image, br ],\n};\n","const indexOf = [].indexOf;\n\n// Get the range (a tuple of indexes) for this view from the browser selection\nexport function getSelection(view, range) {\n  const root = view.root;\n  const selection = !range ? root.ownerDocument.defaultView.getSelection() : {\n    anchorNode: range.startContainer, anchorOffset: range.startOffset,\n    focusNode: range.endContainer, focusOffset: range.endOffset,\n    isCollapsed: range.collapsed,\n  };\n\n  if (!root.contains(selection.anchorNode)) {\n    return null;\n  } else {\n    const anchorIndex = getNodeAndOffsetIndex(view, selection.anchorNode, selection.anchorOffset);\n    const isCollapsed = selection.anchorNode === selection.focusNode && selection.anchorOffset === selection.focusOffset;\n    // selection.isCollapsed causes a layout on Chrome. ?? Manual detection does not.\n    let focusIndex = isCollapsed ?\n      anchorIndex :\n      getNodeAndOffsetIndex(view, selection.focusNode, selection.focusOffset);\n\n    return [ anchorIndex, focusIndex ];\n  }\n}\n\n// Set the browser selection to the range (a tuple of indexes) of this view\nexport function setSelection(view, range) {\n  const root = view.root;\n  const selection = root.ownerDocument.defaultView.getSelection();\n  const hasFocus = root.contains(root.ownerDocument.activeElement);\n\n  if (range == null) {\n    if (hasFocus) {\n      root.blur();\n      selection.removeAllRanges();\n    }\n  } else {\n    const [ anchorNode, anchorOffset, focusNode, focusOffset ] = getNodesForRange(view, range);\n    if (anchorNode && focusNode) {\n      selection.setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset);\n    }\n    if (!hasFocus) root.focus();\n  }\n}\n\n// Get a browser range object for the given editor range tuple\nexport function getBrowserRange(view, range) {\n  if (range[0] > range[1]) range = [ range[1], range[0] ];\n  const [ anchorNode, anchorOffset, focusNode, focusOffset ] = getNodesForRange(view, range);\n  const browserRange = document.createRange();\n  if (anchorNode && focusNode) {\n    browserRange.setStart(anchorNode, anchorOffset);\n    browserRange.setEnd(focusNode, focusOffset);\n  }\n  return browserRange;\n}\n\n\n// Get the browser nodes and offsets for the range (a tuple of indexes) of this view\nexport function getNodesForRange(view, range) {\n  if (range == null) {\n    return [ null, 0, null, 0 ];\n  } else {\n    const [ anchorNode, anchorOffset ] = getNodeAndOffset(view, range[0]);\n    const [ focusNode, focusOffset ] = range[0] === range[1] ?\n          [ anchorNode, anchorOffset ] : getNodeAndOffset(view, range[1]);\n\n    return [ anchorNode, anchorOffset, focusNode, focusOffset ];\n  }\n}\n\nexport function getNodeAndOffset(view, index) {\n  const root = view.root;\n  const inDom = root.ownerDocument.contains(root);\n  const { blocks, embeds } = view.paper;\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      return (node.nodeType === Node.TEXT_NODE || inDom) &&\n        NodeFilter.FILTER_ACCEPT ||\n        NodeFilter.FILTER_REJECT;\n    }\n  });\n\n  let count = 0, node, firstBlockSeen = false;\n  walker.currentNode = root;\n  while ((node = walker.nextNode())) {\n    if (node.nodeType === Node.TEXT_NODE) {\n      const size = node.nodeValue.length\n      if (index <= count + size) return [ node, index - count ];\n      count += size;\n    } else if (embeds.matches(node) && !isBRPlaceholder(view, node)) {\n      count += 1;\n      // If the selection lands after this embed, and the next node isn't a text node, place the selection\n      if (count === index && (!node.nextSibling || node.nextSibling.nodeType !== Node.TEXT_NODE)) {\n        return [ node.parentNode, indexOf.call(node.parentNode.childNodes, node) + 1 ];\n      }\n    } else if (blocks.matches(node)) {\n      if (firstBlockSeen) count += 1;\n      else firstBlockSeen = true;\n\n      // If the selection lands at the beginning of a block, and the first node isn't a text node, place the selection\n      if (count === index && (!node.firstChild || node.firstChild.nodeType !== Node.TEXT_NODE)) {\n        return [ node, 0 ];\n      }\n    }\n  }\n  return [ null, 0 ];\n}\n\nexport function getNodeAndOffsetIndex(view, node, offset) {\n  if (node.nodeType === Node.ELEMENT_NODE && offset > 0) {\n    node = node.childNodes[offset - 1];\n    offset = node.nodeType === Node.ELEMENT_NODE ? 0 : node.nodeValue.length;\n  }\n  return getNodeIndex(view, node) + offset;\n}\n\n// Get the index the node starts at in the content\nexport function getNodeIndex(view, node) {\n  const root = view.root;\n  const inDom = root.ownerDocument.contains(root);\n  const { blocks, embeds } = view.paper;\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      return (node.nodeType === Node.TEXT_NODE || inDom) &&\n        NodeFilter.FILTER_ACCEPT ||\n        NodeFilter.FILTER_REJECT;\n    }\n  });\n\n  walker.currentNode = node;\n  let index = node.nodeType === Node.ELEMENT_NODE ? 0 : -1;\n  while ((node = walker.previousNode())) {\n    if (node === root) continue;\n    else if (node.nodeType === Node.TEXT_NODE) index += node.nodeValue.length;\n    else if (embeds.matches(node) && !isBRPlaceholder(view, node)) index++;\n    else if (blocks.matches(node)) index++;\n  }\n  return index;\n}\n\n// Determines if a node is actually a BR in our content or if is just the placeholder BR which appears in an empty block\n// or at the end of a block\nexport function isBRPlaceholder(view, node) {\n  if (node.nodeName !== 'BR') return false;\n  const { blocks } = view.paper;\n  if (node.nextSibling) {\n    return node.nextSibling.nodeType !== Node.TEXT_NODE && blocks.matches(node.nextSibling);\n  }\n  return blocks.matches(node.parentNode);\n}\n","/*!\n * escape-html\n * Copyright(c) 2012-2013 TJ Holowaychuk\n * Copyright(c) 2015 Andreas Lubbe\n * Copyright(c) 2015 Tiancheng \"Timothy\" Gu\n * MIT Licensed\n */\n\nconst matchHtmlRegExp = /[\"'&<>]/;\n\n/**\n * Escape special characters in the given string of html.\n *\n * @param  {string} string The string to escape for inserting into HTML\n * @return {string}\n * @public\n */\n\nexport default function escapeHtml(string) {\n  var str = '' + string;\n  var match = matchHtmlRegExp.exec(str);\n\n  if (!match) {\n    return str;\n  }\n\n  var escape;\n  var html = '';\n  var index = 0;\n  var lastIndex = 0;\n\n  for (index = match.index; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34: // \"\n        escape = '&quot;';\n        break;\n      case 38: // &\n        escape = '&amp;';\n        break;\n      case 39: // '\n        escape = '&#39;';\n        break;\n      case 60: // <\n        escape = '&lt;';\n        break;\n      case 62: // >\n        escape = '&gt;';\n        break;\n      default:\n        continue;\n    }\n\n    if (lastIndex !== index) {\n      html += str.substring(lastIndex, index);\n    }\n\n    lastIndex = index + 1;\n    html += escape;\n  }\n\n  return lastIndex !== index\n    ? html + str.substring(lastIndex, index)\n    : html;\n}","import { h } from './view/vdom';\n\nexport default class Paper {\n  constructor(types) {\n    this.blocks = new Types();\n    this.markups = new Types();\n    this.embeds = new Types();\n    this.container = types.container || container;\n    if (types && types.blocks) types.blocks.forEach(block => this.blocks.add(block));\n    if (types && types.markups) types.markups.forEach(markup => this.markups.add(markup));\n    if (types && types.embeds) types.embeds.forEach(embed => this.embeds.add(embed));\n  }\n}\n\n\nexport function container(children, paper) {\n  return <div class=\"typewriter-editor\" contentEditable=\"true\">\n    {children && children.length ? children : paper.blocks.getDefault().vdom()}\n  </div>;\n}\n\n\nclass Types {\n  constructor() {\n    this.selector = '';\n    this.types = {};\n    this.array = [];\n    this.priorities = {};\n  }\n\n  add(definition, index) {\n    if (!definition.name || !definition.selector || !definition.vdom) {\n      throw new Error('DOMType definitions must include a name, selector, and vdom function');\n    }\n    if (this.types[definition.name]) this.remove(definition.name);\n    this.selector += (this.selector ? ', ' : '') + definition.selector;\n    this.types[definition.name] = definition;\n    if (typeof index !== 'number') {\n      this.priorities[name] = this.array.length;\n      this.array.push(definition);\n    } else {\n      this.array.splice(i, 0, definition);\n      this.array.forEach(({ name }, i) => this.priorities[name] = i);\n    }\n  }\n\n  remove(name) {\n    if (!this.types[name]) return;\n    delete this.types[name];\n    this.array = this.array.filter(domType => domType.name !== name);\n    this.array.forEach(({ name }, i) => this.priorities[name] = i);\n    this.selector = this.array.map(type => type.selector).join(', ');\n  }\n\n  clear() {\n    this.selector = '';\n    this.types = {};\n    this.array = [];\n    this.priorities = {};\n  }\n\n  get(name) {\n    return this.types[name];\n  }\n\n  priority(name) {\n    return this.priorities[name];\n  }\n\n  getDefault() {\n    return this.array[0];\n  }\n\n  matches(node) {\n    if (node.nodeType) {\n      return this.selector ? node.matches(this.selector) : false;\n    } else {\n      throw new Error('Cannot match against ' + node);\n    }\n  }\n\n  find(nodeOrAttr) {\n    if (nodeOrAttr.nodeType) {\n      let i = this.array.length;\n      while (i--) {\n        let domType = this.array[i];\n        if (nodeOrAttr.matches(domType.selector)) return domType;\n      }\n    } else if (nodeOrAttr && typeof nodeOrAttr === 'object') {\n      let domType;\n      const keys = Object.keys(nodeOrAttr);\n      keys.length ? keys.some(name => domType = this.get(name)) : (domType = this.getDefault());\n      return domType;\n    }\n  }\n}\n","import Delta from '../delta';\nimport { deepEqual } from '../equal';\nimport escape from '../escape-html';\nimport { h } from './vdom';\nimport { isBRPlaceholder } from './selection';\nimport { decorateBlock, undecorateBlock } from './dom-utils';\nimport defaultPaper from './defaultPaper';\nimport Paper from '../paper';\nconst nodeMarkup = new WeakMap();\n\nconst BR = <br/>;\nconst VOID_ELEMENTS = {\n  area: true, base: true, br: true, col: true, embed: true, hr: true, img: true, input: true,\n  link: true, meta: true, param: true, source: true, track: true, wbr: true\n};\nconst SKIP_ELEMENTS = {\n  STYLE: true, SCRIPT: true, LINK: true, META: true, TITLE: true\n};\nconst BLOCK_ELEMENTS = 'address, article, aside, blockquote, canvas, dd, div, dl, dt, fieldset, figcaption, figure, footer, form, header, hr, li, main, nav, noscript, ol, output, p, pre, section, table, tfoot, ul, video';\n\n\nexport function deltaToVdom(delta, paper = new Paper(defaultPaper)) {\n  const { blocks, markups, embeds, container } = paper;\n  const blockData = [];\n\n  delta.eachLine(({ ops, attributes }) => {\n    let inlineChildren = [];\n\n    // Collect block children\n    ops.forEach(op => {\n      if (op.insert) {\n        let children = [];\n        if (typeof op.insert === 'string') {\n          children.push(op.insert.replace(/  /g, '\\xA0 ').replace(/^ | $/g, '\\xA0'));\n        } else {\n          const embed = embeds.find(op.insert);\n          if (embed) {\n            const node = embed.vdom(op.insert[embed.name], paper);\n            children.push(node);\n          }\n        }\n\n        if (op.attributes) {\n          // Sort them by the order found in markups and be efficient\n          Object.keys(op.attributes).sort((a, b) => markups.priority(b) - markups.priority(a)).forEach(name => {\n            const markup = markups.get(name);\n            if (markup) {\n              const node = markup.vdom(children, op.attributes, paper);\n              nodeMarkup.set(node, markup); // Store for merging\n              children = [ node ];\n            }\n          });\n        }\n        inlineChildren.push.apply(inlineChildren, children);\n      }\n    });\n\n    // Merge markups to optimize\n    inlineChildren = mergeChildren(inlineChildren);\n    const lastChild = inlineChildren[inlineChildren.length - 1];\n    if (!inlineChildren.length || (lastChild && lastChild.name === 'br')) {\n      inlineChildren.push(BR);\n    }\n\n    let block = blocks.find(attributes);\n    if (!block) block = blocks.getDefault();\n\n    blockData.push([ block, inlineChildren, attributes ]);\n  });\n\n  // If a block has optimize=true on it, vdom will be called with all sibling nodes of the same block\n  let blockChildren = [], prevBlock;\n  let collect = [];\n  blockData.forEach((data, i) => {\n    const [ block, children, attr ] = data;\n    if (block.optimize) {\n      collect.push([ children, attr ]);\n      const next = blockData[i + 1];\n      if (!next || next[0] !== block) {\n        const children = block.vdom.call(paper, collect);\n        blockChildren = blockChildren.concat(children);\n        collect = [];\n      }\n    } else {\n      const node = block.vdom.call(paper, children, attr);\n      decorateBlock(node, attr);\n      blockChildren.push(node);\n    }\n  });\n\n  return container(blockChildren, paper);\n}\n\n\nexport function deltaFromDom(view, root = view.root, opts) {\n  const inDom = root.ownerDocument.contains(root);\n  const paper = view.paper;\n  const { blocks, markups, embeds } = paper;\n\n  const walker = root.ownerDocument.createTreeWalker(root, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, {\n    acceptNode: node => {\n      if (SKIP_ELEMENTS[node.nodeName]) {\n        return NodeFilter.FILTER_REJECT;\n      } else if (node.nodeType === Node.TEXT_NODE || (!opts || opts.notInDom) || inDom) {\n        return NodeFilter.FILTER_ACCEPT;\n      } else {\n        return NodeFilter.FILTER_REJECT;\n      }\n    }\n  });\n  const delta = new Delta();\n  let currentBlock, firstBlockSeen = false, unknownBlock = false, empty = true, node;\n\n  walker.currentNode = root;\n\n  while ((node = walker.nextNode())) {\n\n    if (isBRPlaceholder(view, node)) {\n      empty = false;\n    } else if (node.nodeType === Node.TEXT_NODE) {\n      // non-breaking spaces are a space, newlines may exist with pasted content but should only be acknowledged within\n      // text\n      if (node.nodeValue.replace(/\\n+/g, '') === '') continue;\n      const text = node.nodeValue.replace(/\\xA0/g, ' ').replace(/\\n+/g, ' ');\n      if (!text || (text === ' ' && node.parentNode.classList.contains('EOP'))) continue;\n      let parent = node.parentNode, attr = {};\n\n      while (parent && !blocks.matches(parent) && parent !== root) {\n        if (markups.matches(parent)) {\n          const markup = markups.find(parent);\n          attr[markup.name] = markup.dom ? markup.dom(parent, paper) : true;\n        } else if (parent.hasAttribute('style')) {\n          markups.array.forEach(markup => {\n            if (markup.styleSelector && parent.matches(markup.styleSelector)) {\n              attr[markup.name] = markup.dom ? markup.dom(parent, paper) : true;\n            }\n          })\n        }\n        parent = parent.parentNode;\n      }\n\n      empty = false;\n      delta.insert(text, attr);\n    } else if (embeds.matches(node)) {\n      const embed = embeds.find(node);\n      if (embed) {\n        delta.insert({ [embed.name]: embed.dom ? embed.dom(node, paper) : true });\n      }\n    } else if (blocks.matches(node) || (node.matches && node.matches(BLOCK_ELEMENTS))) {\n      unknownBlock = !blocks.matches(node);\n\n      if (!blocks.matches(node)) {\n        let parent = node.parentNode;\n        while (parent && !blocks.matches(parent) && parent !== root) {\n          parent = parent.parentNode;\n        }\n        // If this block element is inside a recognized block, ignore it\n        if (parent !== root && blocks.matches(parent)) {\n          continue;\n        }\n      }\n\n      const block = blocks.find(node) || blocks.getDefault();\n      // Skip paragraphs/divs inside blockquotes and list items etc.\n      if (block === blocks.getDefault() && blocks.matches(node.parentNode)) {\n        continue;\n      }\n\n      if (firstBlockSeen) {\n        if (!unknownBlock || !empty) {\n          delta.insert('\\n', currentBlock);\n          empty = true;\n        }\n      } else {\n        firstBlockSeen = true;\n      }\n\n      if (block !== blocks.getDefault()) {\n        currentBlock = block.dom ? block.dom(node, paper) : { [block.name]: true };\n      } else {\n        currentBlock = {};\n      }\n      if (!opts || !opts.ignoreAttributes) {\n        currentBlock = undecorateBlock(node, block, currentBlock);\n      }\n    }\n  }\n  if (!unknownBlock || !empty) {\n    delta.insert('\\n', currentBlock);\n  }\n  return delta;\n}\n\n/**\n * Converts a delta object into an HTML string based off of the supplied Paper definition.\n */\nexport function deltaToHTML(delta, paper) {\n  return childrenToHTML(deltaToVdom(delta, paper).children);\n}\n\n/**\n * Converts an HTML string into a delta object based off of the supplied Paper definition.\n */\nexport function deltaFromHTML(view, html) {\n  const template = document.createElement('template');\n  template.innerHTML = '<div>' + html + '</div>';\n  return deltaFromDom(view, template.content.firstChild, { notInDom: true });\n}\n\n\n// Joins adjacent markup nodes\nfunction mergeChildren(oldChildren) {\n  const children = [];\n  oldChildren.forEach((next, i) => {\n    const prev = children[children.length - 1];\n\n    if (prev && typeof prev !== 'string' && typeof next !== 'string' && nodeMarkup.get(prev) &&\n      nodeMarkup.get(prev) === nodeMarkup.get(next) && deepEqual(prev.attributes, next.attributes))\n    {\n      prev.children = prev.children.concat(next.children);\n    } else {\n      children.push(next);\n    }\n  });\n  return children;\n}\n\n// vdom node to HTML string\nfunction nodeToHTML(node) {\n  const attr = Object.keys(node.attributes)\n    .reduce((attr, name) =>\n      `${attr} ${escape(name)}=\"${escape(node.attributes[name])}\"`, '');\n  const children = childrenToHTML(node.children);\n  const closingTag = children || !VOID_ELEMENTS[node.name] ? `</${node.name}>` : '';\n  return `<${node.name}${attr}>${children}${closingTag}`;\n}\n\n// vdom children to HTML string\nfunction childrenToHTML(children) {\n  if (!children || !children.length) return '';\n  return children.reduce((html, child) => html + (child.name ? nodeToHTML(child) : escape(child).replace(/\\xA0/g, '&nbsp;')), '');\n}\n","const modifierKeys = {\n  Control: true,\n  Meta: true,\n  Shift: true,\n  Alt: true\n};\n\n\n/**\n * Returns the textual representation of a shortcut given a keyboard event. Examples of shortcuts:\n * Cmd+L\n * Cmd+Shift+M\n * Ctrl+O\n * Backspace\n * T\n * Right\n * Shift+Down\n * Shift+F1\n * Space\n */\nexport function shortcutFromEvent(event) {\n  const shortcutArray = [];\n  let key = event.key;\n  if (!key) return '';\n  if (key === ' ') key = 'Space';\n\n  if (event.metaKey) shortcutArray.push('Cmd');\n  if (event.ctrlKey) shortcutArray.push('Ctrl');\n  if (event.altKey) shortcutArray.push('Alt');\n  if (event.shiftKey) shortcutArray.push('Shift');\n\n  if (!modifierKeys[key]) {\n    // a and A, b and B, should be the same shortcut\n    if (key.length === 1) key = key.toUpperCase();\n    shortcutArray.push(key);\n  }\n\n  return shortcutArray.join('+');\n}\n","import EventDispatcher from './event-dispatcher';\nimport Editor from './editor';\nimport { renderChildren } from './view/vdom';\nimport defaultPaper from './view/defaultPaper';\nimport { getSelection, setSelection, getBrowserRange } from './view/selection';\nimport { deltaToVdom, deltaFromDom, deltaToHTML, deltaFromHTML } from './view/dom';\nimport Paper from './paper';\nimport { shortcutFromEvent } from './shortcut-string';\nimport { shallowEqual } from './equal';\n\nconst SOURCE_API = 'api';\nconst SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst isMac = navigator.userAgent.indexOf('Macintosh') !== -1;\nconst modExpr = isMac ? /Cmd/ : /Ctrl/;\n\n/**\n * Triggers before each render inside an editor transaction. Use this event to alter the contents of the editor with\n * decorators which will only be visible in the view and will not save to the editor. To add decorators, simply use the\n * editor APIs to format text, insert embeds, etc.\n *\n * @event View#decorate\n */\n\n/**\n * Triggers right before the view renders the latest contents to the DOM. May pass a change event if the render is\n * triggered by an editor change.\n *\n * @event View#rendering\n */\n\n/**\n * Triggers when the view renders the latest contents to the DOM. May pass a change event if the render is\n * triggered by an editor change.\n *\n * @event View#render\n */\n\n/**\n * Triggers on a keydown event, calling listeners with the keydown event and a shortcut string. These shortcut strings\n * will contain all the modifiers being pressed along with the key. Examples are:\n * Ctrl+B, Ctrl+Shift+Tab, Alt+A, Enter, Shift+Enter, Cmd+Enter, Cmd+Backspace, Space, Tab, Ctrl+Shift+Alt+F11, Ctrl++\n *\n * In addition to the normal modifiers, Cmd, Ctrl, Alt, and Shift, a special modifier called Mod can be used to match\n * Cmd on Mac and Ctrl on other OSes. This allows Mod+B to be used for bold and work correctly on all systems.\n *\n * You can listen for all shortcuts using the \"shortcut\" event, or you can listen for a specific shortcut using\n * \"shortcut:{shortcut}\".\n *\n * @event View#shortcut\n * @event View#shortcut:{shortcut} E.g. \"shortcut:Mod+Bold\"\n */\n\n/**\n * The Typewriter View displays and Editor's contents and selection. The contents are displayed as HTML using a tiny\n * virtual dom implementation and Paper to describe the HTML. The selection is displayed with the native browser\n * selection.\n *\n * View also sends changes to the editor using contenteditable and a mutation observer to capture text entry, keyboard\n * shortcuts to capture other types of edits, and the native selectionchange event to update selection.\n */\nexport default class View extends EventDispatcher {\n\n  /**\n   * Create a new View to display an Editor's contents.\n   *\n   * @param {Editor} editor  A Typewriter editor this View will display the contents for\n   * @param {Object} options Options include:\n   *   @param {HTMLElement} root   The root HTML element of this view. If not provided, you must append view.root to the\n   *                               DOM yourself\n   *   @param {Object} paper       The blocks, markups, embeds, and/or container to be used in this editor\n   *   @param {Object} modules     Modules which can be used with this view\n   */\n  constructor(editor, options = {}) {\n    super();\n    if (!editor) throw new Error('Editor view requires an editor');\n    this.editor = editor;\n    this.root = options.root || document.createElement('div');\n    if (!options.root) this.root.className = 'typewriter-editor';\n    this.paper = new Paper({ ...defaultPaper, ...options.paper });\n    this.enable();\n    this.isMac = isMac;\n    this._settingEditorSelection = false;\n    this._settingBrowserSelection = false;\n    this.modules = {};\n    this.options = options;\n    this.init();\n  }\n\n  /**\n   * Returns whether or not the view has browser focus.\n   *\n   * @returns {Boolean} Whether the view has focus\n   */\n  hasFocus() {\n    return this.root.contains(this.root.ownerDocument.activeElement);\n  }\n\n  /**\n   * Focuses the view using the last known selection.\n   */\n  focus() {\n    if (this.lastSelection) this.editor.setSelection(this.lastSelection);\n    else this.root.focus();\n  }\n\n  /**\n   * Removes focus from the view.\n   */\n  blur() {\n    this.root.blur();\n  }\n\n  /**\n   * Disables view text entry and key shortcuts.\n   */\n  disable() {\n    this.enable(false);\n  }\n\n  /**\n   * Enables (or disables) view text entry and key shortcuts.\n   *\n   * @param {Boolean} enabled Whether to make it enabled or disabled, default being true\n   */\n  enable(enabled = true) {\n    this.enabled = enabled;\n    this.root.contentEditable = enabled;\n  }\n\n  /**\n   * Get the position and size of a range as it is displayed in the DOM relative to the top left of visible document.\n   * You can use `getBounds(editor.selection)` to find the coordinates of the current selection and display a popup at\n   * that location.\n   *\n   * @param {Number} from The start of the range\n   * @param {Number} to   The end of the range\n   * @returns {DOMRect}   A native DOMRect object with the bounds of the range\n   */\n  getBounds(from, to) {\n    let range = this.editor._normalizeRange(from, to);\n    range = this.editor.getSelectedRange(range);\n    if (range && this.decorators.ops.length) {\n      range = range.map(i => this.decorators.transform(i));\n    }\n    const browserRange = getBrowserRange(this, range);\n    if (browserRange.endContainer.nodeType === Node.ELEMENT_NODE) {\n      try {\n        browserRange.setEnd(browserRange.endContainer, browserRange.endOffset + 1);\n      } catch(e) {}\n    }\n    return browserRange.getBoundingClientRect();\n  }\n\n  /**\n   * Get all positions and sizes of a range as it is displayed in the DOM relative to the top left of visible document.\n   * This is different from `getBounds` because instead of a single bounding box you may get multiple rects such as when\n   * the selection is split across lines. You can use `getAllBounds` to draw a highlight behind the text within this\n   * range.\n   *\n   * @param {Number} from The start of the range\n   * @param {Number} to   The end of the range\n   * @returns {DOMRectList}   A native DOMRect object with the bounds of the range\n   */\n  getAllBounds(from, to) {\n    let range = this.editor._normalizeRange(from, to);\n    range = this.editor.getSelectedRange(range);\n    if (range && this.decorators.ops.length) {\n      range = range.map(i => this.decorators.transform(i));\n    }\n    const browserRange = getBrowserRange(this, range);\n    if (browserRange.endContainer.nodeType === Node.ELEMENT_NODE) {\n      browserRange.setEnd(browserRange.endContainer, browserRange.endOffset + 1);\n    }\n    return browserRange.getClientRects();\n  }\n\n  /**\n   * Get the HTML text of the View (minus any decorators). You could use this to store the HTML contents rather than\n   * storing the editor contents. If you don't care about collaborative editing this may be easier than storing Deltas.\n   *\n   * @returns {String} A string of HTML\n   */\n  getHTML() {\n    return deltaToHTML(this.editor.contents, this.paper);\n  }\n\n  /**\n   * Set a string of HTML to be the contents of the editor. It will be parsed using Paper so incorrectly formatted HTML\n   * cannot be set in Typewriter.\n   *\n   * @param {String} html A string of HTML to set in the editor\n   * @param {*} source    The source of the change being made, api, user, or silent\n   */\n  setHTML(html, source) {\n    this.editor.setContents(deltaFromHTML(this, html), source);\n  }\n\n  /**\n   * Re-render the current editor state to the DOM.\n   */\n  render(changeEvent) {\n    let contents = this.editor.contents;\n    this.decorators = this.editor.getChange(() => this.fire('decorate', this.editor, changeEvent));\n    if (this.decorators.ops.length) {\n      contents = contents.compose(this.decorators);\n      this.reverseDecorators = contents.diff(this.editor.contents);\n    } else {\n      this.reverseDecorators = this.decorators;\n    }\n    const vdom = deltaToVdom(contents, this.paper);\n    if (!this.enabled) vdom.attributes.contenteditable = undefined;\n    const renderEvent = { changeEvent, vdom };\n    this.fire('rendering', renderEvent);\n    renderChildren(vdom, this.root);\n    if (this.hasFocus()) this.updateBrowserSelection();\n    this.fire('render', renderEvent);\n  }\n\n  /**\n   * Update the browser's selection to match the editor's selection.\n   */\n  updateBrowserSelection() {\n    if (this._settingEditorSelection) return;\n    this._settingBrowserSelection = true;\n    this.setSelection(this.editor.selection);\n    setTimeout(() => this._settingBrowserSelection = false, 20); // sad hack :(\n  }\n\n  /**\n   * Update the editor's selection to match the browser's selection.\n   *\n   * @param {String} source The source of the selection change, api, user, or silent\n   */\n  updateEditorSelection(source = SOURCE_API) {\n    if (this._settingBrowserSelection) return this._settingBrowserSelection = false;\n    const range = this.getSelection();\n\n    // Store the last non-null selection for restoration on focus()\n    if (range) this.lastSelection = range;\n\n    this._settingEditorSelection = true;\n    this.editor.setSelection(range, source);\n    this._settingEditorSelection = false;\n\n    // If the selection was adjusted when set then update the browser's selection\n    if (!shallowEqual(range, this.editor.selection)) this.updateBrowserSelection();\n  }\n\n  /**\n   * Get the mapped editor range from the current browser selection.\n   *\n   * @returns {Array} A range (or null) that represents the current browser selection\n   */\n  getSelection(nativeRange) {\n    let range = getSelection(this, nativeRange);\n    if (range && this.reverseDecorators.ops.length) {\n      range = range.map(i => this.reverseDecorators.transform(i));\n    }\n    return range;\n  }\n\n  /**\n   * Set's the browser selection to the given range.\n   *\n   * @param {Array} range The range to set selection to\n   */\n  setSelection(range) {\n    if (range && this.decorators.ops.length) {\n      range = range.map(i => this.decorators.transform(i));\n    }\n    const currentRange = getSelection(this);\n    if (!shallowEqual(currentRange, range)) {\n      setSelection(this, range);\n    }\n  }\n\n  /**\n   * Initializes the view, setting up listeners in the DOM and on the editor.\n   */\n  init() {\n    // already inited\n    if (this.hasOwnProperty('uninit')) return;\n    let defaultParagraphSet = false;\n\n    const onKeyDown = event => {\n      let shortcut = shortcutFromEvent(event);\n      this.fire(`shortcut:${shortcut}`, event, shortcut);\n      this.fire(`shortcut`, event, shortcut);\n      if (modExpr.test(shortcut)) {\n        shortcut = shortcut.replace(modExpr, 'Mod');\n        this.fire(`shortcut:${shortcut}`, event, shortcut);\n        this.fire(`shortcut`, event, shortcut);\n      }\n    };\n\n    // The browser does a better job of adding the text correctly\n    // const onPaste = event => {\n    //   const html = event.clipboardData.getData('text/html');\n    //   if (!html || !this.editor.selection) return;\n    //   event.preventDefault();\n    //   const root = document.createElement('div');\n    //   root.innerHTML = html;\n    //   let delta = deltaFromDom(this, root, { ignoreAttributes: true, notInDom: true });\n    //   const [ from , to ] = this.editor.selection;\n    //   const change = this.editor.delta().retain(from).delete(to - from);\n    //   change.ops.push(...delta.ops);\n    //   this.editor.updateContents(change, SOURCE_USER, change.length());\n    // };\n\n    const onSelectionChange = () => {\n      this.updateEditorSelection(SOURCE_USER);\n\n      if (!defaultParagraphSet && this.editor.selection) {\n        defaultParagraphSet = true;\n        this.root.ownerDocument.execCommand('defaultParagraphSeparator', false, this.paper.blocks.getDefault().selector);\n      }\n    };\n\n    const onTextChanging = ({ contents }) => {\n      // Prevent incorrect formats\n      return !contents.ops.some(op => {\n        if (typeof op.insert === 'object') {\n          return !this.paper.embeds.find(op.insert);\n        } else if (op.attributes) {\n          // If attributes is empty except for classes/attributes than it is the default block\n          if (!Object.keys(op.attributes).filter(key => key !== 'classes' && key !== 'attributes').length) return;\n          return !(this.paper.blocks.find(op.attributes) || this.paper.markups.find(op.attributes));\n        }\n      });\n    };\n\n    const onEditorChange = event => {\n      if (event.change) this.render(event);\n      this.updateBrowserSelection();\n    };\n\n    // Use mutation tracking during development to catch errors\n    // TODO delete this mutation observer when we're confident in core (or put it behind a development flag)\n    // let checking = 0;\n    // const devObserver = new MutationObserver(list => {\n    //   if (checking) clearTimeout(checking);\n    //   checking = setTimeout(() => {\n    //     checking = 0;\n    //     const diff = this.editor.contents.compose(this.decorators).diff(deltaFromDom(this));\n    //     if (diff.length()) {\n    //       console.error('Delta out of sync with DOM:', diff, this.editor.contents, deltaFromDom(this), this.decorators);\n    //     }\n    //   }, 20);\n    // });\n    // devObserver.observe(this.root, { characterData: true, characterDataOldValue: true, childList: true, attributes: true, subtree: true });\n\n\n    this.root.addEventListener('keydown', onKeyDown);\n    // this.root.addEventListener('paste', onPaste);\n    this.root.ownerDocument.addEventListener('selectionchange', onSelectionChange);\n    this.editor.on('text-changing', onTextChanging);\n    this.editor.on('editor-change', onEditorChange);\n\n    if (this.options.modules) {\n      Object.keys(this.options.modules).forEach(key => this.modules[key] = this.options.modules[key](this));\n    }\n\n    this.render();\n\n    this.uninit = () => {\n      // devObserver.disconnect();\n      this.root.removeEventListener('keydown', onKeyDown);\n      // this.root.removeEventListener('paste', onPaste);\n      this.root.ownerDocument.removeEventListener('selectionchange', onSelectionChange);\n      this.editor.off('text-changing', onTextChanging);\n      this.editor.off('editor-change', onEditorChange);\n      Object.keys(this.modules).forEach(key => {\n        const api = this.modules[key];\n        if (api && typeof api.destroy === 'function') api.destroy();\n        delete this.modules[key];\n      });\n      delete this.uninit;\n    }\n  }\n\n  /**\n   * Cleans up the listeners on the DOM and editor after they have been added.\n   */\n  uninit() {\n    // This is overwritten inside `init`\n  }\n\n  /**\n   * Clean up and allow modules to clean up before the editor is removed from the DOM.\n   */\n  destroy() {\n    this.uninit();\n    this.fire('destroy');\n  }\n}\n","import { getNodeIndex } from '../view/selection';\nimport { deltaFromDom } from '../view/dom';\nimport diff from '../diff';\n\nconst SOURCE_USER = 'user';\nconst lastWord = /\\w+[^\\w]*$/;\nconst firstWord = /^[^\\w]*\\w+/;\nconst lastLine = /[^\\n]*$/;\nconst firstLine = /^[^\\n]*/;\nlet pasteMutation = false;\n\n// Basic text input module. Prevent any actions other than typing characters and handle with the API.\nexport default function input() {\n  return view => {\n    const editor = view.editor;\n    const mutationOptions = {\n      characterData: true,\n      characterDataOldValue: true,\n      subtree: true,\n      childList: true,\n      attributes: true\n    };\n\n    // Detects changes from spell-check and the user typing\n    function onMutate(list) {\n      list = list.filter(m => m.target !== view.root);\n      if (!list.length) return;\n\n      const selection = view.getSelection();\n      const textChange = getTextChange(list);\n\n      // Only one text node has been altered. Optimize for view most common case, which is typing in a paragraph.\n      if (textChange) {\n        if (textChange.ops.length) {\n          // console.log('changing a little', textChange);\n          if (!editor.updateContents(textChange, SOURCE_USER, selection)) {\n            view.render();\n          }\n        }\n      } else {\n        let contents = deltaFromDom(view, view.root, { ignoreAttributes: true });\n        if (pasteMutation) {\n          const from = editor.selection ? editor.selection[0] : undefined;\n          const to = selection ? selection[1] : undefined;\n          contents = contents.clean(from, to);\n        }\n        contents = contents.compose(view.reverseDecorators);\n        // Decorators may extend beyond the text, pull those out\n        contents.ops = contents.ops.filter(op => op.insert);\n        const change = editor.contents.diff(contents);\n        // console.log('changing a lot (possibly)', change);\n        if (!editor.updateContents(change, SOURCE_USER, selection)) {\n          view.render();\n        }\n      }\n    }\n\n\n    function onEnter(event, shortcut) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n      let [ from, to ] = editor.getSelectedRange();\n\n      const line = editor.contents.getLine(from);\n      let attributes = line.attributes;\n      const block = view.paper.blocks.find(attributes);\n      const isDefault = !block || block === view.paper.blocks.getDefault();\n      const length = line.end - line.start - 1;\n      const atEnd = to === line.end - 1;\n      if (atEnd && !isDefault && block.defaultFollows) {\n        attributes = {};\n      }\n      const activeFormats = editor.activeFormats;\n      if (!length && !isDefault && !block.defaultFollows && from === to) {\n        editor.formatLine(from, to, {}, SOURCE_USER);\n      } else {\n        let selection = from + 1;\n        if (from === to && atEnd) {\n          from++;\n          to++;\n        }\n        editor.insertText(from, to, '\\n', attributes, SOURCE_USER, selection);\n      }\n      editor.activeFormats = activeFormats;\n    }\n\n\n    function onShiftEnter(event) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n      let [ from, to ] = editor.getSelectedRange();\n      editor.insertEmbed(from, to, 'br', true, null, SOURCE_USER);\n    }\n\n\n    function onBackspace(event, shortcut) {\n      if (event.defaultPrevented || shortcut === 'Alt+Backspace' || shortcut === 'Mod+Backspace') return;\n      event.preventDefault();\n\n      let [ from, to ] = editor.getSelectedRange();\n      if (from + to === 0) {\n        const line = editor.contents.getLine(from);\n        const block = view.paper.blocks.find(line.attributes);\n        if (block) editor.formatLine(0, {}, SOURCE_USER);\n      } else {\n        // The \"from\" block needs to stay the same. The \"to\" block gets merged into it\n        if (from === to) {\n          if ((shortcut === 'Alt+Backspace' && view.isMac) || (shortcut === 'Mod+Backspace' && !view.isMac)) {\n            const match = editor.getText().slice(0, from).match(lastWord);\n            if (match) from -= match[0].length;\n          } else if (shortcut === 'Mod+Backspace' && view.isMac) {\n            const match = editor.getText().slice(0, from).match(lastLine);\n            if (match) from -= match[0].length;\n          } else {\n            const line = editor.contents.getLine(from);\n            if (from === line.start) {\n              const blocks = view.paper.blocks;\n              const block = blocks.find(line.attributes);\n              if (block && block !== blocks.getDefault() && !block.defaultFollows) {\n                editor.formatLine(from, {}, SOURCE_USER);\n                return;\n              }\n            }\n\n            from--;\n          }\n        }\n        editor.deleteText(from, to, SOURCE_USER);\n      }\n    }\n\n    function onDelete(event, shortcut) {\n      if (event.defaultPrevented || shortcut === 'Alt+Delete') return;\n      event.preventDefault();\n\n      let [ from, to ] = editor.getSelectedRange();\n      if (from === to && from === editor.length) return;\n\n      if (from === to) {\n        if (shortcut === 'Alt+Delete' && view.isMac) {\n          const match = editor.getText().slice(from).match(firstWord);\n          if (match) to += match[0].length;\n        } else {\n          to++;\n        }\n      }\n      editor.deleteText(from, to, SOURCE_USER);\n    }\n\n    function onTab(event, shortcut) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n\n      const direction = shortcut === 'Tab' || shortcut === 'Mod+]' ? 1 : -1;\n      const [ from, to ] = editor.getSelectedRange();\n      const lines = editor.contents.getLines(from, to);\n\n      editor.transaction(() => {\n        lines.forEach((line, i) => {\n          if (line.attributes.list) {\n            let prevLine = lines[i -1];\n            if (!prevLine && line.index > 0) prevLine = editor.contents.getLine(line.start - 1);\n            const prevIndent = prevLine && prevLine.attributes.list ? prevLine.attributes.indent || 0 : -1;\n\n            let indent = line.attributes.indent || 0;\n            indent += direction;\n            if (indent > prevIndent + 1) return console.log('will not indent too much');\n            if (indent < 0) {\n              editor.formatLine(line.start, {});\n            } else {\n              const attributes = { ...line.attributes, indent };\n              editor.formatLine(line.start, attributes);\n            }\n          }\n        });\n      }, SOURCE_USER);\n    }\n\n\n    function getTextChange(mutations) {\n      const mutation = getTextChangeMutation(mutations);\n      if (!mutation) return;\n\n      const change = editor.delta();\n      const node = mutation.type === 'characterData' ? mutation.target : mutation.addedNodes[0];\n      const index = view.reverseDecorators.transform(getNodeIndex(view, node));\n      change.retain(index);\n\n      if (mutation.type === 'characterData') {\n        const diffs = diff(mutation.oldValue.replace(/\\xA0/g, ' '), mutation.target.nodeValue.replace(/\\xA0/g, ' '));\n        diffs.forEach(([ action, string ]) => {\n          if (action === diff.EQUAL) change.retain(string.length);\n          else if (action === diff.DELETE) change.delete(string.length);\n          else if (action === diff.INSERT) {\n            change.insert(string, editor.activeFormats);\n          }\n        });\n        change.chop();\n      } else {\n        change.insert(node.nodeValue.replace(/\\xA0/g, ' '), editor.activeFormats);\n      }\n\n      return change;\n    }\n\n    function getTextChangeMutation(mutations) {\n      const seen = new Set();\n      mutations = mutations.filter(m => {\n        if (m.type !== 'characterData') return true;\n        if (seen.has(m.target)) return false;\n        seen.add(m.target);\n        return true;\n      });\n\n      if (mutations.length > 3) return;\n\n      const first = mutations[0];\n      const second = mutations[1];\n      const third = mutations[2];\n      const added = first.addedNodes[0];\n      const removed = second && second.removedNodes[0];\n\n      if (mutations.length === 1) {\n        if (first.type === 'characterData') {\n          return first;\n        } else if (first.type === 'childList' && added && added.nodeType === Node.TEXT_NODE) {\n          return first;\n        }\n      } else {\n        if (first.type === 'childList' && added && added.nodeType === Node.TEXT_NODE) {\n          const textNode = third || second;\n          if (removed && removed.nodeName !== 'BR') return;\n          if (textNode.type === 'characterData' && textNode.target === added) {\n            return first;\n          }\n        }\n      }\n    }\n\n    function onPaste() {\n      pasteMutation = true;\n      setTimeout(() => {\n        pasteMutation = false;\n      }, 50);\n    }\n\n\n    const observer = new MutationObserver(onMutate);\n    observer.observe(view.root, mutationOptions);\n\n    // Don't observe the changes that occur when the view updates, we only want to respond to changes that happen\n    // outside of our API to read them back in\n    function onRendering() {\n      observer.disconnect();\n    }\n\n    // Once the view update is complete, continue observing for changes\n    function onRender() {\n      observer.observe(view.root, mutationOptions);\n    }\n\n    view.on('rendering', onRendering);\n    view.on('render', onRender);\n    view.on('shortcut:Enter', onEnter);\n    view.on('shortcut:Shift+Enter', onShiftEnter);\n    view.on('shortcut:Backspace', onBackspace);\n    view.on('shortcut:Alt+Backspace', onBackspace);\n    view.on('shortcut:Mod+Backspace', onBackspace);\n    view.on('shortcut:Delete', onDelete);\n    view.on('shortcut:Alt+Delete', onDelete);\n    view.on('shortcut:Tab', onTab);\n    view.on('shortcut:Shift+Tab', onTab);\n    view.root.addEventListener('paste', onPaste);\n\n    return {\n      destroy() {\n        observer.disconnect();\n        view.off('rendering', onRendering);\n        view.off('render', onRender);\n        view.off('shortcut:Enter', onEnter);\n        view.off('shortcut:Shift+Enter', onShiftEnter);\n        view.off('shortcut:Backspace', onBackspace);\n        view.off('shortcut:Alt+Backspace', onBackspace);\n        view.off('shortcut:Mod+Backspace', onBackspace);\n        view.off('shortcut:Delete', onDelete);\n        view.off('shortcut:Alt+Delete', onDelete);\n        view.off('shortcut:Tab', onTab);\n        view.off('shortcut:Shift+Tab', onTab);\n        view.root.removeEventListener('paste', onPaste);\n      }\n    }\n  }\n}\n\n\n","const SOURCE_USER = 'user';\n\n\nexport const keymap = {\n  'Mod+B': editor => editor.toggleTextFormat(editor.selection, { bold: true }, SOURCE_USER),\n  'Mod+I': editor => editor.toggleTextFormat(editor.selection, { italic: true }, SOURCE_USER),\n  'Mod+1': editor => editor.toggleLineFormat(editor.selection, { header: 1 }, SOURCE_USER),\n  'Mod+2': editor => editor.toggleLineFormat(editor.selection, { header: 2 }, SOURCE_USER),\n  'Mod+3': editor => editor.toggleLineFormat(editor.selection, { header: 3 }, SOURCE_USER),\n  'Mod+4': editor => editor.toggleLineFormat(editor.selection, { header: 4 }, SOURCE_USER),\n  'Mod+5': editor => editor.toggleLineFormat(editor.selection, { header: 5 }, SOURCE_USER),\n  'Mod+6': editor => editor.toggleLineFormat(editor.selection, { header: 6 }, SOURCE_USER),\n  'Mod+0': editor => editor.formatLine(editor.selection, { }, SOURCE_USER),\n};\n\nexport const macKeymap = { ...keymap };\n\n// Basic text input module. Prevent any actions other than typing characters and handle with the API.\nexport default function keyShortcuts(customShortcuts = {}) {\n  return view => {\n    const shortcuts = { ...(view.isMac ? macKeymap : keymap), ...customShortcuts };\n    const editor = view.editor;\n\n    function onShortcut(event, shortcut) {\n      if (event.defaultPrevented) return;\n      if (shortcut in shortcuts) {\n        event.preventDefault();\n        shortcuts[shortcut](editor);\n      }\n    }\n\n    view.on('shortcut', onShortcut);\n\n    return {\n      destroy() {\n        view.off('shortcut', onShortcut);\n      }\n    }\n  };\n}\n","const SOURCE_USER = 'user';\nconst SOURCE_SILENT = 'silent';\nconst defaultOptions = {\n  delay: 0,\n  maxStack: 500,\n};\n\n/**\n * History is a view module for storing user changes.\n *\n * Stores history for all user-generated changes. Like-changes will be combined until a selection or a delay timeout\n * cuts off the combining. E.g. if a user types \"Hello\" the 5 changes will be combined into one history entry. If\n * the user moves the cursor somewhere and then back to the end and types \" World\" the next 6 changes are combined\n * separately from the first 5 because selection changes add a cutoff history entries.\n *\n * The default options can be overridden by passing alternatives to history. To add a timeout to force a cutoff after\n * so many milliseconds set a delay like this:\n * ```js\n * view = new View(editor, {\n *   modules: {\n *     history: history({ delay: 4000 })\n *   }\n * })\n * ```\n */\nexport default function history(options = {}) {\n\n  return view => {\n    const editor = view.editor;\n    options = { ...defaultOptions, ...options };\n\n    const stack = options.stack || {\n      undo: [],\n      redo: [],\n    };\n    let lastRecorded = 0;\n    let lastAction;\n    let ignoreChange = false;\n\n    function undo(event) {\n      action(event, 'undo', 'redo');\n    }\n\n    function redo(event) {\n      action(event, 'redo', 'undo');\n    }\n\n    function cutoff() {\n      lastRecorded = 0;\n    }\n\n    function clear() {\n      stack.undo.length = 0;\n      stack.redo.length = 0;\n    }\n\n    function action(event, source, dest) {\n      if (event.defaultPrevented) return;\n      event.preventDefault();\n      if (stack[source].length === 0) return;\n      let entry = stack[source].pop();\n      stack[dest].push(entry);\n      cutoff();\n      ignoreChange = true;\n      if (typeof entry[source] === 'function') {\n        entry[source]();\n      } else {\n        editor.updateContents(entry[source], SOURCE_USER, entry[source + 'Selection']);\n      }\n      ignoreChange = false;\n    }\n\n    function record(change, contents, oldContents, selection, oldSelection) {\n      const timestamp = Date.now();\n      const action = getAction(change);\n      stack.redo.length = 0;\n\n      let undoChange = contents.diff(oldContents);\n      // Break combining if actions are different (e.g. a delete then an insert should break it)\n      if (!action || lastAction !== action) cutoff();\n      lastAction = action;\n\n      if (lastRecorded && (!options.delay || lastRecorded + options.delay > timestamp) && stack.undo.length > 0) {\n        // Combine with the last change\n        let entry = stack.undo.pop();\n        oldSelection = entry.undoSelection;\n        undoChange = undoChange.compose(entry.undo);\n        change = entry.redo.compose(change);\n      } else {\n        lastRecorded = timestamp;\n      }\n\n      stack.undo.push({\n        redo: change,\n        undo: undoChange,\n        redoSelection: selection,\n        undoSelection: oldSelection,\n      });\n\n      if (stack.undo.length > options.maxStack) {\n        stack.undo.shift();\n      }\n    }\n\n\n    function transform(change) {\n      stack.undo.forEach(function(entry) {\n        entry.undo = change.transform(entry.undo, true);\n        entry.redo = change.transform(entry.redo, true);\n      });\n      stack.redo.forEach(function(entry) {\n        entry.undo = change.transform(entry.undo, true);\n        entry.redo = change.transform(entry.redo, true);\n      });\n    }\n\n\n    function onTextChange({ change, contents, oldContents, selection, oldSelection, source }) {\n      if (ignoreChange) return;\n      if (source === SOURCE_USER) {\n        record(change, contents, oldContents, selection, oldSelection);\n      } else {\n        transform(change);\n      }\n    }\n\n    function onSelectionChange({ change }) {\n      if (change) return;\n      // Break the history merging when selection changes without a text change\n      cutoff();\n    }\n\n\n    editor.on('text-change', onTextChange);\n    editor.on('selection-change', onSelectionChange);\n    if (view.isMac) {\n      view.on('shortcut:Cmd+Z', undo);\n      view.on('shortcut:Cmd+Shift+Z', redo);\n    } else {\n      view.on('shortcut:Ctrl+Z', undo);\n      view.on('shortcut:Ctrl+Y', redo);\n    }\n\n    return {\n      undo,\n      redo,\n      cutoff,\n      options,\n      destroy() {\n        editor.off('text-change', onTextChange);\n        editor.off('selection-change', onSelectionChange);\n        if (view.isMac) {\n          view.off('shortcut:Cmd+Z', undo);\n          view.off('shortcut:Cmd+Shift+Z', redo);\n        } else {\n          view.off('shortcut:Ctrl+Z', undo);\n          view.off('shortcut:Ctrl+Y', redo);\n        }\n      }\n    }\n  }\n}\n\nfunction getAction(change) {\n  if (change.ops.length === 1 || change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes) {\n    const changeOp = change.ops[change.ops.length - 1];\n    if (changeOp.delete) return 'delete';\n    if (changeOp.insert === '\\n') return 'newline';\n    if (changeOp.insert) return 'insert';\n  }\n  return '';\n}\n","import { h } from '../view/vdom';\n\nexport default function placeholder(placeholder) {\n  return view => {\n\n    view.paper.markups.add({\n      name: 'placeholder',\n      selector: 'span.placholder',\n      vdom: children => <span class=\"placeholder\" style={{pointerEvents: 'none'}}>{children}</span>,\n    });\n\n    function onDecorate(editor) {\n      if (editor.length === 1) {\n        editor.insertText(placeholder, { placeholder: true });\n      }\n    }\n\n    view.on('decorate', onDecorate);\n\n    return {\n      destroy() {\n        view.off('decorate', onDecorate);\n      }\n    }\n  }\n}\n","const SOURCE_USER = 'user';\n\n/**\n * A list of [ RegExp, Function ] tuples to convert text into a formatted block with the attributes returned by the\n * function. The function's argument will be the captured text from the regular expression.\n */\nexport const blockReplacements = [\n  [ /^(#{1,6}) $/, capture => ({ header: capture.length }) ],\n  [ /^[-*] $/, () => ({ list: 'bullet' }) ],\n  [ /^1\\. $/, () => ({ list: 'ordered' }) ], // Use /^(-?\\d+)\\. $/ to support lists starting at something other than 1.\n  [ /^> $/, () => ({ blockquote: true }) ],\n];\n\n/**\n * A list of [ RegExp, Function ] tuples to convert text into another string of text which is returned by the function.\n * The function's argument will be the captured text from the regular expression.\n */\nexport const textReplacements = [\n  [ /--$/, () => 'â€”' ],\n  [ /\\.\\.\\.$/, () => 'â€¦' ],\n];\n\n/**\n * Allow text representations to format a block\n */\nexport function blockReplace(editor, index, prefix) {\n  return blockReplacements.some(([ regexp, getAttributes ]) => {\n    const match = prefix.match(regexp);\n    if (match) {\n      const attributes = getAttributes(match[1]);\n      const change = editor.getChange(() => {\n        editor.formatLine(index, attributes);\n        editor.deleteText(index - prefix.length, index);\n      });\n      editor.updateContents(change, SOURCE_USER, index - prefix.length);\n      return true;\n    }\n  });\n}\n\nexport function textReplace(editor, index, prefix) {\n  return textReplacements.some(([ regexp, replaceWith ]) => {\n    const match = prefix.match(regexp);\n    if (match) {\n      editor.insertText(index - match[0].length, index, replaceWith(match[1]), null, SOURCE_USER);\n      return true;\n    }\n  });\n}\n\nexport const defaultHandlers = [ blockReplace, textReplace ];\n\n\nexport default function(handlers = defaultHandlers) {\n\n  return view => {\n    const editor = view.editor;\n    let ignore = false;\n\n    function onTextChange({ change, source }) {\n      if (ignore || source !== 'user' || !editor.selection || !isTextEntry(change)) return;\n      const index = editor.selection[1];\n      const text = editor.getExactText();\n      const lineStart = text.lastIndexOf('\\n', index - 1) + 1;\n      const prefix = text.slice(lineStart, index);\n\n      ignore = true;\n      handlers.some(handler => handler(editor, index, prefix));\n      ignore = false;\n    }\n\n    editor.on('text-change', onTextChange);\n\n    return {\n      destroy() {\n        editor.off('text-change', onTextChange);\n      }\n    }\n  };\n}\n\n\nfunction isTextEntry(change) {\n  return (\n    change.ops.length === 1 ||\n    (change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes)\n  ) &&\n    change.ops[change.ops.length - 1].insert &&\n    change.ops[change.ops.length - 1].insert !== '\\n';\n}\n","\n/**\n * Replaces regular quotes with smart quotes as they are typed. Does not affect pasted content.\n * Uses the text-changing event to prevent the original change and replace it with the new one. This makes the smart-\n * quotes act more seemlessly and includes them as part of regular text undo/redo instead of breaking it like the smart-\n * entry conversions do.\n */\nexport default function smartQuotes() {\n  return view => {\n    const editor = view.editor;\n\n    function onTextChange({ change, source, selection }) {\n      if (source !== 'user' || !editor.selection || !isTextEntry(change)) return;\n\n      const index = editor.selection[1];\n      const lastOp = change.ops[change.ops.length - 1];\n      const lastChars = editor.getText(index - 1, index) + lastOp.insert.slice(-1);\n\n      const replaced = lastChars.replace(/(?:^|[\\s\\{\\[\\(\\<'\"\\u2018\\u201C])(\")$/, 'â€œ')\n              .replace(/\"$/, 'â€')\n              .replace(/(?:^|[\\s\\{\\[\\(\\<'\"\\u2018\\u201C])(')$/, 'â€˜')\n              .replace(/'$/, 'â€™');\n\n      if (replaced !== lastChars) {\n        const quote = replaced.slice(-1);\n        lastOp.insert = lastOp.insert.slice(0, -1) + quote;\n        editor.updateContents(change, source, selection);\n        return false;\n      }\n    }\n\n    editor.on('text-changing', onTextChange);\n\n    return {\n      destroy() {\n        editor.off('text-changing', onTextChange);\n      }\n    }\n  }\n}\n\n\n/**\n * Adds smartquotes to a document as a decorator. This does not affect the source, allowing you to store regular quotes\n * in your source data but display smart quotes to the user. Use this as an alternative to the module above, not in\n * addition to it.\n */\nexport function smartQuotesDecorator() {\n  return view => {\n    const quotes = [\n      [ /(^|\\s)\"/g, /(^|\\s)\"/, '$1â€œ' ],\n      [ /\"/g, /\"/, 'â€'],\n      [ /\\b'/g, /'/, 'â€™'],\n      [ /'/g, /'/, 'â€˜'],\n    ];\n\n    function onDecorate(editor) {\n      let { text } = editor;\n      quotes.forEach(([ expr, replacer, replaceWith ]) => {\n        let match;\n        while ((match = expr.exec(text))) {\n          const replacement = match[0].replace(replacer, replaceWith);\n          text = text.slice(0, match.index) + replacement + text.slice(expr.lastIndex);\n          editor.insertText(match.index, expr.lastIndex, replacement);\n        }\n      });\n    }\n\n    view.on('decorate', onDecorate);\n\n    return {\n      destroy() {\n        view.off('decorate', onDecorate);\n      }\n    }\n  }\n}\n\n\nfunction isTextEntry(change) {\n  return (\n    change.ops.length === 1 ||\n    (change.ops.length === 2 && change.ops[0].retain && !change.ops[0].attributes)\n  ) &&\n    typeof change.ops[change.ops.length - 1].insert === 'string' &&\n    change.ops[change.ops.length - 1].insert !== '\\n';\n}\n","function noop() {}\n\nfunction assign(tar, src) {\n\tfor (var k in src) tar[k] = src[k];\n\treturn tar;\n}\n\nfunction assignTrue(tar, src) {\n\tfor (var k in src) tar[k] = 1;\n\treturn tar;\n}\n\nfunction isPromise(value) {\n\treturn value && typeof value.then === 'function';\n}\n\nfunction callAfter(fn, i) {\n\tif (i === 0) fn();\n\treturn () => {\n\t\tif (!--i) fn();\n\t};\n}\n\nfunction addLoc(element, file, line, column, char) {\n\telement.__svelte_meta = {\n\t\tloc: { file, line, column, char }\n\t};\n}\n\nfunction exclude(src, prop) {\n\tconst tar = {};\n\tfor (const k in src) k === prop || (tar[k] = src[k]);\n\treturn tar;\n}\n\nfunction run(fn) {\n\tfn();\n}\n\nfunction append(target, node) {\n\ttarget.appendChild(node);\n}\n\nfunction insert(target, node, anchor) {\n\ttarget.insertBefore(node, anchor);\n}\n\nfunction detachNode(node) {\n\tnode.parentNode.removeChild(node);\n}\n\nfunction detachBetween(before, after) {\n\twhile (before.nextSibling && before.nextSibling !== after) {\n\t\tbefore.parentNode.removeChild(before.nextSibling);\n\t}\n}\n\nfunction detachBefore(after) {\n\twhile (after.previousSibling) {\n\t\tafter.parentNode.removeChild(after.previousSibling);\n\t}\n}\n\nfunction detachAfter(before) {\n\twhile (before.nextSibling) {\n\t\tbefore.parentNode.removeChild(before.nextSibling);\n\t}\n}\n\nfunction reinsertBetween(before, after, target) {\n\twhile (before.nextSibling && before.nextSibling !== after) {\n\t\ttarget.appendChild(before.parentNode.removeChild(before.nextSibling));\n\t}\n}\n\nfunction reinsertChildren(parent, target) {\n\twhile (parent.firstChild) target.appendChild(parent.firstChild);\n}\n\nfunction reinsertAfter(before, target) {\n\twhile (before.nextSibling) target.appendChild(before.nextSibling);\n}\n\nfunction reinsertBefore(after, target) {\n\tvar parent = after.parentNode;\n\twhile (parent.firstChild !== after) target.appendChild(parent.firstChild);\n}\n\nfunction destroyEach(iterations, detach) {\n\tfor (var i = 0; i < iterations.length; i += 1) {\n\t\tif (iterations[i]) iterations[i].d(detach);\n\t}\n}\n\nfunction createFragment() {\n\treturn document.createDocumentFragment();\n}\n\nfunction createElement(name) {\n\treturn document.createElement(name);\n}\n\nfunction createSvgElement(name) {\n\treturn document.createElementNS('http://www.w3.org/2000/svg', name);\n}\n\nfunction createText(data) {\n\treturn document.createTextNode(data);\n}\n\nfunction createComment() {\n\treturn document.createComment('');\n}\n\nfunction addListener(node, event, handler, options) {\n\tnode.addEventListener(event, handler, options);\n}\n\nfunction removeListener(node, event, handler, options) {\n\tnode.removeEventListener(event, handler, options);\n}\n\nfunction setAttribute(node, attribute, value) {\n\tif (value == null) node.removeAttribute(attribute);\n\telse node.setAttribute(attribute, value);\n}\n\nfunction setAttributes(node, attributes) {\n\tfor (var key in attributes) {\n\t\tif (key === 'style') {\n\t\t\tnode.style.cssText = attributes[key];\n\t\t} else if (key in node) {\n\t\t\tnode[key] = attributes[key];\n\t\t} else {\n\t\t\tsetAttribute(node, key, attributes[key]);\n\t\t}\n\t}\n}\n\nfunction setCustomElementData(node, prop, value) {\n\tif (prop in node) {\n\t\tnode[prop] = value;\n\t} else if (value) {\n\t\tsetAttribute(node, prop, value);\n\t} else {\n\t\tnode.removeAttribute(prop);\n\t}\n}\n\nfunction setXlinkAttribute(node, attribute, value) {\n\tnode.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\n\nfunction getBindingGroupValue(group) {\n\tvar value = [];\n\tfor (var i = 0; i < group.length; i += 1) {\n\t\tif (group[i].checked) value.push(group[i].__value);\n\t}\n\treturn value;\n}\n\nfunction toNumber(value) {\n\treturn value === '' ? undefined : +value;\n}\n\nfunction timeRangesToArray(ranges) {\n\tvar array = [];\n\tfor (var i = 0; i < ranges.length; i += 1) {\n\t\tarray.push({ start: ranges.start(i), end: ranges.end(i) });\n\t}\n\treturn array;\n}\n\nfunction children (element) {\n\treturn Array.from(element.childNodes);\n}\n\nfunction claimElement (nodes, name, attributes, svg) {\n\tfor (var i = 0; i < nodes.length; i += 1) {\n\t\tvar node = nodes[i];\n\t\tif (node.nodeName === name) {\n\t\t\tfor (var j = 0; j < node.attributes.length; j += 1) {\n\t\t\t\tvar attribute = node.attributes[j];\n\t\t\t\tif (!attributes[attribute.name]) node.removeAttribute(attribute.name);\n\t\t\t}\n\t\t\treturn nodes.splice(i, 1)[0]; // TODO strip unwanted attributes\n\t\t}\n\t}\n\n\treturn svg ? createSvgElement(name) : createElement(name);\n}\n\nfunction claimText (nodes, data) {\n\tfor (var i = 0; i < nodes.length; i += 1) {\n\t\tvar node = nodes[i];\n\t\tif (node.nodeType === 3) {\n\t\t\tnode.data = data;\n\t\t\treturn nodes.splice(i, 1)[0];\n\t\t}\n\t}\n\n\treturn createText(data);\n}\n\nfunction setData(text, data) {\n\ttext.data = '' + data;\n}\n\nfunction setInputType(input, type) {\n\ttry {\n\t\tinput.type = type;\n\t} catch (e) {}\n}\n\nfunction setStyle(node, key, value) {\n\tnode.style.setProperty(key, value);\n}\n\nfunction selectOption(select, value) {\n\tfor (var i = 0; i < select.options.length; i += 1) {\n\t\tvar option = select.options[i];\n\n\t\tif (option.__value === value) {\n\t\t\toption.selected = true;\n\t\t\treturn;\n\t\t}\n\t}\n}\n\nfunction selectOptions(select, value) {\n\tfor (var i = 0; i < select.options.length; i += 1) {\n\t\tvar option = select.options[i];\n\t\toption.selected = ~value.indexOf(option.__value);\n\t}\n}\n\nfunction selectValue(select) {\n\tvar selectedOption = select.querySelector(':checked') || select.options[0];\n\treturn selectedOption && selectedOption.__value;\n}\n\nfunction selectMultipleValue(select) {\n\treturn [].map.call(select.querySelectorAll(':checked'), function(option) {\n\t\treturn option.__value;\n\t});\n}\n\nfunction addResizeListener(element, fn) {\n\tif (getComputedStyle(element).position === 'static') {\n\t\telement.style.position = 'relative';\n\t}\n\n\tconst object = document.createElement('object');\n\tobject.setAttribute('style', 'display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;');\n\tobject.type = 'text/html';\n\n\tlet win;\n\n\tobject.onload = () => {\n\t\twin = object.contentDocument.defaultView;\n\t\twin.addEventListener('resize', fn);\n\t};\n\n\tif (/Trident/.test(navigator.userAgent)) {\n\t\telement.appendChild(object);\n\t\tobject.data = 'about:blank';\n\t} else {\n\t\tobject.data = 'about:blank';\n\t\telement.appendChild(object);\n\t}\n\n\treturn {\n\t\tcancel: () => {\n\t\t\twin && win.removeEventListener && win.removeEventListener('resize', fn);\n\t\t\telement.removeChild(object);\n\t\t}\n\t};\n}\n\nfunction toggleClass(element, name, toggle) {\n\telement.classList.toggle(name, !!toggle);\n}\n\nfunction linear(t) {\n\treturn t;\n}\n\nfunction generateRule({ a, b, delta, duration }, ease, fn) {\n\tconst step = 16.666 / duration;\n\tlet keyframes = '{\\n';\n\n\tfor (let p = 0; p <= 1; p += step) {\n\t\tconst t = a + delta * ease(p);\n\t\tkeyframes += p * 100 + `%{${fn(t, 1 - t)}}\\n`;\n\t}\n\n\treturn keyframes + `100% {${fn(b, 1 - b)}}\\n}`;\n}\n\n// https://github.com/darkskyapp/string-hash/blob/master/index.js\nfunction hash(str) {\n\tlet hash = 5381;\n\tlet i = str.length;\n\n\twhile (i--) hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\n\treturn hash >>> 0;\n}\n\nfunction wrapTransition(component, node, fn, params, intro) {\n\tlet obj = fn.call(component, node, params);\n\tlet duration;\n\tlet ease;\n\tlet cssText;\n\n\tlet initialised = false;\n\n\treturn {\n\t\tt: intro ? 0 : 1,\n\t\trunning: false,\n\t\tprogram: null,\n\t\tpending: null,\n\n\t\trun(b, callback) {\n\t\t\tif (typeof obj === 'function') {\n\t\t\t\ttransitionManager.wait().then(() => {\n\t\t\t\t\tobj = obj();\n\t\t\t\t\tthis._run(b, callback);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis._run(b, callback);\n\t\t\t}\n\t\t},\n\n\t\t_run(b, callback) {\n\t\t\tduration = obj.duration || 300;\n\t\t\tease = obj.easing || linear;\n\n\t\t\tconst program = {\n\t\t\t\tstart: window.performance.now() + (obj.delay || 0),\n\t\t\t\tb,\n\t\t\t\tcallback: callback || noop\n\t\t\t};\n\n\t\t\tif (intro && !initialised) {\n\t\t\t\tif (obj.css && obj.delay) {\n\t\t\t\t\tcssText = node.style.cssText;\n\t\t\t\t\tnode.style.cssText += obj.css(0, 1);\n\t\t\t\t}\n\n\t\t\t\tif (obj.tick) obj.tick(0, 1);\n\t\t\t\tinitialised = true;\n\t\t\t}\n\n\t\t\tif (!b) {\n\t\t\t\tprogram.group = outros.current;\n\t\t\t\toutros.current.remaining += 1;\n\t\t\t}\n\n\t\t\tif (obj.delay) {\n\t\t\t\tthis.pending = program;\n\t\t\t} else {\n\t\t\t\tthis.start(program);\n\t\t\t}\n\n\t\t\tif (!this.running) {\n\t\t\t\tthis.running = true;\n\t\t\t\ttransitionManager.add(this);\n\t\t\t}\n\t\t},\n\n\t\tstart(program) {\n\t\t\tcomponent.fire(`${program.b ? 'intro' : 'outro'}.start`, { node });\n\n\t\t\tprogram.a = this.t;\n\t\t\tprogram.delta = program.b - program.a;\n\t\t\tprogram.duration = duration * Math.abs(program.b - program.a);\n\t\t\tprogram.end = program.start + program.duration;\n\n\t\t\tif (obj.css) {\n\t\t\t\tif (obj.delay) node.style.cssText = cssText;\n\n\t\t\t\tconst rule = generateRule(program, ease, obj.css);\n\t\t\t\ttransitionManager.addRule(rule, program.name = '__svelte_' + hash(rule));\n\n\t\t\t\tnode.style.animation = (node.style.animation || '')\n\t\t\t\t\t.split(', ')\n\t\t\t\t\t.filter(anim => anim && (program.delta < 0 || !/__svelte/.test(anim)))\n\t\t\t\t\t.concat(`${program.name} ${program.duration}ms linear 1 forwards`)\n\t\t\t\t\t.join(', ');\n\t\t\t}\n\n\t\t\tthis.program = program;\n\t\t\tthis.pending = null;\n\t\t},\n\n\t\tupdate(now) {\n\t\t\tconst program = this.program;\n\t\t\tif (!program) return;\n\n\t\t\tconst p = now - program.start;\n\t\t\tthis.t = program.a + program.delta * ease(p / program.duration);\n\t\t\tif (obj.tick) obj.tick(this.t, 1 - this.t);\n\t\t},\n\n\t\tdone() {\n\t\t\tconst program = this.program;\n\t\t\tthis.t = program.b;\n\n\t\t\tif (obj.tick) obj.tick(this.t, 1 - this.t);\n\n\t\t\tcomponent.fire(`${program.b ? 'intro' : 'outro'}.end`, { node });\n\n\t\t\tif (!program.b && !program.invalidated) {\n\t\t\t\tprogram.group.callbacks.push(() => {\n\t\t\t\t\tprogram.callback();\n\t\t\t\t\tif (obj.css) transitionManager.deleteRule(node, program.name);\n\t\t\t\t});\n\n\t\t\t\tif (--program.group.remaining === 0) {\n\t\t\t\t\tprogram.group.callbacks.forEach(run);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (obj.css) transitionManager.deleteRule(node, program.name);\n\t\t\t}\n\n\t\t\tthis.running = !!this.pending;\n\t\t},\n\n\t\tabort(reset) {\n\t\t\tif (this.program) {\n\t\t\t\tif (reset && obj.tick) obj.tick(1, 0);\n\t\t\t\tif (obj.css) transitionManager.deleteRule(node, this.program.name);\n\t\t\t\tthis.program = this.pending = null;\n\t\t\t\tthis.running = false;\n\t\t\t}\n\t\t},\n\n\t\tinvalidate() {\n\t\t\tif (this.program) {\n\t\t\t\tthis.program.invalidated = true;\n\t\t\t}\n\t\t}\n\t};\n}\n\nlet outros = {};\n\nfunction groupOutros() {\n\toutros.current = {\n\t\tremaining: 0,\n\t\tcallbacks: []\n\t};\n}\n\nvar transitionManager = {\n\trunning: false,\n\ttransitions: [],\n\tbound: null,\n\tstylesheet: null,\n\tactiveRules: {},\n\tpromise: null,\n\n\tadd(transition) {\n\t\tthis.transitions.push(transition);\n\n\t\tif (!this.running) {\n\t\t\tthis.running = true;\n\t\t\trequestAnimationFrame(this.bound || (this.bound = this.next.bind(this)));\n\t\t}\n\t},\n\n\taddRule(rule, name) {\n\t\tif (!this.stylesheet) {\n\t\t\tconst style = createElement('style');\n\t\t\tdocument.head.appendChild(style);\n\t\t\ttransitionManager.stylesheet = style.sheet;\n\t\t}\n\n\t\tif (!this.activeRules[name]) {\n\t\t\tthis.activeRules[name] = true;\n\t\t\tthis.stylesheet.insertRule(`@keyframes ${name} ${rule}`, this.stylesheet.cssRules.length);\n\t\t}\n\t},\n\n\tnext() {\n\t\tthis.running = false;\n\n\t\tconst now = window.performance.now();\n\t\tlet i = this.transitions.length;\n\n\t\twhile (i--) {\n\t\t\tconst transition = this.transitions[i];\n\n\t\t\tif (transition.program && now >= transition.program.end) {\n\t\t\t\ttransition.done();\n\t\t\t}\n\n\t\t\tif (transition.pending && now >= transition.pending.start) {\n\t\t\t\ttransition.start(transition.pending);\n\t\t\t}\n\n\t\t\tif (transition.running) {\n\t\t\t\ttransition.update(now);\n\t\t\t\tthis.running = true;\n\t\t\t} else if (!transition.pending) {\n\t\t\t\tthis.transitions.splice(i, 1);\n\t\t\t}\n\t\t}\n\n\t\tif (this.running) {\n\t\t\trequestAnimationFrame(this.bound);\n\t\t} else if (this.stylesheet) {\n\t\t\tlet i = this.stylesheet.cssRules.length;\n\t\t\twhile (i--) this.stylesheet.deleteRule(i);\n\t\t\tthis.activeRules = {};\n\t\t}\n\t},\n\n\tdeleteRule(node, name) {\n\t\tnode.style.animation = node.style.animation\n\t\t\t.split(', ')\n\t\t\t.filter(anim => anim && anim.indexOf(name) === -1)\n\t\t\t.join(', ');\n\t},\n\n\twait() {\n\t\tif (!transitionManager.promise) {\n\t\t\ttransitionManager.promise = Promise.resolve();\n\t\t\ttransitionManager.promise.then(() => {\n\t\t\t\ttransitionManager.promise = null;\n\t\t\t});\n\t\t}\n\n\t\treturn transitionManager.promise;\n\t}\n};\n\nfunction wrapAnimation(node, from, fn, params) {\n\tif (!from) return;\n\n\tconst to = node.getBoundingClientRect();\n\tif (from.left === to.left && from.right === to.right && from.top === to.top && from.bottom === to.bottom) return;\n\n\tconst info = fn(node, { from, to }, params);\n\n\tconst duration = 'duration' in info ? info.duration : 300;\n\tconst delay = 'delay' in info ? info.delay : 0;\n\tconst ease = info.easing || linear;\n\tconst start = window.performance.now() + delay;\n\tconst end = start + duration;\n\n\tconst program = {\n\t\ta: 0,\n\t\tt: 0,\n\t\tb: 1,\n\t\tdelta: 1,\n\t\tduration,\n\t\tstart,\n\t\tend\n\t};\n\n\tconst cssText = node.style.cssText;\n\n\tconst animation = {\n\t\tpending: delay ? program : null,\n\t\tprogram: delay ? null : program,\n\t\trunning: true,\n\n\t\tstart() {\n\t\t\tif (info.css) {\n\t\t\t\tif (delay) node.style.cssText = cssText;\n\n\t\t\t\tconst rule = generateRule(program, ease, info.css);\n\t\t\t\tprogram.name = `__svelte_${hash(rule)}`;\n\n\t\t\t\ttransitionManager.addRule(rule, program.name);\n\n\t\t\t\tnode.style.animation = (node.style.animation || '')\n\t\t\t\t\t.split(', ')\n\t\t\t\t\t.filter(anim => anim && (program.delta < 0 || !/__svelte/.test(anim)))\n\t\t\t\t\t.concat(`${program.name} ${program.duration}ms linear 1 forwards`)\n\t\t\t\t\t.join(', ');\n\t\t\t}\n\n\t\t\tanimation.program = program;\n\t\t\tanimation.pending = null;\n\t\t},\n\n\t\tupdate: now => {\n\t\t\tconst p = now - program.start;\n\t\t\tconst t = program.a + program.delta * ease(p / program.duration);\n\t\t\tif (info.tick) info.tick(t, 1 - t);\n\t\t},\n\n\t\tdone() {\n\t\t\tif (info.tick) info.tick(1, 0);\n\t\t\tanimation.stop();\n\t\t},\n\n\t\tstop() {\n\t\t\tif (info.css) transitionManager.deleteRule(node, program.name);\n\t\t\tanimation.running = false;\n\t\t}\n\t};\n\n\ttransitionManager.add(animation);\n\n\tif (info.tick) info.tick(0, 1);\n\n\tif (delay) {\n\t\tif (info.css) node.style.cssText += info.css(0, 1);\n\t} else {\n\t\tanimation.start();\n\t}\n\n\treturn animation;\n}\n\nfunction fixPosition(node) {\n\tconst style = getComputedStyle(node);\n\n\tif (style.position !== 'absolute' && style.position !== 'fixed') {\n\t\tconst { width, height } = style;\n\t\tconst a = node.getBoundingClientRect();\n\t\tnode.style.position = 'absolute';\n\t\tnode.style.width = width;\n\t\tnode.style.height = height;\n\t\tconst b = node.getBoundingClientRect();\n\n\t\tif (a.left !== b.left || a.top !== b.top) {\n\t\t\tconst style = getComputedStyle(node);\n\t\t\tconst transform = style.transform === 'none' ? '' : style.transform;\n\n\t\t\tnode.style.transform = `${transform} translate(${a.left - b.left}px, ${a.top - b.top}px)`;\n\t\t}\n\t}\n}\n\nfunction handlePromise(promise, info) {\n\tvar token = info.token = {};\n\n\tfunction update(type, index, key, value) {\n\t\tif (info.token !== token) return;\n\n\t\tinfo.resolved = key && { [key]: value };\n\n\t\tconst child_ctx = assign(assign({}, info.ctx), info.resolved);\n\t\tconst block = type && (info.current = type)(info.component, child_ctx);\n\n\t\tif (info.block) {\n\t\t\tif (info.blocks) {\n\t\t\t\tinfo.blocks.forEach((block, i) => {\n\t\t\t\t\tif (i !== index && block) {\n\t\t\t\t\t\tgroupOutros();\n\t\t\t\t\t\tblock.o(() => {\n\t\t\t\t\t\t\tblock.d(1);\n\t\t\t\t\t\t\tinfo.blocks[i] = null;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tinfo.block.d(1);\n\t\t\t}\n\n\t\t\tblock.c();\n\t\t\tblock[block.i ? 'i' : 'm'](info.mount(), info.anchor);\n\n\t\t\tinfo.component.root.set({}); // flush any handlers that were created\n\t\t}\n\n\t\tinfo.block = block;\n\t\tif (info.blocks) info.blocks[index] = block;\n\t}\n\n\tif (isPromise(promise)) {\n\t\tpromise.then(value => {\n\t\t\tupdate(info.then, 1, info.value, value);\n\t\t}, error => {\n\t\t\tupdate(info.catch, 2, info.error, error);\n\t\t});\n\n\t\t// if we previously had a then/catch block, destroy it\n\t\tif (info.current !== info.pending) {\n\t\t\tupdate(info.pending, 0);\n\t\t\treturn true;\n\t\t}\n\t} else {\n\t\tif (info.current !== info.then) {\n\t\t\tupdate(info.then, 1, info.value, promise);\n\t\t\treturn true;\n\t\t}\n\n\t\tinfo.resolved = { [info.value]: promise };\n\t}\n}\n\nfunction destroyBlock(block, lookup) {\n\tblock.d(1);\n\tlookup[block.key] = null;\n}\n\nfunction outroAndDestroyBlock(block, lookup) {\n\tblock.o(function() {\n\t\tdestroyBlock(block, lookup);\n\t});\n}\n\nfunction fixAndOutroAndDestroyBlock(block, lookup) {\n\tblock.f();\n\toutroAndDestroyBlock(block, lookup);\n}\n\nfunction updateKeyedEach(old_blocks, component, changed, get_key, dynamic, ctx, list, lookup, node, destroy, create_each_block, intro_method, next, get_context) {\n\tvar o = old_blocks.length;\n\tvar n = list.length;\n\n\tvar i = o;\n\tvar old_indexes = {};\n\twhile (i--) old_indexes[old_blocks[i].key] = i;\n\n\tvar new_blocks = [];\n\tvar new_lookup = {};\n\tvar deltas = {};\n\n\tvar i = n;\n\twhile (i--) {\n\t\tvar child_ctx = get_context(ctx, list, i);\n\t\tvar key = get_key(child_ctx);\n\t\tvar block = lookup[key];\n\n\t\tif (!block) {\n\t\t\tblock = create_each_block(component, key, child_ctx);\n\t\t\tblock.c();\n\t\t} else if (dynamic) {\n\t\t\tblock.p(changed, child_ctx);\n\t\t}\n\n\t\tnew_blocks[i] = new_lookup[key] = block;\n\n\t\tif (key in old_indexes) deltas[key] = Math.abs(i - old_indexes[key]);\n\t}\n\n\tvar will_move = {};\n\tvar did_move = {};\n\n\tfunction insert(block) {\n\t\tblock[intro_method](node, next);\n\t\tlookup[block.key] = block;\n\t\tnext = block.first;\n\t\tn--;\n\t}\n\n\twhile (o && n) {\n\t\tvar new_block = new_blocks[n - 1];\n\t\tvar old_block = old_blocks[o - 1];\n\t\tvar new_key = new_block.key;\n\t\tvar old_key = old_block.key;\n\n\t\tif (new_block === old_block) {\n\t\t\t// do nothing\n\t\t\tnext = new_block.first;\n\t\t\to--;\n\t\t\tn--;\n\t\t}\n\n\t\telse if (!new_lookup[old_key]) {\n\t\t\t// remove old block\n\t\t\tdestroy(old_block, lookup);\n\t\t\to--;\n\t\t}\n\n\t\telse if (!lookup[new_key] || will_move[new_key]) {\n\t\t\tinsert(new_block);\n\t\t}\n\n\t\telse if (did_move[old_key]) {\n\t\t\to--;\n\n\t\t} else if (deltas[new_key] > deltas[old_key]) {\n\t\t\tdid_move[new_key] = true;\n\t\t\tinsert(new_block);\n\n\t\t} else {\n\t\t\twill_move[old_key] = true;\n\t\t\to--;\n\t\t}\n\t}\n\n\twhile (o--) {\n\t\tvar old_block = old_blocks[o];\n\t\tif (!new_lookup[old_block.key]) destroy(old_block, lookup);\n\t}\n\n\twhile (n) insert(new_blocks[n - 1]);\n\n\treturn new_blocks;\n}\n\nfunction measure(blocks) {\n\tconst rects = {};\n\tlet i = blocks.length;\n\twhile (i--) rects[blocks[i].key] = blocks[i].node.getBoundingClientRect();\n\treturn rects;\n}\n\nfunction animate(blocks, rects, fn, params) {\n\tlet i = blocks.length;\n\twhile (i--) {\n\t\tconst block = blocks[i];\n\t\tconst from = rects[block.key];\n\n\t\tif (!from) continue;\n\t\tconst to = block.node.getBoundingClientRect();\n\n\t\tif (from.left === to.left && from.right === to.right && from.top === to.top && from.bottom === to.bottom) continue;\n\n\n\t}\n}\n\nfunction getSpreadUpdate(levels, updates) {\n\tvar update = {};\n\n\tvar to_null_out = {};\n\tvar accounted_for = {};\n\n\tvar i = levels.length;\n\twhile (i--) {\n\t\tvar o = levels[i];\n\t\tvar n = updates[i];\n\n\t\tif (n) {\n\t\t\tfor (var key in o) {\n\t\t\t\tif (!(key in n)) to_null_out[key] = 1;\n\t\t\t}\n\n\t\t\tfor (var key in n) {\n\t\t\t\tif (!accounted_for[key]) {\n\t\t\t\t\tupdate[key] = n[key];\n\t\t\t\t\taccounted_for[key] = 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlevels[i] = n;\n\t\t} else {\n\t\t\tfor (var key in o) {\n\t\t\t\taccounted_for[key] = 1;\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (var key in to_null_out) {\n\t\tif (!(key in update)) update[key] = undefined;\n\t}\n\n\treturn update;\n}\n\n// https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\n// https://infra.spec.whatwg.org/#noncharacter\nconst invalidAttributeNameCharacter = /[\\s'\">\\/=\\u{FDD0}-\\u{FDEF}\\u{FFFE}\\u{FFFF}\\u{1FFFE}\\u{1FFFF}\\u{2FFFE}\\u{2FFFF}\\u{3FFFE}\\u{3FFFF}\\u{4FFFE}\\u{4FFFF}\\u{5FFFE}\\u{5FFFF}\\u{6FFFE}\\u{6FFFF}\\u{7FFFE}\\u{7FFFF}\\u{8FFFE}\\u{8FFFF}\\u{9FFFE}\\u{9FFFF}\\u{AFFFE}\\u{AFFFF}\\u{BFFFE}\\u{BFFFF}\\u{CFFFE}\\u{CFFFF}\\u{DFFFE}\\u{DFFFF}\\u{EFFFE}\\u{EFFFF}\\u{FFFFE}\\u{FFFFF}\\u{10FFFE}\\u{10FFFF}]/u;\n\nfunction spread(args) {\n\tconst attributes = Object.assign({}, ...args);\n\tlet str = '';\n\n\tObject.keys(attributes).forEach(name => {\n\t\tif (invalidAttributeNameCharacter.test(name)) return;\n\n\t\tconst value = attributes[name];\n\t\tif (value === undefined) return;\n\t\tif (value === true) str += \" \" + name;\n\n\t\tconst escaped = String(value)\n\t\t\t.replace(/\"/g, '&#34;')\n\t\t\t.replace(/'/g, '&#39;');\n\n\t\tstr += \" \" + name + \"=\" + JSON.stringify(escaped);\n\t});\n\n\treturn str;\n}\n\nconst escaped = {\n\t'\"': '&quot;',\n\t\"'\": '&#39;',\n\t'&': '&amp;',\n\t'<': '&lt;',\n\t'>': '&gt;'\n};\n\nfunction escape(html) {\n\treturn String(html).replace(/[\"'&<>]/g, match => escaped[match]);\n}\n\nfunction each(items, assign, fn) {\n\tlet str = '';\n\tfor (let i = 0; i < items.length; i += 1) {\n\t\tstr += fn(assign(items[i], i));\n\t}\n\treturn str;\n}\n\nconst missingComponent = {\n\t_render: () => ''\n};\n\nfunction validateSsrComponent(component, name) {\n\tif (!component || !component._render) {\n\t\tif (name === 'svelte:component') name += ' this={...}';\n\t\tthrow new Error(`<${name}> is not a valid SSR component. You may need to review your build config to ensure that dependencies are compiled, rather than imported as pre-compiled modules`);\n\t}\n\n\treturn component;\n}\n\nfunction debug(file, line, column, values) {\n\tconsole.log(`{@debug} ${file ? file + ' ' : ''}(${line}:${column})`);\n\tconsole.log(values);\n\treturn '';\n}\n\nfunction blankObject() {\n\treturn Object.create(null);\n}\n\nfunction destroy(detach) {\n\tthis.destroy = noop;\n\tthis.fire('destroy');\n\tthis.set = noop;\n\n\tthis._fragment.d(detach !== false);\n\tthis._fragment = null;\n\tthis._state = {};\n}\n\nfunction destroyDev(detach) {\n\tdestroy.call(this, detach);\n\tthis.destroy = function() {\n\t\tconsole.warn('Component was already destroyed');\n\t};\n}\n\nfunction _differs(a, b) {\n\treturn a != a ? b == b : a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n}\n\nfunction _differsImmutable(a, b) {\n\treturn a != a ? b == b : a !== b;\n}\n\nfunction fire(eventName, data) {\n\tvar handlers =\n\t\teventName in this._handlers && this._handlers[eventName].slice();\n\tif (!handlers) return;\n\n\tfor (var i = 0; i < handlers.length; i += 1) {\n\t\tvar handler = handlers[i];\n\n\t\tif (!handler.__calling) {\n\t\t\ttry {\n\t\t\t\thandler.__calling = true;\n\t\t\t\thandler.call(this, data);\n\t\t\t} finally {\n\t\t\t\thandler.__calling = false;\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction flush(component) {\n\tcomponent._lock = true;\n\tcallAll(component._beforecreate);\n\tcallAll(component._oncreate);\n\tcallAll(component._aftercreate);\n\tcomponent._lock = false;\n}\n\nfunction get() {\n\treturn this._state;\n}\n\nfunction init(component, options) {\n\tcomponent._handlers = blankObject();\n\tcomponent._slots = blankObject();\n\tcomponent._bind = options._bind;\n\tcomponent._staged = {};\n\n\tcomponent.options = options;\n\tcomponent.root = options.root || component;\n\tcomponent.store = options.store || component.root.store;\n\n\tif (!options.root) {\n\t\tcomponent._beforecreate = [];\n\t\tcomponent._oncreate = [];\n\t\tcomponent._aftercreate = [];\n\t}\n}\n\nfunction on(eventName, handler) {\n\tvar handlers = this._handlers[eventName] || (this._handlers[eventName] = []);\n\thandlers.push(handler);\n\n\treturn {\n\t\tcancel: function() {\n\t\t\tvar index = handlers.indexOf(handler);\n\t\t\tif (~index) handlers.splice(index, 1);\n\t\t}\n\t};\n}\n\nfunction set(newState) {\n\tthis._set(assign({}, newState));\n\tif (this.root._lock) return;\n\tflush(this.root);\n}\n\nfunction _set(newState) {\n\tvar oldState = this._state,\n\t\tchanged = {},\n\t\tdirty = false;\n\n\tnewState = assign(this._staged, newState);\n\tthis._staged = {};\n\n\tfor (var key in newState) {\n\t\tif (this._differs(newState[key], oldState[key])) changed[key] = dirty = true;\n\t}\n\tif (!dirty) return;\n\n\tthis._state = assign(assign({}, oldState), newState);\n\tthis._recompute(changed, this._state);\n\tif (this._bind) this._bind(changed, this._state);\n\n\tif (this._fragment) {\n\t\tthis.fire(\"state\", { changed: changed, current: this._state, previous: oldState });\n\t\tthis._fragment.p(changed, this._state);\n\t\tthis.fire(\"update\", { changed: changed, current: this._state, previous: oldState });\n\t}\n}\n\nfunction _stage(newState) {\n\tassign(this._staged, newState);\n}\n\nfunction setDev(newState) {\n\tif (typeof newState !== 'object') {\n\t\tthrow new Error(\n\t\t\tthis._debugName + '.set was called without an object of data key-values to update.'\n\t\t);\n\t}\n\n\tthis._checkReadOnly(newState);\n\tset.call(this, newState);\n}\n\nfunction callAll(fns) {\n\twhile (fns && fns.length) fns.shift()();\n}\n\nfunction _mount(target, anchor) {\n\tthis._fragment[this._fragment.i ? 'i' : 'm'](target, anchor || null);\n}\n\nvar PENDING = {};\nvar SUCCESS = {};\nvar FAILURE = {};\n\nfunction removeFromStore() {\n\tthis.store._remove(this);\n}\n\nvar proto = {\n\tdestroy,\n\tget,\n\tfire,\n\ton,\n\tset,\n\t_recompute: noop,\n\t_set,\n\t_stage,\n\t_mount,\n\t_differs\n};\n\nvar protoDev = {\n\tdestroy: destroyDev,\n\tget,\n\tfire,\n\ton,\n\tset: setDev,\n\t_recompute: noop,\n\t_set,\n\t_stage,\n\t_mount,\n\t_differs\n};\n\nexport { blankObject, destroy, destroyDev, _differs, _differsImmutable, fire, flush, get, init, on, set, _set, _stage, setDev, callAll, _mount, PENDING, SUCCESS, FAILURE, removeFromStore, proto, protoDev, wrapAnimation, fixPosition, handlePromise, append, insert, detachNode, detachBetween, detachBefore, detachAfter, reinsertBetween, reinsertChildren, reinsertAfter, reinsertBefore, destroyEach, createFragment, createElement, createSvgElement, createText, createComment, addListener, removeListener, setAttribute, setAttributes, setCustomElementData, setXlinkAttribute, getBindingGroupValue, toNumber, timeRangesToArray, children, claimElement, claimText, setData, setInputType, setStyle, selectOption, selectOptions, selectValue, selectMultipleValue, addResizeListener, toggleClass, destroyBlock, outroAndDestroyBlock, fixAndOutroAndDestroyBlock, updateKeyedEach, measure, animate, getSpreadUpdate, invalidAttributeNameCharacter, spread, escaped, escape, each, missingComponent, validateSsrComponent, debug, linear, generateRule, hash, wrapTransition, outros, groupOutros, transitionManager, noop, assign, assignTrue, isPromise, callAfter, addLoc, exclude, run };\n","<div\n  ref:menu\n  style=\"top: {pos.top}px; left: {pos.left}px\"\n  class=\"menu{active ? ' active' : ''}{inputMode ? ' input-mode' : ''}\">\n  <div class=\"items\">\n    {#each items as item}\n      {#if item}\n        <button class=\"editor-menu-{item.name}{item.active ? ' active' : ''}\" on:click=\"onClick(item)\" disabled={item.disabled}>\n          <i class=\"typewriter-icon typewriter-{item.icon || item.name}\"></i>\n        </button>\n      {:else}\n        <div class=\"typewriter-separator\"></div>\n      {/if}\n    {/each}\n  </div>\n  <div class=\"link-input\">\n    <input ref:input bind:value=\"href\" on:keydown=\"onKeyDown(event)\" on:blur=\"exitInput()\" placeholder=\"https://example.com/\">\n    <i on:click=\"exitInput()\" class=\"close\">Ã—</i>\n  </div>\n</div>\n\n<script>\n  const SOURCE_USER = 'user';\n\n  export default {\n    data() {\n      return {\n        view: null,\n        active: false,\n        inputMode: false,\n        pos: { left: 0, top: 0 },\n        href: '',\n      };\n    },\n\n    oncreate() {\n      this.reposition();\n    },\n\n    onstate({ changed, current }) {\n      if (this.refs.menu && (changed.view || changed.range)) {\n        this.reposition();\n      }\n    },\n\n    computed: {\n      items: ({ view, range }) => {\n        if (!view) return [];\n\n        const editor = view.editor;\n        const { blocks, markups } = view.paper;\n        const { header, blockquote } = blocks.types;\n        const { bold, italic, link } = markups.types;\n        const format = editor.getFormat(range);\n        const items = [];\n\n        if (bold) {\n          items.push({\n            name: 'bold',\n            active: format.bold,\n            action: 'onMarkupClick'\n          });\n        }\n\n        if (italic) {\n          items.push({\n            name: 'italic',\n            active: format.italic,\n            action: 'onMarkupClick'\n          });\n        }\n\n        if (link) {\n          items.push({\n            name: 'link',\n            active: format.link,\n            action: 'onLinkClick'\n          });\n        }\n\n        if (items.length && (header || blockquote)) {\n          items.push(null);\n        }\n\n        if (header) {\n          items.push({\n            name: 'header',\n            icon: 'heading1',\n            active: format.header === 2,\n            action: 'onBlockClick',\n            value: 2\n          }, {\n            name: 'header',\n            icon: 'heading2',\n            active: format.header === 3,\n            action: 'onBlockClick',\n            value: 3\n          });\n        }\n\n        if (blockquote) {\n          items.push({\n            name: 'blockquote',\n            active: format.blockquote,\n            action: 'onBlockClick'\n          });\n        }\n\n        return items;\n      }\n    },\n\n    methods: {\n      reposition() {\n        const { view, range } = this.get();\n        let pos;\n        if (!view || !range) {\n          pos = { top: -100000, left: -100000 };\n        } else {\n          const menu = this.refs.menu;\n          if (!menu.offsetParent) return; // Removed from DOM\n          const container = menu.offsetParent.getBoundingClientRect();\n          const target = view.getBounds(range);\n          pos = {\n            top: target.top - container.top - menu.offsetHeight,\n            left: target.left - container.left + target.width / 2 - menu.offsetWidth / 2,\n          };\n        }\n        this.set({ pos });\n      },\n\n      inputLink() {\n        this.set({ inputMode: true, href: '' });\n        this.refs.input.focus();\n      },\n\n      exitInput() {\n        let { view } = this.get();\n        this.set({ inputMode: false, href: '' });\n        view.focus();\n      },\n\n      createLink() {\n        let { href, view, range } = this.get();\n        href = href.trim();\n        if (href) {\n          view.editor.formatText(range, { link: href }, SOURCE_USER);\n        }\n        view.focus();\n        this.exitInput();\n      },\n\n      onMarkupClick(item) {\n        const { view, range } = this.get();\n        view.editor.toggleTextFormat(range, { [item.name]: true }, SOURCE_USER);\n        // Re-calculate the position of the menu\n        this.set({ range: range.slice() });\n      },\n\n      onBlockClick(item) {\n        const { view, range } = this.get();\n        view.editor.toggleLineFormat(range, { [item.name]: item.value || true }, SOURCE_USER);\n        // Re-calculate the position of the menu\n        this.set({ range: range.slice() });\n      },\n\n      onLinkClick() {\n        const { view, range } = this.get();\n        if (view.editor.getTextFormat(range).link) {\n          view.editor.formatText(range, { link: null }, SOURCE_USER);\n        } else {\n          this.inputLink();\n        }\n      },\n\n      onHeaderClick(item) {\n        const { view, range } = this.get();\n        if (view.editor.getTextFormat(range).link) {\n          view.editor.formatText(range, { link: null }, SOURCE_USER);\n        } else {\n          this.inputLink();\n        }\n      },\n\n      onClick(item) {\n        if (typeof this[item.action] === 'function') {\n          this[item.action](item);\n        }\n      },\n\n      onKeyDown(event) {\n        if (event.keyCode === 27) {\n          event.preventDefault();\n          this.exitInput();\n        } else if (event.keyCode === 13) {\n          event.preventDefault();\n          this.createLink();\n        }\n      }\n    }\n  }\n</script>\n\n<style>\n  @import url(https://fonts.googleapis.com/icon?family=Material+Icons);\n  .menu {\n    position: absolute;\n    background-image: linear-gradient(to bottom, rgba(49, 49, 47, .99), #262625);\n    border-radius: .25rem;\n    opacity: 0;\n    z-index: 10000;\n    margin-top: -7px;\n    white-space: nowrap;\n  }\n  .menu.active {\n    opacity: 1;\n    animation: pop-upwards 180ms forwards linear;\n    transition: top 75ms ease-out, left 75ms ease-out;\n  }\n  .menu::after {\n    content: '';\n    position: absolute;\n    bottom: -13px;\n    left: 50%;\n    margin-left: -7px;\n    border: 7px solid transparent;\n    border-top-color: #262625;\n  }\n  button {\n    height: 42px;\n    line-height: 42px;\n    vertical-align: middle;\n    border: none;\n    padding: 0 8px;\n    color: #fff;\n    background: none;\n    outline: none;\n    cursor: pointer;\n  }\n  button:first-child {\n    padding-left: 14px;\n  }\n  button:last-child {\n    padding-right: 14px;\n  }\n  button.active {\n    color: #74b6ff;\n  }\n  button[disabled] {\n    opacity: .5;\n    cursor: default;\n  }\n  .typewriter-icon {\n    display: inline-block;\n    font-family: 'Material Icons';\n    font-weight: normal;\n    font-style: normal;\n    font-size: 24px;\n    line-height: inherit;\n    letter-spacing: normal;\n    text-transform: none;\n    display: inline-block;\n    white-space: nowrap;\n    word-wrap: normal;\n    direction: ltr;\n    -webkit-font-feature-settings: 'liga';\n    -webkit-font-smoothing: antialiased;\n  }\n  .typewriter-icon.typewriter-bold::before {\n    content: '\\E238';\n  }\n  .typewriter-icon.typewriter-italic::before {\n    content: '\\E23F';\n  }\n  .typewriter-icon.typewriter-link::before {\n    content: '\\E250';\n  }\n  .typewriter-icon.typewriter-heading1::before {\n    content: '\\E264';\n  }\n  .typewriter-icon.typewriter-heading2::before {\n    font-size: .75em;\n    content: '\\E264';\n  }\n  .typewriter-icon.typewriter-blockquote::before {\n    content: '\\E244';\n  }\n  .typewriter-separator {\n    display: inline-block;\n    vertical-align: middle;\n    width: 1px;\n    margin: 0 6px;\n    height: 24px;\n    background: rgba(0, 0, 0, .2);\n    box-shadow: 1px 0 rgba(255, 255, 255, .2);\n  }\n  @keyframes pop-upwards {\n    0% {\n      transform: matrix(.97, 0, 0, 1, 0, 12);\n      opacity: 0\n    }\n    20% {\n      transform: matrix(.99, 0, 0, 1, 0, 2);\n      opacity: .7\n    }\n    40% {\n      transform: matrix(1, 0, 0, 1, 0, -1);\n      opacity: 1\n    }\n    70% {\n      transform: matrix(1, 0, 0, 1, 0, 0);\n      opacity: 1\n    }\n    100% {\n      transform: matrix(1, 0, 0, 1, 0, 0);\n      opacity: 1\n    }\n  }\n\n  .link-input {\n    position: absolute;\n    top: 0;\n    width: 100%;\n    height: 100%;\n  }\n  .link-input input {\n    width: 100%;\n    height: 100%;\n    background: none;\n    border: none;\n    color: #f7f7f9;\n    padding: 10px 24px 10px 12px;\n    font-size: .875rem;\n    outline: none;\n    box-sizing: border-box;\n  }\n  .link-input .close {\n    position: absolute;\n    right: 12px;\n    top: 10px;\n    color: #f7f7f9;\n    opacity: .5;\n  }\n  .link-input .close:hover {\n    color: #f7f7f9;\n    opacity: 1;\n  }\n  .menu:not(.input-mode) .link-input {\n    display: none;\n  }\n  .menu.input-mode .items {\n    opacity: 0;\n  }\n</style>\n","import HoverMenu from '../ui/HoverMenu.html';\n\nexport default function hoverMenu() {\n\n  return view => {\n    const editor = view.editor;\n    let menu, mousedown = false;\n\n\n    function show(range = editor.selection) {\n      if (!menu) {\n        menu = new HoverMenu({\n          target: view.root.parentNode,\n          data: { view, range },\n        });\n        if (menu.get().items.length) {\n          requestAnimationFrame(() => menu && menu.set({ active: true }));\n        }\n      } else {\n        menu.set({ range });\n      }\n    }\n\n    function hide() {\n      if (menu) menu.destroy();\n      menu = null;\n    }\n\n    function update() {\n      const selection = editor.selection;\n      const validSelection = selection && selection[0] !== selection[1];\n      const inputMode = menu && menu.get().inputMode;\n      if (!validSelection || !view.enabled) {\n        if (!inputMode) hide();\n        return;\n      }\n      show();\n    }\n\n    function onEditorChange() {\n      if (!mousedown) update();\n    }\n\n    function onMouseDown() {\n      view.root.ownerDocument.addEventListener('mouseup', onMouseUp);\n      mousedown = true;\n    }\n\n    function onMouseUp() {\n      mousedown = false;\n      setTimeout(update);\n    }\n\n    editor.on('editor-change', onEditorChange);\n    view.root.addEventListener('mousedown', onMouseDown);\n\n    return {\n      show,\n      hide,\n      destroy() {\n        editor.off('editor-change', onEditorChange);\n        view.root.removeEventListener('mousedown', onMouseDown);\n        view.root.ownerDocument.removeEventListener('mouseup', onMouseUp);\n        hide();\n      }\n    }\n  }\n}\n","import EventDispatcher from './event-dispatcher';\nimport Delta from './delta';\nimport Editor from './editor';\nimport View from './view';\nimport Paper, { container } from './paper';\nimport * as blocks from './view/blocks';\nimport * as markups from './view/markups';\nimport * as embeds from './view/embeds';\nimport defaultPaper from './view/defaultPaper';\n\nexport  { h } from './view/vdom';\nexport { shortcutFromEvent } from './shortcut-string';\nexport { deltaToVdom, deltaFromDom, deltaToHTML, deltaFromHTML } from './view/dom';\n\nimport input from './modules/input';\nimport keyShortcuts from './modules/key-shortcuts';\nimport history from './modules/history';\nimport placeholder from './modules/placeholder';\nimport smartEntry from './modules/smart-entry';\nimport smartQuotes, { smartQuotesDecorator } from './modules/smart-quotes';\nimport hoverMenu from './modules/hover-menu';\n\nconst defaultViewModules = {\n  input: input(),\n  keyShortcuts: keyShortcuts(),\n  history: history(),\n};\n\nexport {\n  EventDispatcher,\n  Delta,\n  Editor,\n  View,\n  Paper,\n  defaultPaper,\n  container,\n  blocks,\n  markups,\n  embeds,\n  input,\n  keyShortcuts,\n  history,\n  placeholder,\n  smartEntry,\n  smartQuotes,\n  smartQuotesDecorator,\n  hoverMenu,\n  defaultViewModules,\n};\n"],"names":["dispatcherEvents","WeakMap","EventDispatcher","type","listener","getEventListeners","add","events","delete","once","off","args","apply","on","uncanceled","forEach","obj","autocreate","get","set","Object","create","Set","DIFF_DELETE","DIFF_INSERT","DIFF_EQUAL","diff","text1","text2","cursor_pos","length","commonlength","diff_commonPrefix","commonprefix","substring","diff_commonSuffix","commonsuffix","diffs","diff_compute_","unshift","push","diff_cleanupMerge","fix_cursor","fix_emoji","longtext","shorttext","i","indexOf","hm","diff_halfMatch_","text1_a","text1_b","text2_a","text2_b","mid_common","diffs_a","diffs_b","concat","diff_bisect_","text1_length","text2_length","max_d","Math","ceil","v_offset","v_length","v1","Array","v2","x","delta","front","k1start","k1end","k2start","k2end","d","k1","k1_offset","x1","y1","charAt","k2_offset","x2","diff_bisectSplit_","k2","y2","y","text1a","text2a","text1b","text2b","diffsb","pointermin","pointermax","min","pointermid","pointerstart","floor","pointerend","diff_halfMatchI_","seed","j","best_common","best_longtext_a","best_longtext_b","best_shorttext_a","best_shorttext_b","prefixLength","suffixLength","hm1","hm2","pointer","count_delete","count_insert","text_delete","text_insert","splice","pop","changes","INSERT","DELETE","EQUAL","cursor_normalize_diff","current_pos","next_pos","slice","split_pos","d_left","d_right","Error","norm","ndiffs","cursor_pointer","d_next","merge_tuples","suffix","compact","starts_with_pair_end","str","charCodeAt","ends_with_pair_start","fixed_diffs","start","left_d","right_d","shallowEqual","objA","objB","valueEqual","strictEqual","deepEqual","valueA","valueB","propEqual","Date","getTime","objectEqual","prototype","keysA","keys","keysB","every","key","NULL_CHARACTER","String","fromCharCode","Delta","ops","text","attributes","newOp","insert","_push","retain","index","lastOp","Iterator","predicate","filter","map","passed","failed","op","target","initial","reduce","entry","getOpLength","end","Infinity","iter","iterator","hasNext","nextOp","next","other","thisIter","otherIter","peekType","peekLength","thisOp","otherOp","composeAttributes","chop","strings","prep","join","diffResult","component","opLength","diffAttributes","newline","lineStart","currentIndex","peek","nextLength","newlineIndex","line","from","to","lines","eachLine","at","getLines","some","getOps","priority","transformPosition","transformAttributes","offset","nextType","source","keepNull","undefined","retOp","substr","SOURCE_API","SOURCE_USER","SOURCE_SILENT","empty","Editor","options","contents","selection","activeFormats","setContents","modules","_queuedEvents","_normalizeRange","getContents","oldSelection","_normalizeSelection","getTextFormat","event","fire","change","oldContents","normalizeContents","compose","transform","getSelectedRange","changeEvent","selectionChanged","_queueEvents","newContents","updateContents","formats","getLineFormat","lineFormat","textFormat","split","cleanDelete","embed","value","result","combineFormats","seleciton","test","name","decorations","classes","getText","format","existing","formatLine","isSame","formatText","producer","singleChange","getChange","range","max","alreadyRunning","shift","rest","toValue","isArray","editor","getLine","lineChange","freeze","combined","merged","h","children","arguments","node","renderChildren","element","patchChildren","clone","eventListener","currentTarget","updateAttribute","isSvg","oldValue","addEventListener","removeEventListener","setAttribute","removeAttribute","createElement","document","createTextNode","createElementNS","appendChild","getElementAttributes","updateElement","oldAttributes","removeElement","parent","removeChild","patch","childNodes","nodeName","toLowerCase","newElement","insertBefore","nodeValue","decorateBlock","vdom","attr","classArray","class","undecorateBlock","block","ignoreClasses","ignoreAttributes","selector","replace","_","attrLength","classList","match","item","attribute","paragraph","header","defaultFollows","dom","parseInt","H","list","optimize","indent","parentNode","lists","topLevelChildren","levels","List","childrenArray","blockquote","quotes","codeblock","hr","bold","styleSelector","italic","code","link","href","image","src","br","cursor","dataset","color","style","backgroundColor","blocks","markups","embeds","getSelection","view","root","ownerDocument","defaultView","anchorNode","startContainer","anchorOffset","startOffset","focusNode","endContainer","focusOffset","endOffset","isCollapsed","collapsed","contains","anchorIndex","getNodeAndOffsetIndex","focusIndex","setSelection","hasFocus","activeElement","blur","removeAllRanges","getNodesForRange","setBaseAndExtent","focus","getBrowserRange","browserRange","createRange","setStart","setEnd","getNodeAndOffset","inDom","paper","walker","createTreeWalker","NodeFilter","SHOW_ELEMENT","SHOW_TEXT","acceptNode","nodeType","Node","TEXT_NODE","FILTER_ACCEPT","FILTER_REJECT","count","firstBlockSeen","currentNode","nextNode","size","matches","isBRPlaceholder","nextSibling","call","firstChild","ELEMENT_NODE","getNodeIndex","previousNode","matchHtmlRegExp","escapeHtml","string","exec","escape","html","lastIndex","Paper","types","Types","container","markup","getDefault","array","priorities","definition","remove","domType","nodeOrAttr","nodeMarkup","BR","VOID_ELEMENTS","area","base","col","img","input","meta","param","track","wbr","SKIP_ELEMENTS","STYLE","SCRIPT","LINK","META","TITLE","BLOCK_ELEMENTS","deltaToVdom","defaultPaper","blockData","inlineChildren","find","sort","a","b","mergeChildren","lastChild","blockChildren","collect","data","deltaFromDom","opts","notInDom","currentBlock","unknownBlock","hasAttribute","deltaToHTML","childrenToHTML","deltaFromHTML","template","innerHTML","content","oldChildren","prev","nodeToHTML","closingTag","child","modifierKeys","Control","Meta","Shift","Alt","shortcutFromEvent","shortcutArray","metaKey","ctrlKey","altKey","shiftKey","toUpperCase","isMac","navigator","userAgent","modExpr","View","className","enable","_settingEditorSelection","_settingBrowserSelection","init","lastSelection","enabled","contentEditable","decorators","e","getBoundingClientRect","getClientRects","reverseDecorators","contenteditable","renderEvent","updateBrowserSelection","setTimeout","nativeRange","currentRange","hasOwnProperty","defaultParagraphSet","onKeyDown","shortcut","onSelectionChange","updateEditorSelection","execCommand","onTextChanging","onEditorChange","render","uninit","api","destroy","lastWord","firstWord","lastLine","pasteMutation","mutationOptions","characterData","characterDataOldValue","subtree","childList","onMutate","m","textChange","getTextChange","clean","onEnter","defaultPrevented","preventDefault","isDefault","atEnd","insertText","onShiftEnter","insertEmbed","onBackspace","deleteText","onDelete","onTab","direction","transaction","prevLine","prevIndent","console","log","mutations","mutation","getTextChangeMutation","addedNodes","action","seen","has","first","second","third","added","removed","removedNodes","textNode","onPaste","observer","MutationObserver","observe","onRendering","disconnect","onRender","keymap","toggleTextFormat","toggleLineFormat","macKeymap","keyShortcuts","customShortcuts","shortcuts","onShortcut","defaultOptions","delay","maxStack","history","stack","undo","redo","lastRecorded","lastAction","ignoreChange","cutoff","dest","record","timestamp","now","getAction","undoChange","undoSelection","redoSelection","onTextChange","changeOp","placeholder","pointerEvents","onDecorate","blockReplacements","capture","textReplacements","blockReplace","prefix","regexp","getAttributes","textReplace","replaceWith","defaultHandlers","handlers","ignore","isTextEntry","getExactText","lastIndexOf","handler","smartQuotes","lastChars","replaced","quote","smartQuotesDecorator","expr","replacer","replacement","_set","hoverMenu","menu","mousedown","show","HoverMenu","items","requestAnimationFrame","active","hide","update","validSelection","inputMode","onMouseDown","onMouseUp","defaultViewModules"],"mappings":"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"}